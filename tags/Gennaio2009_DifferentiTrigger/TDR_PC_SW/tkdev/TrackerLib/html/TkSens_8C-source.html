<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TkSens.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TkSens.C</h1><a href="TkSens_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 
00017 
00018 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00019 
00020 <span class="preprocessor">#include "<a class="code" href="TkSens_8h.html">TkSens.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="TkCoo_8h.html">TkCoo.h</a>"</span>
00022 
00023 
00024 <span class="comment">//--------------------------------------------------</span>
<a name="l00025"></a><a class="code" href="classTkSens.html#a0">00025</a> <a class="code" href="classTkSens.html#a0">TkSens::TkSens</a>() {
00026   <a class="code" href="classTkSens.html#a16">Clear</a>();
00027 }
00028 
00029 
00030 <span class="comment">//--------------------------------------------------</span>
<a name="l00031"></a><a class="code" href="classTkSens.html#a1">00031</a> <a class="code" href="classTkSens.html#a0">TkSens::TkSens</a>(AMSPoint&amp; GCoo){
00032   <a class="code" href="classTkSens.html#a16">Clear</a>();
00033   <a class="code" href="classTkSens.html#r0">GlobalCoo</a>=GCoo;
00034   <a class="code" href="classTkSens.html#a5">Recalc</a>();
00035 }
00036 
00037 
00038 <span class="comment">//--------------------------------------------------</span>
<a name="l00039"></a><a class="code" href="classTkSens.html#a2">00039</a> <a class="code" href="classTkSens.html#a0">TkSens::TkSens</a>(<span class="keywordtype">int</span> tkid, AMSPoint&amp; GCoo){
00040   <a class="code" href="classTkSens.html#a16">Clear</a>();
00041   <a class="code" href="classTkSens.html#r0">GlobalCoo</a>=GCoo;
00042   <a class="code" href="classTkSens.html#r1">lad_tkid</a>=tkid; 
00043   <a class="code" href="classTkSens.html#a5">Recalc</a>();
00044 }
00045 
00046 
00047 <span class="comment">//--------------------------------------------------</span>
<a name="l00048"></a><a class="code" href="classTkSens.html#a16">00048</a> <span class="keywordtype">void</span> <a class="code" href="classTkSens.html#a16">TkSens::Clear</a>(){
00049 
00050   <a class="code" href="classTkSens.html#r1">lad_tkid</a> =0;
00051   <a class="code" href="classTkSens.html#r2">sens</a>     =-1;
00052   <a class="code" href="classTkSens.html#r3">SensCoo</a>[0]=-1000;<a class="code" href="classTkSens.html#r3">SensCoo</a>[1]=-1000;<a class="code" href="classTkSens.html#r3">SensCoo</a>[2]=-1000;
00053   <a class="code" href="classTkSens.html#r4">LaddCoo</a>=SensCoo;
00054   <a class="code" href="classTkSens.html#r5">ReadChanX</a> =-1;
00055   <a class="code" href="classTkSens.html#r6">ReadChanY</a> =-1;
00056   <a class="code" href="classTkSens.html#r7">ImpactPointX</a> =-1;
00057   <a class="code" href="classTkSens.html#r8">ImpactPointY</a> =-1;
00058 
00059 }
00060 
00061 
00062 <span class="comment">//--------------------------------------------------</span>
<a name="l00063"></a><a class="code" href="classTkSens.html#d1">00063</a> <span class="keywordtype">bool</span> <a class="code" href="classTkSens.html#d1">TkSens::IsInsideLadder</a>(<span class="keywordtype">int</span> tkid){
00064   <a class="code" href="classTkLadder.html">TkLadder</a>* lad=0;
00065   lad=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(<a class="code" href="classTkSens.html#r1">lad_tkid</a>);
00066   <span class="keywordflow">if</span> (!lad) {<span class="keywordflow">return</span>  <span class="keyword">false</span>;}
00067   <span class="keywordflow">return</span> <a class="code" href="classTkSens.html#d1">IsInsideLadder</a>(lad);
00068 
00069 }
00070 
00071 <span class="comment">//--------------------------------------------------</span>
<a name="l00072"></a><a class="code" href="classTkSens.html#a5">00072</a> <span class="keywordtype">void</span> <a class="code" href="classTkSens.html#a5">TkSens::Recalc</a>(){
00073 
00074   <span class="keywordtype">int</span> lay = -1;
00075   <span class="keywordflow">if</span>( <a class="code" href="classTkSens.html#r1">lad_tkid</a>==0) {
00076     lay=<a class="code" href="classTkSens.html#d0">GetLayer</a>();
00077     <span class="keywordflow">if</span>(lay)
00078       <a class="code" href="classTkSens.html#r1">lad_tkid</a>=<a class="code" href="classTkSens.html#d3">FindLadder</a>();
00079     <span class="keywordflow">if</span>(!<a class="code" href="classTkSens.html#d1">IsInsideLadder</a>(<a class="code" href="classTkSens.html#r1">lad_tkid</a>)) <span class="keywordflow">return</span>;
00080   }
00081   
00082   <a class="code" href="classTkSens.html#r2">sens</a>=<a class="code" href="classTkSens.html#d4">GetSens</a>();
00083   <a class="code" href="classTkSens.html#r6">ReadChanY</a>=<a class="code" href="classTkSens.html#d5">GetStripFromLocalCooS</a>(<a class="code" href="classTkSens.html#r3">SensCoo</a>[1]);
00084   number cooY1,cooY2;  
00085   cooY1=<a class="code" href="classTkCoo.html#h0">TkCoo::GetLocalCooS</a>(<a class="code" href="classTkSens.html#r6">ReadChanY</a>);
00086   <span class="keywordflow">if</span>((<a class="code" href="classTkSens.html#r4">LaddCoo</a>[1]-cooY1)&gt;=0)
00087     cooY2=<a class="code" href="classTkCoo.html#h0">TkCoo::GetLocalCooS</a>(<a class="code" href="classTkSens.html#r6">ReadChanY</a>+1);
00088   <span class="keywordflow">else</span>
00089     cooY2=<a class="code" href="classTkCoo.html#h0">TkCoo::GetLocalCooS</a>(<a class="code" href="classTkSens.html#r6">ReadChanY</a>-1);
00090   <a class="code" href="classTkSens.html#r8">ImpactPointY</a>=(<a class="code" href="classTkSens.html#r4">LaddCoo</a>[1]-cooY1)/abs(cooY1-cooY2);
00091   
00092   <span class="keywordtype">int</span> mult = -1;
00093   <span class="keywordtype">int</span> layer=abs(<a class="code" href="classTkSens.html#r1">lad_tkid</a>)/100;
00094   number cooX1,cooX2;  
00095   <span class="keywordflow">if</span>(layer==1||layer==8){
00096     <a class="code" href="classTkSens.html#r5">ReadChanX</a>=<a class="code" href="classTkSens.html#d7">GetStripFromLocalCooK7</a>(<a class="code" href="classTkSens.html#r3">SensCoo</a>[0],<a class="code" href="classTkSens.html#r2">sens</a>);
00097     mult = <a class="code" href="classTkSens.html#r2">sens</a>*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o27">_NReadStripK7</a>/TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o30">_NReadoutChanK</a>;
00098     <span class="keywordtype">int</span> test = (mult*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o30">_NReadoutChanK</a>+ReadChanX)/TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o27">_NReadStripK7</a>;
00099     <span class="keywordflow">if</span> (test!=sens) mult = mult+1;
00100     cooX1=<a class="code" href="classTkCoo.html#h2">TkCoo::GetLocalCooK7</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>,mult);
00101     <span class="keywordflow">if</span>((<a class="code" href="classTkSens.html#r4">LaddCoo</a>[0]-cooX1)&gt;=0) 
00102       cooX2=<a class="code" href="classTkCoo.html#h2">TkCoo::GetLocalCooK7</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>+1,mult);
00103     <span class="keywordflow">else</span>
00104       cooX2=<a class="code" href="classTkCoo.html#h2">TkCoo::GetLocalCooK7</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>-1,mult);
00105   }    
00106   <span class="keywordflow">else</span>{
00107     <a class="code" href="classTkSens.html#r5">ReadChanX</a>=<a class="code" href="classTkSens.html#d6">GetStripFromLocalCooK5</a>(<a class="code" href="classTkSens.html#r3">SensCoo</a>[0],<a class="code" href="classTkSens.html#r2">sens</a>);
00108     mult = <a class="code" href="classTkSens.html#r2">sens</a>*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o28">_NReadStripK5</a>/TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o30">_NReadoutChanK</a>;
00109     cooX1=<a class="code" href="classTkCoo.html#h1">TkCoo::GetLocalCooK5</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>,mult);
00110     <span class="keywordflow">if</span>((<a class="code" href="classTkSens.html#r4">LaddCoo</a>[0]-cooX1)&gt;=0)
00111       cooX2=<a class="code" href="classTkCoo.html#h1">TkCoo::GetLocalCooK5</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>+1,mult);
00112     <span class="keywordflow">else</span>
00113       cooX2=<a class="code" href="classTkCoo.html#h1">TkCoo::GetLocalCooK5</a>(640+<a class="code" href="classTkSens.html#r5">ReadChanX</a>-1,mult);
00114   }
00115   <a class="code" href="classTkSens.html#r7">ImpactPointX</a>=(<a class="code" href="classTkSens.html#r4">LaddCoo</a>[0]-cooX1)/abs(cooX1-cooX2);
00116 
00117   <span class="comment">// - always defined (also in regions of no definition 640 and -0.2)</span>
00118   <span class="comment">// - sensor/multiplicity (880)</span>
00119 
00120   <span class="comment">/*</span>
00121 <span class="comment">  // to be removed</span>
00122 <span class="comment">  cerr &lt;&lt; "Layer:             " &lt;&lt; lay &lt;&lt; endl;</span>
00123 <span class="comment">  cerr &lt;&lt; "TkId:              " &lt;&lt; lad_tkid &lt;&lt; endl;</span>
00124 <span class="comment">  cerr &lt;&lt; "GlobalCoordinate:  " &lt;&lt; GlobalCoo &lt;&lt; endl;</span>
00125 <span class="comment">  cerr &lt;&lt; "SensorCoordinate:  " &lt;&lt; SensCoo &lt;&lt; endl;</span>
00126 <span class="comment">  cerr &lt;&lt; "ReadChanX:         " &lt;&lt; ReadChanX &lt;&lt; endl;</span>
00127 <span class="comment">  cerr &lt;&lt; "ReadChanY:         " &lt;&lt; ReadChanY &lt;&lt; endl;</span>
00128 <span class="comment">  cerr &lt;&lt; "LadderCoordinate:  " &lt;&lt; LaddCoo &lt;&lt; endl;</span>
00129 <span class="comment">  cerr &lt;&lt; "LadderCoordinate1: " &lt;&lt; cooX1 &lt;&lt; "  " &lt;&lt; cooY1 &lt;&lt; endl;</span>
00130 <span class="comment">  cerr &lt;&lt; "LadderCoordinate2: " &lt;&lt; cooX2 &lt;&lt; "  " &lt;&lt; cooY2 &lt;&lt; endl;</span>
00131 <span class="comment">  cerr &lt;&lt; "ImpactPointX:      " &lt;&lt; ImpactPointX &lt;&lt; endl;</span>
00132 <span class="comment">  cerr &lt;&lt; "ImpactPointY:      " &lt;&lt; ImpactPointY &lt;&lt; endl;</span>
00133 <span class="comment">  cerr &lt;&lt; "Multiplicity:      " &lt;&lt; mult &lt;&lt; endl;</span>
00134 <span class="comment">  cerr &lt;&lt; "Sensor:            " &lt;&lt; sens &lt;&lt; endl;</span>
00135 <span class="comment">  */</span>
00136   <span class="keywordflow">return</span>;
00137 
00138 }
00139 
00140 
00141 <span class="comment">//--------------------------------------------------</span>
<a name="l00142"></a><a class="code" href="classTkSens.html#d4">00142</a> <span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d4">TkSens::GetSens</a>(){
00143   <span class="keywordflow">if</span>(<a class="code" href="classTkSens.html#r1">lad_tkid</a>==0) <span class="keywordflow">return</span> -1;
00144 
00145   <span class="comment">//Get the Ladder Pointer</span>
00146   <a class="code" href="classTkLadder.html">TkLadder</a>* lad=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(<a class="code" href="classTkSens.html#r1">lad_tkid</a>);
00147   <span class="keywordflow">if</span>(!lad) <span class="keywordflow">return</span> -1;
00148 
00149   <span class="comment">//Get The Plane Pointer</span>
00150   <a class="code" href="classTkPlane.html">TkPlane</a> * pp=lad-&gt;<a class="code" href="classTkLadder.html#o6">_plane</a>;
00151 
00152   <span class="comment">//Alignment corrected Plane postion</span>
00153   AMSPoint PPosG=pp-&gt;<a class="code" href="classTkObject.html#a11">GetPosA</a>()+pp-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00154 
00155   <span class="comment">//Alignment corrected Plane Rotation matrix</span>
00156   AMSRotMat PRotG=pp-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>().Invert()*pp-&gt;<a class="code" href="classTkObject.html#a12">GetRotMatA</a>().Invert();
00157 
00158   <span class="comment">//Convolute with the Plane pos in the space</span>
00159   AMSPoint oo= PRotG*(<a class="code" href="classTkSens.html#r0">GlobalCoo</a>-PPosG);
00160 
00161   <span class="comment">//Alignment corrected Ladder Rotation matrix</span>
00162   AMSRotMat RotG=lad-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>().Invert()*lad-&gt;<a class="code" href="classTkObject.html#a12">GetRotMatA</a>().Invert();
00163 
00164   <span class="comment">//Alignment corrected Ladder postion</span>
00165   AMSPoint PosG=lad-&gt;<a class="code" href="classTkObject.html#a11">GetPosA</a>()+lad-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00166 
00167   <span class="comment">//Get the local coo on the Ladder</span>
00168   <a class="code" href="classTkSens.html#r3">SensCoo</a> = RotG*(oo-PosG);
00169   <a class="code" href="classTkSens.html#r4">LaddCoo</a> = SensCoo;
00170 
00171   <span class="comment">//Offset of the first strip position</span>
00172   <span class="keywordtype">double</span> Ax= (TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]-
00173               TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])/2;
00174 
00175   <span class="comment">//Sensor number</span>
00176   <span class="keywordtype">int</span> nsens = (int)(abs(<a class="code" href="classTkSens.html#r3">SensCoo</a>[0]+Ax)/TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o31">_SensorPitchK</a>);
00177 
00178   <span class="comment">//Sensor coordinate</span>
00179   <a class="code" href="classTkSens.html#r3">SensCoo</a>[0] -= nsens*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o31">_SensorPitchK</a>;
00180 
00181   <span class="keywordflow">return</span> nsens;
00182 }
00183 
00184 <span class="comment">//--------------------------------------------------</span>
<a name="l00185"></a><a class="code" href="classTkSens.html#d0">00185</a> <span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d0">TkSens::GetLayer</a>() {
00186 
00191   
00192   <span class="comment">// Estimate layer</span>
00193   <span class="keywordtype">double</span> z=<a class="code" href="classTkSens.html#r0">GlobalCoo</a>[2];
00194   <span class="keywordtype">double</span> toll=0.1; <span class="comment">//1 mm</span>
00195   <span class="keywordtype">int</span> layer;
00196   <span class="keywordflow">if</span>      (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(1)+toll  &amp;&amp;   
00197              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(1)-toll ) layer = 1; 
00198   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(2)+toll  &amp;&amp;   
00199              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(2)-toll ) layer = 2; 
00200   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(3)+toll  &amp;&amp;   
00201              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(3)-toll ) layer = 3; 
00202   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(4)+toll  &amp;&amp;   
00203              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(4)-toll ) layer = 4; 
00204   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(5)+toll  &amp;&amp;   
00205              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(5)-toll ) layer = 5; 
00206   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(6)+toll  &amp;&amp;   
00207              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(6)-toll ) layer = 6; 
00208   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(7)+toll  &amp;&amp;   
00209              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(7)-toll ) layer = 7; 
00210   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (  z &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(8)+toll  &amp;&amp;   
00211              z &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a29">GetZlayer</a>(8)-toll ) layer = 8; 
00212   <span class="keywordflow">else</span>    
00213                                                   layer = 0;
00214  <span class="keywordflow">return</span> layer;  
00215 }
00216 
00217 
00218 
00219 <span class="comment">//--------------------------------------------------</span>
<a name="l00221"></a><a class="code" href="classTkSens.html#d3">00221</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d3">TkSens::FindLadder</a>(){
00222   <a class="code" href="classTkLadder.html">TkLadder</a>* lad=0;
00223   <span class="keywordtype">bool</span> found=0;
00224   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0;ii&lt;TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a17">GetEntries</a>();ii++){
00225     lad=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a18">GetEntry</a>(ii);
00226     found=<a class="code" href="classTkSens.html#d1">IsInsideLadder</a>(lad);
00227     <span class="keywordflow">if</span>(found) <span class="keywordflow">break</span>;
00228   }
00229   <span class="keywordflow">if</span>(!found) <span class="keywordflow">return</span> 0;
00230   <span class="keywordflow">else</span> <span class="keywordflow">return</span> lad-&gt;<a class="code" href="classTkLadder.html#a10">GetTkId</a>();
00231   
00232 }
00233 
00234 
00235 <span class="comment">//--------------------------------------------------</span>
<a name="l00236"></a><a class="code" href="classTkSens.html#d2">00236</a> <span class="keywordtype">bool</span> <a class="code" href="classTkSens.html#d1">TkSens::IsInsideLadder</a>(<a class="code" href="classTkLadder.html">TkLadder</a>* lad){
00237   <span class="comment">// Z check: layer check</span>
00238   <span class="keywordflow">if</span> (<a class="code" href="classTkSens.html#d0">GetLayer</a>()!=lad-&gt;<a class="code" href="classTkLadder.html#a4">GetLayer</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// AO Bug fix: otherwise takes the first plane column</span>
00239   <span class="comment">// XY check</span>
00240   <span class="keywordtype">double</span> X=<a class="code" href="classTkSens.html#r0">GlobalCoo</a>[0];
00241   <span class="keywordtype">double</span> Y=<a class="code" href="classTkSens.html#r0">GlobalCoo</a>[1];
00242 
00243   <span class="keywordtype">double</span> vx=lad-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.GetEl(0,0);
00244   <span class="keywordtype">double</span> vy=lad-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.GetEl(1,1);
00245 
00246   <span class="keywordtype">double</span> Ax= lad-&gt;<a class="code" href="classTkObject.html#o1">pos</a>[0] - (TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]-
00247                      TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])/2. *vx;
00248 
00249 
00250   <span class="keywordtype">double</span> Ay= lad-&gt;<a class="code" href="classTkObject.html#o1">pos</a>[1] - (TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[1]-
00251                      TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1])/2. *vy;
00252 
00253   <span class="keywordtype">double</span> Dx= Ax + (lad-&gt;<a class="code" href="classTkLadder.html#o4">_nsensors</a>*
00254             (TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]+0.004)
00255             -0.004)*vx;
00256 
00257   <span class="keywordtype">double</span> Dy= Ay + TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[1] * vy;
00258 
00259   <span class="keywordtype">int</span> good=1;
00260   <span class="keywordflow">if</span>( Ax &gt;Dx){
00261     <span class="keywordflow">if</span>( X &gt; Ax || X &lt; Dx )       good*= 0;
00262   }
00263   <span class="keywordflow">else</span>{
00264     <span class="keywordflow">if</span>( X &lt; Ax || X &gt; Dx )       good*= 0;
00265   }
00266 
00267   <span class="keywordflow">if</span>( Ay &gt;Dy){
00268     <span class="keywordflow">if</span>( Y &gt; Ay || Y &lt; Dy )       good*= 0;
00269   }
00270   <span class="keywordflow">else</span>{
00271     <span class="keywordflow">if</span>( Y &lt; Ay || Y &gt; Dy )       good*= 0;
00272   }
00273   
00274   <span class="keywordflow">return</span> (good&gt;0);
00275 }
00276 
00277 
00278 <span class="comment">//--------------------------------------------------</span>
<a name="l00279"></a><a class="code" href="classTkSens.html#d5">00279</a> <span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d5">TkSens::GetStripFromLocalCooS</a>(number Y){
00280   <span class="keywordflow">if</span>( Y&lt;0 ||Y &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1])
00281     <span class="keywordflow">return</span> -1;
00282 
00283   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(Y &gt;= 1.5*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o32">_PitchS</a> &amp;&amp; 
00284      Y &lt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1] - 2.5*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o32">_PitchS</a>)
00285     <span class="keywordflow">return</span> 1+(int)round((Y-  2*TkDBc::Head-&gt;_PitchS)/TkDBc::Head-&gt;_PitchS);
00286   
00287   <span class="keywordflow">else</span> <span class="keywordflow">if</span>( Y &gt;= 0 &amp;&amp; Y &lt; 1.5*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o32">_PitchS</a>)
00288     <span class="keywordflow">return</span> 0;
00289   <span class="keywordflow">else</span> 
00290     <span class="keywordflow">return</span> 639;
00291 }
00292 
00293 <span class="comment">//--------------------------------------------------</span>
<a name="l00294"></a><a class="code" href="classTkSens.html#d6">00294</a> <span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d6">TkSens::GetStripFromLocalCooK5</a>(number X,<span class="keywordtype">int</span> sens){
00295 
00296   <span class="keywordflow">if</span>( X&lt;0 ||X &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])
00297     <span class="keywordflow">return</span> -1;
00298   
00299   <span class="keywordtype">int</span> chan=(int)round(X/TkDBc::Head-&gt;_PitchK5);
00300   <span class="keywordflow">if</span>(sens%2==1)
00301     chan+=192;
00302   <span class="keywordflow">return</span> chan;
00303 }
00304 
00305 
00306 
00307 
00308 <span class="comment">//--------------------------------------------------</span>
<a name="l00309"></a><a class="code" href="classTkSens.html#d7">00309</a> <span class="keywordtype">int</span> <a class="code" href="classTkSens.html#d7">TkSens::GetStripFromLocalCooK7</a>(number X,<span class="keywordtype">int</span> sens){
00310 
00311 
00312   <span class="keywordflow">if</span>( X&lt;0 ||X &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])
00313     <span class="keywordflow">return</span> -1;
00314   
00315   <span class="keywordtype">int</span> gstrip=-1;
00316   <span class="keywordtype">float</span> strip=(X/TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o35">_ImplantPitchK</a>);
00317 
00318   <span class="keywordflow">if</span>(strip&lt;95.5){
00319     <span class="keywordtype">int</span> tstrip=(int)trunc(strip);
00320     <span class="keywordtype">int</span> rstrip=(int)round(strip);
00321     <span class="keywordtype">int</span> ff=tstrip%3;
00322     <span class="keywordflow">if</span>(ff==2) gstrip=rstrip*2/3;
00323     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ff==0) gstrip=tstrip*2/3;
00324     <span class="keywordflow">else</span> gstrip= (tstrip+1)*2/3;
00325     
00326   }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (strip&gt;=95.5 &amp;&amp; strip&lt;287.5){
00327     <span class="keywordtype">int</span> tstrip=(int)trunc(strip)-96;
00328     <span class="keywordtype">int</span> ff=tstrip%2;
00329     <span class="keywordflow">if</span>(ff==0) gstrip=(tstrip)/2+64;
00330     <span class="keywordflow">else</span> gstrip=(tstrip+1)/2+64;
00331   }
00332   <span class="keywordflow">else</span>{
00333     <span class="keywordtype">int</span> tstrip=(int)trunc(strip)-288;
00334     <span class="keywordtype">int</span> rstrip=(int)round(strip)-288;
00335     <span class="keywordtype">int</span> ff=tstrip%3;
00336     <span class="keywordflow">if</span>(ff==2) gstrip=rstrip*2/3+160;
00337     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ff==0) gstrip=tstrip*2/3+160;
00338     <span class="keywordflow">else</span> gstrip= (tstrip+1)*2/3+160;
00339   }
00340 
00341   <span class="keywordflow">if</span>(gstrip&lt;0) <span class="keywordflow">return</span> -1;
00342   <span class="keywordflow">return</span> (sens*224+gstrip)%384;
00343 }
00344 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
