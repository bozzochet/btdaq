<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: include/AlignFit.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">include</a></div>
<h1>AlignFit.h</h1><a href="AlignFit_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">//  $Id: AlignFit.h,v 1.3 2008/07/04 17:04:01 zuccon Exp $</span>
00002 <span class="preprocessor">#ifndef __AlignFit__</span>
00003 <span class="preprocessor"></span><span class="preprocessor">#define __AlignFit__</span>
00004 <span class="preprocessor"></span>
00018 
00019 <span class="preprocessor">#include "TObject.h"</span>
00020 
00021 <span class="preprocessor">#include "TFile.h"</span>
00022 <span class="preprocessor">#include "TDirectory.h"</span>
00023 <span class="preprocessor">#include "TObjArray.h"</span>
00024 
00025 <span class="preprocessor">#include &lt;map&gt;</span>
00026 
00027 <span class="keyword">class </span>TH1D;
00028 <span class="keyword">class </span>TH2;
00029 
<a name="l00030"></a><a class="code" href="classAlignObject.html">00030</a> <span class="keyword">class </span><a class="code" href="classAlignObject.html">AlignObject</a> {
00031 
00032 <span class="keyword">public</span>:
00033   <span class="keyword">enum</span> { Npar = 2, Ndim = 3, Nalg = 6 };
00034   <span class="keyword">enum</span> { XYcorr1 = 0001, Zcorr1 = 0002, dYXcorr = 0004, 
00035          XYcorr2 = 0010, Zcorr2 = 0020, dZXcorr = 0040,
00036          XYcorr3 = 0100 };
00037          
00038 
<a name="l00039"></a><a class="code" href="classAlignObject.html#o0">00039</a>   Float_t cool[Ndim];
<a name="l00040"></a><a class="code" href="classAlignObject.html#o1">00040</a>   Int_t   fixp[Nalg];
00041 
<a name="l00042"></a><a class="code" href="classAlignObject.html#o2">00042</a>   Double_t param[Ndim];
<a name="l00043"></a><a class="code" href="classAlignObject.html#o3">00043</a>   Double_t perr [Ndim];
<a name="l00044"></a><a class="code" href="classAlignObject.html#o4">00044</a>   Double_t phi, dphi;
<a name="l00045"></a><a class="code" href="classAlignObject.html#o6">00045</a>   Double_t pitch, dpitch;
<a name="l00046"></a><a class="code" href="classAlignObject.html#o8">00046</a>   Double_t roll, droll;
00047 
00048   <span class="keyword">static</span> TObjArray sharray;
00049 
00050   <span class="keyword">static</span> Int_t ProfMode;
00051 
00052 <span class="keyword">protected</span>:
<a name="l00053"></a><a class="code" href="classAlignObject.html#p0">00053</a>   Int_t tkid;
00054 
<a name="l00055"></a><a class="code" href="classAlignObject.html#p1">00055</a>   TObjArray harray;
00056 
<a name="l00057"></a><a class="code" href="classAlignObject.html#p2">00057</a>   TDirectory *ldir;
<a name="l00058"></a><a class="code" href="classAlignObject.html#p3">00058</a>   TDirectory *cdir;
00059 
00060 <span class="keyword">public</span>:
00061   <a class="code" href="classAlignObject.html">AlignObject</a>(Int_t <span class="keywordtype">id</span>);
00062  ~<a class="code" href="classAlignObject.html">AlignObject</a>();
00063 
<a name="l00064"></a><a class="code" href="classAlignObject.html#a2">00064</a>   Int_t GetTkId(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> tkid; }
00065 
00066   <span class="keywordtype">void</span> Reset(<span class="keywordtype">void</span>);
00067   <span class="keywordtype">void</span> InitHists(TDirectory *dir);
00068   <span class="keywordtype">void</span> ResetHists(<span class="keywordtype">void</span>);
00069   <span class="keywordtype">void</span> FillHist(Int_t i, Double_t x, Double_t y);
00070   <span class="keywordtype">void</span> ProcHists(Int_t bits);
00071 
00072   <span class="keywordtype">void</span> SigmaProj(TH2 *hist, Double_t &amp;par, Double_t &amp;err);
00073 
00074   <span class="keyword">static</span> <span class="keywordtype">void</span> InitSHists(<span class="keywordtype">void</span>);
00075   <span class="keyword">static</span> TH1D *Profile(TH2 *hist);
00076   <span class="keyword">static</span> Int_t Fit2D(Int_t n, Double_t *x, Double_t *y, 
00077                               Double_t *w, Double_t *p); 
00078   <span class="keyword">static</span> Int_t Inv3x3(Double_t mtx[3][3]);
00079 };
00080 
<a name="l00081"></a><a class="code" href="AlignFit_8h.html#a0">00081</a> <span class="keyword">typedef</span> std::map&lt;int,AlignObject*&gt;::const_iterator aligIT;
00082 
<a name="l00083"></a><a class="code" href="classAlignFit.html">00083</a> <span class="keyword">class </span><a class="code" href="classAlignFit.html">AlignFit</a> : <span class="keyword">public</span> TObject {
00084 
00085 <span class="keyword">public</span>:
00086   <span class="keyword">enum</span> { <a class="code" href="classAlignFit.html#w10w0">Nplan</a> = 8, <a class="code" href="classAlignFit.html#w10w1">Nlad</a> = 15, <a class="code" href="classAlignFit.html#w10w2">Nhalf</a> = 2, <a class="code" href="classAlignFit.html#w10w3">Npar</a> = 2, 
00087          <a class="code" href="classAlignFit.html#w10w4">Ndim</a> = 11, <a class="code" href="classAlignFit.html#w10w5">Narr</a> = 3,  <a class="code" href="classAlignFit.html#w10w6">Nchi2</a> = 10000, <a class="code" href="classAlignFit.html#w10w7">MaxCases</a> = 5050000,
00088          <a class="code" href="classAlignFit.html#w10w8">Nbuf</a> = <a class="code" href="classAlignFit.html#w10w0">Nplan</a>*<a class="code" href="classAlignFit.html#w10w5">Narr</a>*MaxCases,
00089          <a class="code" href="classAlignFit.html#w10w9">Ncbf</a> = <a class="code" href="classAlignFit.html#w10w0">Nplan</a>*MaxCases };
00090 
<a name="l00091"></a><a class="code" href="classAlignFit.html#s0">00091</a>   <span class="keyword">static</span> TString ofname;
00092 
00093 <span class="keyword">protected</span>:
<a name="l00094"></a><a class="code" href="classAlignFit.html#p0">00094</a>   Int_t  fNcases;
00095 
<a name="l00096"></a><a class="code" href="classAlignFit.html#p1">00096</a>   Float_t  <a class="code" href="classAlignFit.html#p1">fXchi2</a>[Nchi2][Npar];
<a name="l00097"></a><a class="code" href="classAlignFit.html#p2">00097</a>   Float_t *fArray;
<a name="l00098"></a><a class="code" href="classAlignFit.html#p3">00098</a>   <span class="keywordtype">char</span>    *fCrray;
00099 
<a name="l00100"></a><a class="code" href="classAlignFit.html#p4">00100</a>   Float_t  <a class="code" href="classAlignFit.html#p4">fSigma</a>[Npar];
00101 
<a name="l00102"></a><a class="code" href="classAlignFit.html#p5">00102</a>   std::map&lt;int,AlignObject*&gt; aligmap;
00103 
<a name="l00104"></a><a class="code" href="classAlignFit.html#p6">00104</a>   TFile *ofile;
00105 
00106 <span class="keyword">public</span>:
00107   <a class="code" href="classAlignFit.html#a0">AlignFit</a>(<span class="keywordtype">void</span>);
00108  <a class="code" href="classAlignFit.html#a1">~AlignFit</a>();
00109 
<a name="l00110"></a><a class="code" href="classAlignFit.html#a2">00110</a>   Int_t <a class="code" href="classAlignFit.html#a2">ArrayIndex</a>(Int_t icase, Int_t ilayr, Int_t type)<span class="keyword"> const </span>{
00111     <span class="keywordflow">return</span> (0 &lt;= icase &amp;&amp; icase &lt; <a class="code" href="classAlignFit.html#w10w7">MaxCases</a> &amp;&amp;
00112             0 &lt;= ilayr &amp;&amp; ilayr &lt; <a class="code" href="classAlignFit.html#w10w0">Nplan</a> &amp;&amp;
00113             0 &lt;=  type &amp;&amp; type  &lt; Narr) 
00114       ? (icase*Nplan+ilayr)*<a class="code" href="classAlignFit.html#w10w5">Narr</a>+type : -1; 
00115   }
00116 
<a name="l00117"></a><a class="code" href="classAlignFit.html#a3">00117</a>   Float_t <a class="code" href="classAlignFit.html#a3">GetArray</a>(Int_t icase, Int_t ilayr, Int_t type)<span class="keyword"> const </span>{
00118     Int_t idx = <a class="code" href="classAlignFit.html#a2">ArrayIndex</a>(icase, ilayr, type);
00119     <span class="keywordflow">return</span> (<a class="code" href="classAlignFit.html#p2">fArray</a> &amp;&amp; 0 &lt;= idx &amp;&amp; idx &lt; Nbuf) ? <a class="code" href="classAlignFit.html#p2">fArray</a>[idx] : 0;
00120   }
00121 
<a name="l00122"></a><a class="code" href="classAlignFit.html#a4">00122</a>   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a4">SetArray</a>(Int_t icase, Int_t ilayr, Int_t type, Float_t data) {
00123     Int_t idx = <a class="code" href="classAlignFit.html#a2">ArrayIndex</a>(icase, ilayr, type);
00124     <span class="keywordflow">if</span> (<a class="code" href="classAlignFit.html#p2">fArray</a> &amp;&amp; 0 &lt;= idx &amp;&amp; idx &lt; Nbuf) <a class="code" href="classAlignFit.html#p2">fArray</a>[idx] = data;
00125   }
00126 
00127 
00128 
<a name="l00129"></a><a class="code" href="classAlignFit.html#a5">00129</a>   Int_t <a class="code" href="classAlignFit.html#a5">CrrayIndex</a>(Int_t icase, Int_t ilayr)<span class="keyword"> const </span>{
00130     <span class="keywordflow">return</span> (0 &lt;= icase &amp;&amp; icase &lt; <a class="code" href="classAlignFit.html#w10w7">MaxCases</a> &amp;&amp;
00131             0 &lt;= ilayr &amp;&amp; ilayr &lt; Nplan) ? icase*<a class="code" href="classAlignFit.html#w10w0">Nplan</a>+ilayr : -1; 
00132   }
00133 
<a name="l00134"></a><a class="code" href="classAlignFit.html#a6">00134</a>   <span class="keywordtype">char</span> <a class="code" href="classAlignFit.html#a6">GetCrray</a>(Int_t icase, Int_t ilayr)<span class="keyword"> const </span>{
00135     Int_t idx = <a class="code" href="classAlignFit.html#a5">CrrayIndex</a>(icase, ilayr);
00136     <span class="keywordflow">return</span> (<a class="code" href="classAlignFit.html#p3">fCrray</a> &amp;&amp; 0 &lt;= idx &amp;&amp; idx &lt; Ncbf) ? <a class="code" href="classAlignFit.html#p3">fCrray</a>[idx] : 0;
00137   }
00138 
<a name="l00139"></a><a class="code" href="classAlignFit.html#a7">00139</a>   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a7">SetCrray</a>(Int_t icase, Int_t ilayr, <span class="keywordtype">char</span> data) {
00140     Int_t idx = <a class="code" href="classAlignFit.html#a5">CrrayIndex</a>(icase, ilayr);
00141     <span class="keywordflow">if</span> (<a class="code" href="classAlignFit.html#p3">fCrray</a> &amp;&amp; 0 &lt;= idx &amp;&amp; idx &lt; Ncbf) <a class="code" href="classAlignFit.html#p3">fCrray</a>[idx] = data;
00142   }
00143 
00144 
<a name="l00145"></a><a class="code" href="classAlignFit.html#a8">00145</a>   <a class="code" href="classAlignObject.html">AlignObject</a> *<a class="code" href="classAlignFit.html#a8">FindTkId</a>(<span class="keywordtype">int</span> tkid)<span class="keyword"> const </span>{
00146     <a class="code" href="AlignFit_8h.html#a0">aligIT</a> iter = <a class="code" href="classAlignFit.html#p5">aligmap</a>.find(tkid);
00147     <span class="keywordflow">return</span> (iter == <a class="code" href="classAlignFit.html#p5">aligmap</a>.end() ? 0 : iter-&gt;second);
00148   }
00149 
00150   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a9">Init</a>(<span class="keywordtype">void</span>);
00151 
00152   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a10">SetHits</a>(Float_t arr[Ndim][8], Int_t prm[Ndim][8]);
00153 
00154   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a11">Fit</a>(Float_t chi2m, Int_t algo, Float_t xf[2], 
00155            Float_t rigmin, Int_t itermin);
00156 
00157   <span class="keywordtype">void</span> <a class="code" href="classAlignFit.html#a12">Get</a>(Float_t arr[Ndim][8], Int_t what);
00158 
00159   ClassDef(<a class="code" href="classAlignFit.html">AlignFit</a>, 1)  <span class="comment">// Alignment fit</span>
00160 };
00161 
00162 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:04 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
