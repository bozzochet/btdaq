<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TkDBc.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TkDBc.C</h1><a href="TkDBc_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">//  $Id: TkDBc.C,v 1.23 2008/10/23 10:12:39 zuccon Exp $</span>
00002 
00020 
00021 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00022 <span class="preprocessor">#include &lt;cstring&gt;</span>
00023 
<a name="l00024"></a><a class="code" href="classTkDBc.html#s0">00024</a> <a class="code" href="classTkDBc.html">TkDBc</a>* <a class="code" href="classTkDBc.html#s0">TkDBc::Head</a>=0;
00025 
<a name="l00026"></a><a class="code" href="classTkDBc.html#d2">00026</a> <a class="code" href="classTkDBc.html#d2">TkDBc::TkDBc</a>(){
00027  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++)
00028       <a class="code" href="classTkDBc.html#r6">planes</a>[ii]=0; 
00029 }
00030 
<a name="l00031"></a><a class="code" href="classTkDBc.html#e0">00031</a> <span class="keywordtype">void</span> <a class="code" href="classTkDBc.html#e0">TkDBc::CreateTkDBc</a>(<span class="keywordtype">int</span> force_delete){
00032   
00033   <span class="keywordflow">if</span>(force_delete&amp;&amp;TkDBc::Head){
00034     <span class="keyword">delete</span> TkDBc::Head;
00035   }
00036   
00037   <span class="keywordflow">if</span>(!TkDBc::Head){
00038     <a class="code" href="classTkDBc.html#s0">TkDBc::Head</a>=<span class="keyword">new</span> <a class="code" href="classTkDBc.html#d2">TkDBc</a>();
00039 
00040   }
00041   <span class="keywordflow">else</span>{
00042     printf(<span class="stringliteral">"Error a TkDBc instance already exists and \nonly one TkDBc object is allowed (singleton)!! \n"</span> );
00043   }
00044 }
00045 
00046 
00047 
<a name="l00048"></a><a class="code" href="classTkDBc.html#a10">00048</a> <a class="code" href="classTkDBc.html#a10">TkDBc::~TkDBc</a>(){
00049   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++)
00050     <span class="keywordflow">if</span>(<a class="code" href="classTkDBc.html#r6">planes</a>[ii]) <span class="keyword">delete</span> <a class="code" href="classTkDBc.html#r6">planes</a>[ii];
00051   
00052   <span class="keywordflow">for</span> ( <a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin();pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end();++pp)
00053     <span class="keywordflow">if</span>(pp-&gt;second) <span class="keyword">delete</span> pp-&gt;second;
00054 
00055 }
00056 
00057 
<a name="l00058"></a><a class="code" href="classTkDBc.html#a11">00058</a> <span class="keywordtype">void</span> <a class="code" href="classTkDBc.html#a11">TkDBc::init</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *inputfilename, <span class="keywordtype">int</span> pri){
00059   <span class="comment">// get setup</span>
00060     <span class="keywordtype">char</span> name[20];
00061   
00062 
00063     cout&lt;&lt;<span class="stringliteral">"====&gt; TkDBc::init: AMS02 setup selected:"</span>&lt;&lt;endl;
00064 
00065 
00066 
00067 <span class="comment">//----------------------------------------------------------------------------------</span>
00068 <span class="comment">//       Ladder Electronics</span>
00069 <span class="comment">//----------------------------------------------------------------------------------</span>
00070     <span class="comment">// Electronics dimension parameters</span>
00071     <span class="keyword">const</span> number  zelec[3]={ 1.5,6.8, 7.8};
00072     memcpy(<a class="code" href="classTkDBc.html#o23">_zelec</a>,zelec,3*<span class="keyword">sizeof</span>(zelec[0]));
00073 
00074 
00075 
00076 
00077 
00078 <span class="comment">//----------------------------------------------------------------------------------</span>
00079 <span class="comment">//       Silicon Sensors</span>
00080 <span class="comment">//----------------------------------------------------------------------------------</span>
00081 
00082     <span class="keyword">const</span> number  ssize_active[2]={3.9728,7.062};
00083     memcpy(<a class="code" href="classTkDBc.html#o24">_ssize_active</a>,ssize_active,<span class="keyword">sizeof</span>(ssize_active));
00084 
00085 
00086     <span class="keyword">const</span> number  ssize_inactive[2]={4.13600,7.2045};
00087     memcpy(<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>,ssize_inactive,<span class="keyword">sizeof</span>(ssize_inactive));
00088 
00089     
00090     <a class="code" href="classTkDBc.html#o26">_silicon_z</a>=0.03;
00091     
00092     <a class="code" href="classTkDBc.html#o27">_NReadStripK7</a>=224;
00093     <a class="code" href="classTkDBc.html#o28">_NReadStripK5</a>=192;
00094     <a class="code" href="classTkDBc.html#o29">_NReadoutChanS</a>=640;
00095     <a class="code" href="classTkDBc.html#o30">_NReadoutChanK</a>=384;
00096     <a class="code" href="classTkDBc.html#o31">_SensorPitchK</a>=4.140;
00097     <a class="code" href="classTkDBc.html#o32">_PitchS</a>=0.0110;
00098     <a class="code" href="classTkDBc.html#o33">_PitchK5</a>=0.0208;
00099     <a class="code" href="classTkDBc.html#o34">_PitchK7</a>=0.0104;
00100     <a class="code" href="classTkDBc.html#o35">_ImplantPitchK</a>=0.0104;
00101     
00102 
00103 
00104 <span class="comment">//----------------------------------------------------------------------------------</span>
00105 <span class="comment">//         Planes</span>
00106 <span class="comment">//----------------------------------------------------------------------------------</span>
00107 
00108   
00109 <span class="comment">// Estimated from alignment calibration (SH)</span>
00110     <span class="keyword">const</span> number  xposl[nplanes]={-0.05,0,0,0,-0.02};
00111 <span class="comment">//  const number  xposl[nplanes]={0,0,0,0,0};</span>
00112     memcpy(<a class="code" href="classTkDBc.html#o0">_xpos</a>,xposl,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(xposl[0]));
00113 
00114 
00115     <span class="keyword">const</span> number  yposl[nplanes]={0,0,0,0,0};
00116     memcpy(<a class="code" href="classTkDBc.html#o1">_ypos</a>,yposl,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(yposl[0]));
00117 
00118     <span class="keyword">const</span> number  zposl[nplanes]={56.14, 27.53, 0, -27.53, -56.14};
00119     memcpy(<a class="code" href="classTkDBc.html#o2">_zpos</a>,zposl,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(zposl[0]));
00120 
00121     
00122     <span class="keyword">const</span> int16  nslot[nplanes][2]={{0,15},{15,15},{15,15},{15,15},{15,0}};
00123     memcpy(<a class="code" href="classTkDBc.html#o3">_nslot</a>,nslot,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*2*<span class="keyword">sizeof</span>(nslot[0][0]));
00124     
00125     
00126     <span class="comment">// Plane support thickness in cm</span>
00127     <span class="keyword">const</span> number sup_hc_w[nplanes]={  4.0, 1.236, 1.236, 1.236,  4.0 };
00128     memcpy(<a class="code" href="classTkDBc.html#o4">_sup_hc_w</a>, sup_hc_w, <a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(sup_hc_w[0]));
00129 
00130     <span class="comment">// Plane support radius in cm</span>
00131     <span class="keyword">const</span> number sup_hc_r[nplanes]={ 71.5, 53.6, 53.6, 53.6, 71.5 };
00132     memcpy(<a class="code" href="classTkDBc.html#o5">_sup_hc_r</a>, sup_hc_r, <a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(sup_hc_r[0]));
00133 
00134 
00135     <span class="comment">// Plane envelop radius in cm</span>
00136     <span class="keyword">const</span>  <span class="keywordtype">double</span> plane_d1[nplanes] = { 72.0, 54.0, 54.0, 54.0, 72.0 };
00137     memcpy(<a class="code" href="classTkDBc.html#o6">_plane_d1</a>,plane_d1,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(<a class="code" href="classTkDBc.html#o6">_plane_d1</a>[0]));
00138     <span class="comment">// Plane envelop half thickness in cm</span>
00139     <span class="keyword">const</span> <span class="keywordtype">double</span>  plane_d2[nplanes] = {  7.0, 11.0, 11.0, 11.0 ,7.0};
00140     memcpy(<a class="code" href="classTkDBc.html#o7">_plane_d2</a>,plane_d2,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(<a class="code" href="classTkDBc.html#o7">_plane_d2</a>[0]));
00141 
00142 
00144     <span class="keyword">const</span>  <span class="keywordtype">double</span> dz[nplanes]={-4.,0.,0.,0.,+4.};
00145     memcpy(<a class="code" href="classTkDBc.html#o8">_dz</a>,dz,<a class="code" href="namespacetrconst.html#a0">nplanes</a>*<span class="keyword">sizeof</span>(<a class="code" href="classTkDBc.html#o8">_dz</a>[0]));
00146 
00147 <span class="comment">// // Ladder support whickness in cm</span>
00148 <span class="comment">// double TrGeom::sup_foam_w   = 0.5;</span>
00149 <span class="comment">// // Ladder support z-offset in cm</span>
00150 <span class="comment">// double TrGeom::sup_foam_tol = 0.05;</span>
00151 
00152 <span class="comment">//----------------------------------------------------------------------------------</span>
00153 <span class="comment">//            LAYERS</span>
00154 <span class="comment">//----------------------------------------------------------------------------------</span>
00155     <span class="keyword">const</span> <span class="keywordtype">int</span> plane_layer[nlays]={1,2,2,3,3,4,4,5};
00156     memcpy(<a class="code" href="classTkDBc.html#o9">_plane_layer</a>,plane_layer,<a class="code" href="namespacetrconst.html#a1">nlays</a>*<span class="keyword">sizeof</span>(plane_layer[0]));
00157 
00158 
00159 
00160  
00161     
00162     <span class="keyword">const</span> number layer_deltaZ[nlays]={-3.08, 1.698,-2.318, 1.698,-2.318, 2.318,-1.698, 3.08};
00163     memcpy(<a class="code" href="classTkDBc.html#o10">_layer_deltaZ</a>,layer_deltaZ,<a class="code" href="namespacetrconst.html#a1">nlays</a>*<span class="keyword">sizeof</span>(layer_deltaZ[0]));
00164 
00165 
00166 <span class="comment">//----------------------------------------------------------------------------------</span>
00167 <span class="comment">//            LADDERS</span>
00168 <span class="comment">//----------------------------------------------------------------------------------</span>
00169     
00170     <a class="code" href="classTkDBc.html#o12">_ladder_Ypitch</a>      = 7.3  ; <span class="comment">//cm</span>
00171 <span class="comment">//  _ladder_Xseparation = 0.05 ; //cm</span>
00172     <a class="code" href="classTkDBc.html#o15">_ladder_Xseparation</a> = 0.085; <span class="comment">//cm Estimated from alignment calibration (SH)</span>
00173 
00174 
00175     <span class="keyword">const</span> number ladder_offsetX_inner[maxlad]=
00176       <span class="comment">//  1     2     3     4     5      6       7     8     9     10      11      12     13    14    15 //side 0</span>
00177       {   0,    0,-0.025,2.045,-2.095, -0.025, -0.025, 0, -0.025, -0.025,-2.095, 2.045, -0.025,  0,    0};
00178     
00179     memcpy(<a class="code" href="classTkDBc.html#o13">_ladder_offsetX_inner</a>,ladder_offsetX_inner,<a class="code" href="namespacetrconst.html#a3">maxlad</a>*<span class="keyword">sizeof</span>(ladder_offsetX_inner[0]));
00180     
00181     <span class="keyword">const</span> number ladder_offsetX_outer[maxlad]=
00182       <span class="comment">//  1     2     3     4     5      6       7     8     9     10      11      12     13    14    15 //side 0</span>
00183 <span class="comment">//      {   0, 2.045,   0,    0, -2.095,   0,      0,    0,    0,     0, -2.095,      0,     0, +2.045,  0};</span>
00184 <span class="comment">// Estimated from alignment calibration (SH)</span>
00185       {   0, 2.070,   0,    0, -2.070,   0,      0,    0,    0,     0, -2.070,      0,     0, +2.070,  0};
00186 
00187     memcpy(<a class="code" href="classTkDBc.html#o14">_ladder_offsetX_outer</a>,ladder_offsetX_outer,<a class="code" href="namespacetrconst.html#a3">maxlad</a>*<span class="keyword">sizeof</span>(ladder_offsetX_outer[0]));
00188 
00189     <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a4">nlad</a>[2][nlays]={{15,12,11,10,10,11,12,15},{15,12,11,10,10,11,12,15}};    
00190     memcpy(<a class="code" href="classTkDBc.html#o11">_nlad</a>,<a class="code" href="namespacetrconst.html#a4">nlad</a>,2*<a class="code" href="namespacetrconst.html#a1">nlays</a>*<span class="keyword">sizeof</span>(<a class="code" href="namespacetrconst.html#a4">nlad</a>[0][0]));
00191     
00192     <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> nsen[2][nlays][maxlad]={
00193       <span class="comment">//  1     2     3     4     5      6    7     8     9     10    11    12    13    14     15 //side 0</span>
00194       {{ 10  , 12  , 13  , 14  , 14  ,  15 , 15  , 15  , 15  ,  15 ,  14 ,  14 ,  13 ,  12 ,   10}, <span class="comment">//layer1</span>
00195        {  7  , 14  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer2</span>
00196        {  0  , 14  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer3</span>
00197        {  0  ,  0  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer4</span>
00198        {  0  ,  0  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer5</span>
00199        {  0  , 14  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer6</span>
00200        {  7  , 14  ,  9  , 11  , 11  ,  12 , 12  ,  0  , 12  ,  12 ,  11 ,  11 ,   9 ,   0 ,    0}, <span class="comment">//layer7</span>
00201        { 10  , 12  , 13  , 14  , 14  ,  15 , 15  , 15  , 15  ,  15 ,  14 ,  14 ,  13 ,  12 ,   10}, <span class="comment">//layer8</span>
00202       },
00203       <span class="comment">//  1     2     3     4     5      6    7     8     9     10    11    12    13    14     15 //side 1</span>
00204       {{ 10  , 11  , 13  , 14  , 15  ,  15 , 15  , 15  , 15  ,  15 ,  15 ,  14 ,  13 ,  11 ,   10}, <span class="comment">//layer1</span>
00205        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,  14 ,    7}, <span class="comment">//layer2</span>
00206        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,  14 ,    0}, <span class="comment">//layer3</span>
00207        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,   0 ,    0}, <span class="comment">//layer4</span>
00208        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,   0 ,    0}, <span class="comment">//layer5</span>
00209        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,  14 ,    0}, <span class="comment">//layer6</span>
00210        {  0  ,  0  ,  9  , 10  , 12  ,  12 , 12  ,  0  , 12  ,  12 ,  12 ,  10 ,   9 ,  14 ,    7}, <span class="comment">//layer7</span>
00211        { 10  , 11  , 13  , 14  , 15  ,  15 , 15  , 15  , 15  ,  15 ,  15 ,  14 ,  13 ,  11 ,   10}, <span class="comment">//layer8</span>
00212       }
00213 
00214     };
00215     memcpy(<a class="code" href="classTkDBc.html#o16">_nsen</a>,nsen,2*<a class="code" href="namespacetrconst.html#a1">nlays</a>*<a class="code" href="namespacetrconst.html#a3">maxlad</a>*<span class="keyword">sizeof</span>(nsen[0][0][0]));
00216     <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> octid[2][nlays][maxlad]={
00217       <span class="comment">//    1     2     3     4     5      6    7     8     9     10    11    12    13   14     15 //side 0</span>
00218       {{   211,  206,  210,  213,  216,  212, -410,  406, -411,  412,  416,  413,  400,  404,  401, },
00219        {   202,  203,  214,  222,  220, -208,  200,    0, -402,  414,  422,  420,  408,    0,    0, },
00220        {     0,  207,  219,  223,  217, -205,  201,    0, -407,  419,  423,  417,  405,    0,    0, },
00221        {     0,    0,  215,  218,  221, -209,  204,    0, -403,  415,  418,  421,  409,    0,    0, },
00222        {     0,    0,  621,  616,  615, -603,  606,    0, -809,  821,  816,  815,  803,    0,    0, },
00223        {     0,  605,  617,  613,  619, -607,  611,    0, -805,  817,  813,  819,  807,    0,    0, },
00224        {   608,  609,  620,  612,  614, -602,  610,    0, -808,  820,  812,  814,  802,    0,    0, },
00225        {   601,  604,  600,  623,  618,  622, -800,  804, -801,  822,  818,  823,  810,  806,  811, },
00226       },
00227       {{   101,  104,  100,  113,  116, -112,  111, -106,  110, -312,  316,  313,  310,  306,  311, },
00228        {     0,    0,  108,  120,  122, -114, -102,    0,  300, -308,  320,  322,  314,  303,  302, },
00229        {     0,    0,  105,  117,  123, -119, -107,    0,  301, -305,  317,  323,  319,  307,    0, },
00230        {     0,    0,  109,  121,  118, -115, -103,    0,  304, -309,  321,  318,  315,    0,    0, },
00231        {     0,    0,  503,  515,  516, -521, -509,    0,  706, -703,  715,  716,  721,    0,    0, },
00232        {     0,    0,  507,  519,  513, -517, -505,    0,  711, -707,  719,  713,  717,  705,    0, },
00233        {     0,    0,  502,  514,  512, -520, -508,    0,  710, -702,  714,  712,  720,  709,  708, },
00234        {   511,  506,  510,  523,  518, -522, -501,  504,  500, -722,  718,  723,  700,  704,  701, },
00235       },
00236     };
00237 
00238     memcpy(<a class="code" href="classTkDBc.html#o19">_octid</a>,octid,2*<a class="code" href="namespacetrconst.html#a1">nlays</a>*<a class="code" href="namespacetrconst.html#a3">maxlad</a>*<span class="keyword">sizeof</span>(octid[0][0][0]));
00239 
00240 
00241     <span class="keyword">const</span> <span class="keywordtype">char</span> LadName[2][nlays][maxlad][9]={
00242       {{  <span class="stringliteral">"L10AO151"</span>, <span class="stringliteral">"L12SO181"</span>, <span class="stringliteral">"L13AO073"</span>, <span class="stringliteral">"L14AO123"</span>, <span class="stringliteral">"L14AO125"</span>, <span class="stringliteral">"L15SO180"</span>, <span class="stringliteral">"L15AN101"</span>, <span class="stringliteral">"L15AO173"</span>, <span class="stringliteral">"L15AN100"</span>, <span class="stringliteral">"L15AO093"</span>, <span class="stringliteral">"L14AO159"</span>, <span class="stringliteral">"L14AO160"</span>, <span class="stringliteral">"L13AO114"</span>, <span class="stringliteral">"L12AO107"</span>, <span class="stringliteral">"L10AO145"</span>, },
00243        {  <span class="stringliteral">"L07PI002"</span>, <span class="stringliteral">"L14AI031"</span>, <span class="stringliteral">"L09GI003"</span>, <span class="stringliteral">"L11GI004"</span>, <span class="stringliteral">"L11GI008"</span>, <span class="stringliteral">"L12AH024"</span>, <span class="stringliteral">"L12AI004"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AH029"</span>, <span class="stringliteral">"L12AI005"</span>, <span class="stringliteral">"L11GI009"</span>, <span class="stringliteral">"L11GI016"</span>, <span class="stringliteral">"L09GI010"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00244        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"L14AI032"</span>, <span class="stringliteral">"L09AI139"</span>, <span class="stringliteral">"L11AI127"</span>, <span class="stringliteral">"L11AI140"</span>, <span class="stringliteral">"L12AJ055"</span>, <span class="stringliteral">"L12AJ038"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AJ054"</span>, <span class="stringliteral">"L12SI182"</span>, <span class="stringliteral">"L11SI176"</span>, <span class="stringliteral">"L11AI126"</span>, <span class="stringliteral">"L09SI164"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00245        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09GI005"</span>, <span class="stringliteral">"L11GI017"</span>, <span class="stringliteral">"L11AI082"</span>, <span class="stringliteral">"L12AH060"</span>, <span class="stringliteral">"L12AI048"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AH059"</span>, <span class="stringliteral">"L12AI064"</span>, <span class="stringliteral">"L11AI083"</span>, <span class="stringliteral">"L11AI081"</span>, <span class="stringliteral">"L09AI076"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00246        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09AI090"</span>, <span class="stringliteral">"L11AI087"</span>, <span class="stringliteral">"L11AI085"</span>, <span class="stringliteral">"L12AJ034"</span>, <span class="stringliteral">"L12AI049"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AJ053"</span>, <span class="stringliteral">"L12AI017"</span>, <span class="stringliteral">"L11AI086"</span>, <span class="stringliteral">"L11AI143"</span>, <span class="stringliteral">"L09AI092"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00247        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"L14AI041"</span>, <span class="stringliteral">"L09AI089"</span>, <span class="stringliteral">"L11AI084"</span>, <span class="stringliteral">"L11GI001"</span>, <span class="stringliteral">"L12AH030"</span>, <span class="stringliteral">"L12AI067"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AH028"</span>, <span class="stringliteral">"L12SI170"</span>, <span class="stringliteral">"L11AI141"</span>, <span class="stringliteral">"L11AI104"</span>, <span class="stringliteral">"L09GI012"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00248        {  <span class="stringliteral">"L07PI003"</span>, <span class="stringliteral">"L14AI040"</span>, <span class="stringliteral">"L09AI103"</span>, <span class="stringliteral">"L11AI128"</span>, <span class="stringliteral">"L11AI088"</span>, <span class="stringliteral">"L12AJ020"</span>, <span class="stringliteral">"L12AI007"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AJ056"</span>, <span class="stringliteral">"L12AI130"</span>, <span class="stringliteral">"L11AI134"</span>, <span class="stringliteral">"L11AI142"</span>, <span class="stringliteral">"L09PI010"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00249        {  <span class="stringliteral">"L10AO144"</span>, <span class="stringliteral">"L12AO105"</span>, <span class="stringliteral">"L13AO026"</span>, <span class="stringliteral">"L14AO119"</span>, <span class="stringliteral">"L14AO120"</span>, <span class="stringliteral">"L15AO175"</span>, <span class="stringliteral">"L15AP098"</span>, <span class="stringliteral">"L15AO097"</span>, <span class="stringliteral">"L15AP110"</span>, <span class="stringliteral">"L15AO095"</span>, <span class="stringliteral">"L14AO122"</span>, <span class="stringliteral">"L14AO124"</span>, <span class="stringliteral">"L13AO074"</span>, <span class="stringliteral">"L12AO106"</span>, <span class="stringliteral">"L10AO148"</span>, },
00250       },
00251       {{  <span class="stringliteral">"L10AO149"</span>, <span class="stringliteral">"L11AO154"</span>, <span class="stringliteral">"L13AO071"</span>, <span class="stringliteral">"L14AO156"</span>, <span class="stringliteral">"L15AO163"</span>, <span class="stringliteral">"L15AN113"</span>, <span class="stringliteral">"L15AO177"</span>, <span class="stringliteral">"L15AP109"</span>, <span class="stringliteral">"L15AO174"</span>, <span class="stringliteral">"L15AP099"</span>, <span class="stringliteral">"L15AO115"</span>, <span class="stringliteral">"L14AO158"</span>, <span class="stringliteral">"L13AO025"</span>, <span class="stringliteral">"L11AO153"</span>, <span class="stringliteral">"L10AO150"</span>, },
00252        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09GI006"</span>, <span class="stringliteral">"L10PI005"</span>, <span class="stringliteral">"L12AI001"</span>, <span class="stringliteral">"L12AH057"</span>, <span class="stringliteral">"L12AJ021"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AI006"</span>, <span class="stringliteral">"L12AJ051"</span>, <span class="stringliteral">"L12AI003"</span>, <span class="stringliteral">"L10GI014"</span>, <span class="stringliteral">"L09GI013"</span>, <span class="stringliteral">"L14AI042"</span>, <span class="stringliteral">"L07PI004"</span>, },
00253        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09GI011"</span>, <span class="stringliteral">"L10PI001"</span>, <span class="stringliteral">"L12AI012"</span>, <span class="stringliteral">"L12AJ033"</span>, <span class="stringliteral">"L12SH169"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12SI167"</span>, <span class="stringliteral">"L12AH058"</span>, <span class="stringliteral">"L12AI016"</span>, <span class="stringliteral">"L10PI008"</span>, <span class="stringliteral">"L09GI002"</span>, <span class="stringliteral">"L14AI044"</span>, <span class="stringliteral">"        "</span>, },
00254        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09AI075"</span>, <span class="stringliteral">"L10AI079"</span>, <span class="stringliteral">"L12AI015"</span>, <span class="stringliteral">"L12AH061"</span>, <span class="stringliteral">"L12AJ018"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AI063"</span>, <span class="stringliteral">"L12AJ019"</span>, <span class="stringliteral">"L12AI065"</span>, <span class="stringliteral">"L10GI015"</span>, <span class="stringliteral">"L09AI077"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00255        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09AI138"</span>, <span class="stringliteral">"L10PI009"</span>, <span class="stringliteral">"L12AI132"</span>, <span class="stringliteral">"L12AJ022"</span>, <span class="stringliteral">"L12AH035"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AI131"</span>, <span class="stringliteral">"L12AH036"</span>, <span class="stringliteral">"L12AI066"</span>, <span class="stringliteral">"L10PI013"</span>, <span class="stringliteral">"L09AI136"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, },
00256        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09AI135"</span>, <span class="stringliteral">"L10AI080"</span>, <span class="stringliteral">"L12AH062"</span>, <span class="stringliteral">"L12AH037"</span>, <span class="stringliteral">"L12AJ023"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12SI171"</span>, <span class="stringliteral">"L12AJ052"</span>, <span class="stringliteral">"L12SI168"</span>, <span class="stringliteral">"L10AI078"</span>, <span class="stringliteral">"L09PI012"</span>, <span class="stringliteral">"L14AI043"</span>, <span class="stringliteral">"        "</span>, },
00257        {  <span class="stringliteral">"        "</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L09AI091"</span>, <span class="stringliteral">"L10PI011"</span>, <span class="stringliteral">"L12AI133"</span>, <span class="stringliteral">"L12AJ047"</span>, <span class="stringliteral">"L12AH045"</span>, <span class="stringliteral">"        "</span>, <span class="stringliteral">"L12AI068"</span>, <span class="stringliteral">"L12AH046"</span>, <span class="stringliteral">"L12AI050"</span>, <span class="stringliteral">"L10PI007"</span>, <span class="stringliteral">"L09AI102"</span>, <span class="stringliteral">"L14AI039"</span>, <span class="stringliteral">"L07PI006"</span>, },
00258        {  <span class="stringliteral">"L10AO147"</span>, <span class="stringliteral">"L11AO155"</span>, <span class="stringliteral">"L13AO072"</span>, <span class="stringliteral">"L14AO121"</span>, <span class="stringliteral">"L15AO116"</span>, <span class="stringliteral">"L15AP112"</span>, <span class="stringliteral">"L15AO162"</span>, <span class="stringliteral">"L15AN117"</span>, <span class="stringliteral">"L15AO096"</span>, <span class="stringliteral">"L15AN118"</span>, <span class="stringliteral">"L15SO178"</span>, <span class="stringliteral">"L14AO157"</span>, <span class="stringliteral">"L13AO111"</span>, <span class="stringliteral">"L11SO165"</span>, <span class="stringliteral">"L10AO146"</span>, },
00259       },
00260     };
00261     
00262     memcpy(<a class="code" href="classTkDBc.html#o18">_LadName</a>,LadName,2*<a class="code" href="namespacetrconst.html#a1">nlays</a>*<a class="code" href="namespacetrconst.html#a3">maxlad</a>*9*<span class="keyword">sizeof</span>(LadName[0][0][0][0]));
00263 
00264     
00265 
00266 
00267 <span class="comment">//---------------- Crate to Octant to JinJ cable connection --------------</span>
00268     
00269 
00270 
00271     <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> octant_crate[8]={0,1,3,2,4,5,7,6};
00272     memcpy(<a class="code" href="classTkDBc.html#o20">_octant_crate</a>,octant_crate,8*<span class="keyword">sizeof</span>(octant_crate[0]));
00273 
00274     <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> octant_JinJ[8]={3,9,1,0,16,17,23,22};
00275     memcpy(<a class="code" href="classTkDBc.html#o21">_octant_JinJ</a>,octant_JinJ,8*<span class="keyword">sizeof</span>(octant_crate[0]));
00276 
00277     <span class="keyword">const</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> octant_JMDC[8][4]=    
00278       {{166,  167, 168, 169},
00279        {170,  171, 172, 173},
00280        {178,  179, 180, 181},
00281        {174,  175, 176, 177},
00282        {182,  183, 184, 185},
00283        {186,  187, 188, 189},
00284        {194,  195, 196, 197},
00285        {190,  191, 192, 193}};
00286     memcpy(<a class="code" href="classTkDBc.html#o22">_octant_JMDC</a>,octant_JMDC,8*4*<span class="keyword">sizeof</span>(octant_JMDC[0][0]));
00287 
00288     
00289 
00290 
00291     <span class="comment">//  Read or Generate the Geometry</span>
00292 
00293     <span class="keywordtype">int</span> ret = 0;
00294     <span class="keywordflow">if</span> (inputfilename) {
00295       ret = <a class="code" href="classTkDBc.html#a13">read</a>(inputfilename);
00296       <span class="keywordflow">if</span> (ret == -1) { 
00297         cerr&lt;&lt;<span class="stringliteral">"TkDBc:: FATAL Cannot open the requested Geometry file "</span>&lt;&lt; inputfilename&lt;&lt;endl;
00298         exit(2);
00299       }
00300     }
00301     <span class="keywordflow">else</span>{ <span class="comment">// generate the geometry</span>
00302 
00303       cerr &lt;&lt;<span class="stringliteral">" TkDBc:: Generating the Tracker geometry from nominal positions!"</span>&lt;&lt;endl;
00304       <span class="comment">//create the planes objects</span>
00305       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++){
00306         sprintf(name,<span class="stringliteral">"Plane%d"</span>,ii+1);
00307         <a class="code" href="classTkDBc.html#r6">planes</a>[ii]=<span class="keyword">new</span> <a class="code" href="namespaceROOT_1_1Shadow.html#a1">TkPlane</a>(name,ii+1,<a class="code" href="classTkDBc.html#o3">_nslot</a>[ii]);
00308         <a class="code" href="classTkDBc.html#r6">planes</a>[ii]-&gt;<a class="code" href="classTkObject.html#a3">setpos</a>(<a class="code" href="classTkDBc.html#o0">_xpos</a>[ii],<a class="code" href="classTkDBc.html#o1">_ypos</a>[ii],<a class="code" href="classTkDBc.html#o2">_zpos</a>[ii]);
00309 <span class="comment">//       cout &lt;&lt;*(planes[ii])&lt;&lt;endl;</span>
00310       }
00311       
00312       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> lay=0;lay&lt;8;lay++) <span class="comment">//loop on layers</span>
00313         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> side=0;side&lt;2;side++)
00314           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> slot=0;slot&lt;maxlad;slot++)
00315             <span class="keywordflow">if</span>(<a class="code" href="classTkDBc.html#a4">filled_slot</a>(side,lay,slot)){
00316               <span class="keywordtype">int</span> oct=<a class="code" href="classTkDBc.html#d1">GetOctant</a>(side,lay+1,slot+1);
00317               <span class="keywordtype">int</span> hwid=abs(octid[side][lay][slot])-(100*(oct))+(<a class="code" href="classTkDBc.html#o20">_octant_crate</a>[oct-1]*100);
00318               <span class="keywordtype">int</span> tkid=(lay+1)*100+(slot+1);
00319               <span class="keywordtype">int</span> pgid=<a class="code" href="classTkDBc.html#o17">_pgid</a>[side][lay][slot];
00320               <span class="keywordflow">if</span> (side==0) tkid*=-1;
00321               sprintf(name,<span class="stringliteral">"%s"</span>,LadName[side][lay][slot]);
00322               <a class="code" href="classTkLadder.html">TkLadder</a>* aa= <span class="keyword">new</span> <a class="code" href="namespaceROOT_1_1Shadow.html#a2">TkLadder</a>(<a class="code" href="classTkDBc.html#r6">planes</a>[<a class="code" href="classTkDBc.html#o9">_plane_layer</a>[lay]-1],name,tkid,hwid,nsen[side][lay][slot]);
00323               <span class="keywordflow">if</span>(octid[side][lay][slot]&lt;0) aa-&gt;<a class="code" href="classTkLadder.html#a19">SetLaserFlag</a>();
00324               number posz= <a class="code" href="classTkDBc.html#o10">_layer_deltaZ</a>[lay];
00325               number posy= <a class="code" href="classTkDBc.html#a0">GetSlotY</a>(lay+1,slot+1,side);
00326               number posx= <a class="code" href="classTkDBc.html#a1">GetSlotX</a>(lay+1,slot+1,side);
00327               aa-&gt;<a class="code" href="classTkObject.html#a3">setpos</a>(posx,posy,posz);
00328               aa-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.Reset();
00329               
00330               <span class="comment">// Rotation along X-axis</span>
00331               <span class="keywordflow">if</span>(lay%2==0) {
00332                 aa-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.YParity(); 
00333                 aa-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.ZParity(); 
00334               }
00335               <span class="comment">// Rotation along Z-axis</span>
00336               <span class="keywordflow">if</span>(side) {
00337                 aa-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.XParity(); 
00338                 aa-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.YParity(); 
00339               }
00340               
00341               
00342               <a class="code" href="classTkDBc.html#r0">tkassemblymap</a>[aa-&gt;<a class="code" href="classTkLadder.html#a14">GetAssemblyId</a>()]=aa;
00343               <a class="code" href="classTkDBc.html#r1">tkidmap</a>[tkid]=aa;
00344               <a class="code" href="classTkDBc.html#r2">hwidmap</a>[hwid]=aa;
00345               <a class="code" href="classTkDBc.html#r3">pgidmap</a>[pgid]=aa;
00346               string bb=name;
00347               <a class="code" href="classTkDBc.html#r4">lnamemap</a>[bb]=aa;
00348               <a class="code" href="classTkDBc.html#r5">JMDCNumMap</a>[aa-&gt;<a class="code" href="classTkLadder.html#a13">GetJMDCNum</a>()]=aa;
00349 <span class="comment">//            cout &lt;&lt;"layer "&lt;&lt;lay+1&lt;&lt;" slot  "&lt;&lt;slot+1&lt;&lt;"  side "&lt;&lt;side&lt;&lt;" tkid "&lt;&lt;tkid&lt;&lt;" hwid "&lt;&lt; aa-&gt;GetHwId()&lt;&lt;aa-&gt;GetPos()&lt;&lt;endl;</span>
00350             }
00351     }
00352 
00353     
00354   <span class="comment">//   for (tkidIT pp=tkidmap.begin(); pp!=tkidmap.end();++pp){</span>
00355 <span class="comment">//       cout&lt;&lt;*(pp-&gt;second)&lt;&lt;endl;</span>
00356 <span class="comment">//}</span>
00357 
00358     <span class="keywordflow">return</span>;
00359 }
00360 
00361 
<a name="l00362"></a><a class="code" href="classTkDBc.html#a0">00362</a> number <a class="code" href="classTkDBc.html#a0">TkDBc::GetSlotY</a>(<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> slot,<span class="keywordtype">int</span> side){
00363   number ladpitch= _ladder_Ypitch;
00364   number ladder_Ygap= <a class="code" href="classTkDBc.html#o12">_ladder_Ypitch</a> - <a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[1];
00365 
00366   <span class="comment">//Y coo of  the first S/p readout channel for the ladder on slot 9 X negative</span>
00367   <span class="comment">// 0.5 ladder_Ygap + distance from first readout channel to near ladder edge</span>
00368   number distXN = (_ssize_inactive[1]-<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1])/2 + 0.5 * ladder_Ygap;
00369 
00370   <span class="comment">//Y coo of  the first S/p readout channel for the ladder on slot 9 X positive</span>
00371   <span class="comment">// 0.5 ladder_Ygap + distance from first readout channel to far ladder edge</span>
00372   number distXF = _ssize_inactive[1]-(_ssize_inactive[1]-<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1])/2 + 0.5 * ladder_Ygap;
00373 
00374   number distX2=<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]/2.;
00375   
00376 <span class="comment">//   printf("  _ladder_Ypitch %f\n", _ladder_Ypitch );</span>
00377 <span class="comment">//   printf(" ladpitch %f ladder_Ygap %f distXN %f distXF  %f \n",_ladder_Ypitch,ladder_Ygap,distXN,distXF);</span>
00378   <span class="keywordflow">if</span>( layer==2||layer==4||layer==6){
00379     <span class="keywordflow">if</span>(side==0){
00380       <span class="keywordflow">if</span>(abs(slot)&lt;8)      <span class="keywordflow">return</span> -distXF+ ladpitch*(8-slot);
00381       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(slot)&gt;8) <span class="keywordflow">return</span> -distXF+ ladpitch*(9-slot);
00382       <span class="keywordflow">else</span> <span class="keywordflow">return</span> -8888;
00383     }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (side==1){
00384       <span class="keywordflow">if</span>(abs(slot)&lt;8)      <span class="keywordflow">return</span> -distXN+ ladpitch*(8-slot);
00385       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(slot)&gt;8) <span class="keywordflow">return</span> -distXN+ ladpitch*(9-slot);
00386       <span class="keywordflow">else</span> <span class="keywordflow">return</span> -8888;
00387     } <span class="keywordflow">else</span> <span class="keywordflow">return</span> -9999;
00388   }
00389 
00390 
00391   <span class="keywordflow">if</span>( layer==3||layer==5||layer==7){
00392     <span class="keywordflow">if</span>(side==0){
00393       <span class="keywordflow">if</span>(abs(slot)&lt;8)      <span class="keywordflow">return</span> -distXN+ ladpitch*(8-slot);
00394       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(slot)&gt;8) <span class="keywordflow">return</span> -distXN+ ladpitch*(9-slot);
00395       <span class="keywordflow">else</span> <span class="keywordflow">return</span> -8888;
00396     }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (side==1){
00397       <span class="keywordflow">if</span>(abs(slot)&lt;8)      <span class="keywordflow">return</span> -distXF+ ladpitch*(8-slot);
00398       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(abs(slot)&gt;8) <span class="keywordflow">return</span> -distXF+ ladpitch*(9-slot);
00399       <span class="keywordflow">else</span> <span class="keywordflow">return</span> -8888;
00400     } <span class="keywordflow">else</span> <span class="keywordflow">return</span> -9999;
00401   }
00402   
00403     
00404   <span class="keywordflow">if</span>(layer==1&amp;&amp;side==0) 
00405     <span class="keywordflow">return</span> distX2 + ladpitch*(8-slot);
00406   
00407   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(layer==1&amp;&amp;side==1) 
00408     <span class="keywordflow">return</span> -distX2 + ladpitch*(8-slot);
00409   
00410   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(layer==8&amp;&amp;side==0) 
00411     <span class="keywordflow">return</span> -distX2 + ladpitch*(8-slot);
00412   
00413   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(layer==8&amp;&amp;side==1) 
00414     <span class="keywordflow">return</span> distX2 + ladpitch*(8-slot);
00415   <span class="keywordflow">else</span> <span class="keywordflow">return</span> -9999;
00416       
00417 
00418 
00419 }
00420 
00421 
<a name="l00422"></a><a class="code" href="classTkDBc.html#a1">00422</a> number <a class="code" href="classTkDBc.html#a1">TkDBc::GetSlotX</a>(<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> slot,<span class="keywordtype">int</span> side){
00423 
00424   <span class="keywordtype">int</span> sensors=<a class="code" href="classTkDBc.html#o16">_nsen</a>[side][layer-1][slot-1];
00425   <span class="keywordflow">if</span>(sensors==0) <span class="keywordflow">return</span> 8888;
00426 
00427   <span class="comment">// (N-1)*sensor pitch  X+ sensor_size -  the distance between the first readout channelX and the sensor edge</span>
00428   number lenght=(sensors-1)*(<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]+0.004)+<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]- (<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0] - <a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])/2.;
00429   <span class="keywordflow">if</span>(side==0) lenght*=-1;
00430 
00431   <span class="keywordflow">if</span>(layer&gt;1&amp;&amp; layer&lt;8){
00432     <span class="comment">// Estimated from alignment calibration (SH)</span>
00433     number xtmp = (layer==2 || layer==3) ? -0.02 : 0;
00434     <span class="keywordflow">if</span> (layer==3 &amp;&amp; side==1 &amp;&amp; slot&gt;8) xtmp += 0.02;
00435 
00436     <span class="keywordflow">if</span>(slot==1||slot==2||slot==14||slot==15)
00437     { <span class="comment">// Estimated from alignment calibration (SH)</span>
00438       number offs = (slot==1) ? 0.08 : (slot==2) ? 0.06 : (slot==14) ? 0.06 : 0;
00439       <span class="keywordflow">return</span> (lenght-(<a class="code" href="classTkDBc.html#o25">_ssize_inactive</a>[0]-<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0])/2)/2+offs;
00440     }
00441     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( slot&gt;2&amp;&amp;slot&lt;14){
00442       <span class="keywordflow">return</span>  lenght + <a class="code" href="classTkDBc.html#o13">_ladder_offsetX_inner</a>[slot-1]+side*<a class="code" href="classTkDBc.html#o15">_ladder_Xseparation</a>+side*xtmp;
00443 
00444     }<span class="keywordflow">else</span> <span class="keywordflow">return</span> -9999;
00445   }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( layer==1||layer==8){
00446     <span class="comment">// Estimated from alignment calibration (SH)</span>
00447     <span class="keywordflow">return</span> lenght + <a class="code" href="classTkDBc.html#o14">_ladder_offsetX_outer</a>[slot-1]+side*<a class="code" href="classTkDBc.html#o15">_ladder_Xseparation</a>*1.1;
00448   }
00449   <span class="keywordflow">else</span>  <span class="keywordflow">return</span> -9999;
00450   
00451 }
00452 
00453 <span class="preprocessor">#include &lt;fstream&gt;</span>
00454 
<a name="l00455"></a><a class="code" href="classTkDBc.html#a12">00455</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a12">TkDBc::write</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename){
00456 
00457   ofstream  fileout(filename);
00458   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++)
00459     fileout&lt;&lt;*(<a class="code" href="classTkDBc.html#r6">planes</a>[ii]);
00460   <span class="keywordflow">for</span> (<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); ++pp)
00461     fileout &lt;&lt; *(pp-&gt;second);
00462 
00463   fileout.close();
00464   <span class="keywordflow">return</span> 0;
00465 
00466 }
00467 
<a name="l00468"></a><a class="code" href="classTkDBc.html#a13">00468</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a13">TkDBc::read</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keywordtype">int</span> pri){
00469   <a class="code" href="classTkLadder.html">TkLadder</a> *aa;
00470   ifstream  fileout(filename);
00471   <span class="keywordflow">if</span> (!fileout) {
00472     printf(<span class="stringliteral">"Error: tkdbc file not found: %s\n"</span>, filename);
00473     <span class="keywordflow">return</span> -1;
00474   }
00475   
00476   <span class="comment">// Delete existing planes</span>
00477   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++)
00478     <span class="keywordflow">if</span>(<a class="code" href="classTkDBc.html#r6">planes</a>[ii]) <span class="keyword">delete</span> <a class="code" href="classTkDBc.html#r6">planes</a>[ii];
00479   
00480   <span class="comment">// Delete existing ladders</span>
00481   <span class="keywordflow">for</span> ( <a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin();pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end();++pp)
00482     <span class="keywordflow">if</span>(pp-&gt;second) <span class="keyword">delete</span> pp-&gt;second;
00483 
00484   <span class="comment">// Clear maps</span>
00485   <a class="code" href="classTkDBc.html#r1">tkidmap</a>.clear();
00486   <a class="code" href="classTkDBc.html#r2">hwidmap</a>.clear();
00487   <a class="code" href="classTkDBc.html#r4">lnamemap</a>.clear();
00488 
00489   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++){
00490     <a class="code" href="classTkDBc.html#r6">planes</a>[ii]= <span class="keyword">new</span> <a class="code" href="namespaceROOT_1_1Shadow.html#a1">TkPlane</a>();
00491     
00492     fileout&gt;&gt;(*<a class="code" href="classTkDBc.html#r6">planes</a>[ii]);
00493   }
00494   <span class="keywordtype">int</span> count=0;
00495   <span class="keywordflow">for</span>(;;){
00496     aa= <span class="keyword">new</span> <a class="code" href="namespaceROOT_1_1Shadow.html#a2">TkLadder</a>();
00497     fileout &gt;&gt;(*aa);
00498     <span class="keywordflow">if</span>(fileout.eof()){ <span class="keyword">delete</span> aa; <span class="keywordflow">break</span>;}
00499     <span class="keywordflow">if</span>(!fileout.good()) cerr &lt;&lt;<span class="stringliteral">" Error in TkDBc::read the channel is not good"</span>&lt;&lt;endl;
00500     <a class="code" href="classTkDBc.html#r1">tkidmap</a>[aa-&gt;GetTkId()]=aa;
00501     <a class="code" href="classTkDBc.html#r2">hwidmap</a>[aa-&gt;GetHwId()]=aa;
00502     string bb=aa-&gt;<a class="code" href="classTkObject.html#o0">name</a>;
00503     <a class="code" href="classTkDBc.html#r4">lnamemap</a>[bb]=aa;
00504 
00505     aa-&gt;<a class="code" href="classTkLadder.html#o6">_plane</a>=<a class="code" href="classTkDBc.html#a16">GetPlane</a>(<a class="code" href="classTkDBc.html#o9">_plane_layer</a>[aa-&gt;GetLayer()-1]);
00506 
00507     count++;
00508     <span class="keywordflow">if</span> (pri) cout&lt;&lt;*aa&lt;&lt;endl;
00509 
00510 
00511   }
00512   cout &lt;&lt; count &lt;&lt;<span class="stringliteral">" Ladders have been read from file "</span>&lt;&lt;filename&lt;&lt;endl;
00513 
00514   fileout.close();
00515   <span class="keywordflow">return</span> 0;
00516 
00517 }
00518 
00519 
00520 <span class="comment">// looping methods</span>
<a name="l00521"></a><a class="code" href="classTkDBc.html#a18">00521</a> <a class="code" href="classTkLadder.html">TkLadder</a>* <a class="code" href="classTkDBc.html#a18">TkDBc::GetEntry</a>(<span class="keywordtype">int</span> ii) {
00522   <span class="keywordtype">int</span> count = 0;
00523   <span class="keywordflow">for</span>(<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); pp++) {
00524     <span class="keywordflow">if</span> (count==ii) <span class="keywordflow">return</span> &amp;(*pp-&gt;second);
00525     count++;
00526   }
00527   <span class="keywordflow">return</span> 0;
00528 }
00529 
<a name="l00530"></a><a class="code" href="classTkDBc.html#a19">00530</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a19">TkDBc::Entry2TkId</a>(<span class="keywordtype">int</span> ii) {
00531   <span class="keywordtype">int</span> count = 0;
00532   <span class="keywordflow">for</span>(<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); pp++) {
00533     <span class="keywordflow">if</span> (count==ii) <span class="keywordflow">return</span> (pp-&gt;first);
00534     count++;
00535   }
00536   <span class="keywordflow">return</span> 0;
00537 }
00538 
<a name="l00539"></a><a class="code" href="classTkDBc.html#a20">00539</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a20">TkDBc::TkId2Entry</a>(<span class="keywordtype">int</span> TkId) {
00540   <span class="keywordtype">int</span> count = 0;
00541   <span class="keywordflow">for</span>(<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); pp++) {
00542     <span class="keywordflow">if</span> (TkId==(pp-&gt;first)) <span class="keywordflow">return</span> count;
00543     count++;
00544   }
00545   <span class="keywordflow">return</span> 0;
00546 }
00547 
00548 
<a name="l00549"></a><a class="code" href="classTkDBc.html#d1">00549</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#d1">TkDBc::GetOctant</a>(<span class="keywordtype">int</span> side,<span class="keywordtype">int</span> layer,<span class="keywordtype">int</span> slot){
00550 
00551   <span class="keywordflow">if</span>(slot&lt;1||slot&gt;15||side&gt;1||side&lt;0) <span class="keywordflow">return</span> -9999;
00552 
00553   <span class="keywordflow">if</span>(layer==1){
00554     <span class="keywordflow">if</span>(side==0){
00555       <span class="keywordflow">if</span>(slot&gt;=7) <span class="keywordflow">return</span> 4;
00556       <span class="keywordflow">if</span>(slot &lt;7) <span class="keywordflow">return</span> 2;
00557     } 
00558     <span class="keywordflow">else</span> {
00559       <span class="keywordflow">if</span>(slot&lt;=9) <span class="keywordflow">return</span> 1;
00560       <span class="keywordflow">if</span>(slot &gt;9) <span class="keywordflow">return</span> 3;
00561     }
00562   }
00563 
00564   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(layer==8){
00565     <span class="keywordflow">if</span>(side==0){
00566       <span class="keywordflow">if</span>(slot&gt;=7) <span class="keywordflow">return</span> 8;
00567       <span class="keywordflow">if</span>(slot &lt;7) <span class="keywordflow">return</span> 6;
00568     } 
00569     <span class="keywordflow">else</span> {
00570       <span class="keywordflow">if</span>(slot&lt;=9) <span class="keywordflow">return</span> 5;
00571       <span class="keywordflow">if</span>(slot &gt;9) <span class="keywordflow">return</span> 7;
00572     }
00573   }
00574   
00575   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (layer==2 ||layer==3 ||layer==4){
00576     <span class="keywordflow">if</span>(slot==8)  <span class="keywordflow">return</span> -9999;
00577 
00578     <span class="keywordflow">if</span>(slot&lt;=7 &amp;&amp; side==0) <span class="keywordflow">return</span> 2;  
00579     <span class="keywordflow">if</span>(slot&gt;=9 &amp;&amp; side==0) <span class="keywordflow">return</span> 4;
00580     
00581     <span class="keywordflow">if</span>(slot&gt;=9 &amp;&amp; side==1) <span class="keywordflow">return</span> 3;
00582     <span class="keywordflow">if</span>(slot&lt;=7 &amp;&amp; side==1) <span class="keywordflow">return</span> 1; 
00583   }
00584 
00585   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (layer==5 ||layer==6 ||layer==7){
00586     <span class="keywordflow">if</span>(slot==8)  <span class="keywordflow">return</span> -9999;
00587   
00588     <span class="keywordflow">if</span>(slot&gt;=9 &amp;&amp; side==0) <span class="keywordflow">return</span> 8; 
00589     <span class="keywordflow">if</span>(slot&lt;=7 &amp;&amp; side==0) <span class="keywordflow">return</span> 6; 
00590     <span class="keywordflow">if</span>(slot&gt;=9 &amp;&amp; side==1) <span class="keywordflow">return</span> 7;
00591     <span class="keywordflow">if</span>(slot&lt;=7 &amp;&amp; side==1) <span class="keywordflow">return</span> 5; 
00592   }
00593   
00594   <span class="keywordflow">return</span> -9999;
00595   
00596   
00597 }
00598 
00599 
00600 
<a name="l00601"></a><a class="code" href="classTkDBc.html#d0">00601</a> <a class="code" href="classTkLadder.html">TkLadder</a>* <a class="code" href="classTkDBc.html#d0">TkDBc::Findmap</a>(map&lt;int,TkLadder*&gt; &amp; tkmap, <span class="keywordtype">int</span> key){
00602   <a class="code" href="TkDBc_8h.html#a9">tkidIT</a> iter=tkmap.find(key);
00603   <span class="keywordflow">return</span> (iter== tkmap.end()?0:iter-&gt;second);
00604   
00605 }
00606 
<a name="l00607"></a><a class="code" href="classTkDBc.html#a25">00607</a> <a class="code" href="classTkLadder.html">TkLadder</a>* <a class="code" href="classTkDBc.html#a25">TkDBc::FindLadName</a>( string&amp; name){
00608   <a class="code" href="TkDBc_8h.html#a10">lnameIT</a> iter=<a class="code" href="classTkDBc.html#r4">lnamemap</a>.find(name);
00609   <span class="keywordflow">return</span> (iter== <a class="code" href="classTkDBc.html#r4">lnamemap</a>.end()?0:iter-&gt;second);
00610   
00611 }
00612 
00613 
<a name="l00614"></a><a class="code" href="classTkDBc.html#a6">00614</a> <span class="keywordtype">char</span> * <a class="code" href="classTkDBc.html#a6">TkDBc::GetCratePos</a>(<span class="keywordtype">int</span> crate){
00615   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;8;ii++){
00616     <span class="keywordflow">if</span>(<a class="code" href="classTkDBc.html#o20">_octant_crate</a>[ii]==crate)
00617       <span class="keywordflow">return</span> <a class="code" href="classTkDBc.html#a5">GetOctName</a>(ii+1);
00618   }
00619   <span class="keywordflow">return</span> 0;
00620 }
<a name="l00621"></a><a class="code" href="classTkDBc.html#a5">00621</a> <span class="keywordtype">char</span> * <a class="code" href="classTkDBc.html#a5">TkDBc::GetOctName</a>(<span class="keywordtype">int</span> oct){
00622   <span class="keyword">static</span> <span class="keywordtype">char</span> name[10];
00623   <span class="keywordflow">if</span>(oct==1) sprintf(name,<span class="stringliteral">"WAKE++"</span>);
00624   <span class="keywordflow">if</span>(oct==2) sprintf(name,<span class="stringliteral">"WAKE-+"</span>);
00625   <span class="keywordflow">if</span>(oct==3) sprintf(name,<span class="stringliteral">"RAM ++"</span>);
00626   <span class="keywordflow">if</span>(oct==4) sprintf(name,<span class="stringliteral">"RAM -+"</span>);
00627   <span class="keywordflow">if</span>(oct==5) sprintf(name,<span class="stringliteral">"WAKE+-"</span>);
00628   <span class="keywordflow">if</span>(oct==6) sprintf(name,<span class="stringliteral">"WAKE--"</span>);
00629   <span class="keywordflow">if</span>(oct==7) sprintf(name,<span class="stringliteral">"RAM +-"</span>);
00630   <span class="keywordflow">if</span>(oct==8) sprintf(name,<span class="stringliteral">"RAM --"</span>);
00631   <span class="keywordflow">return</span> name;
00632 }
00633 
00634 
00635 
<a name="l00636"></a><a class="code" href="classTkDBc.html#a30">00636</a> <span class="keywordtype">void</span> <a class="code" href="classTkDBc.html#a30">TkDBc::GetLayerRot</a>(<span class="keywordtype">int</span> lay, number nrm[][3]){
00637   
00638   <span class="keywordflow">if</span>( lay&lt;1||lay&gt;8) <span class="keywordflow">return</span>;
00639   <a class="code" href="classTkPlane.html">TkPlane</a>* pp=<a class="code" href="classTkDBc.html#a16">GetPlane</a>(<a class="code" href="classTkDBc.html#o9">_plane_layer</a>[lay-1]);
00640   <span class="keywordflow">if</span>(!pp) return ;
00641   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row=0;row&lt;3;row++)
00642     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col=0;col&lt;3;col++)
00643       nrm[row][col]=pp-&gt;<a class="code" href="classTkObject.html#o2">rot</a>.GetEl(row,col);
00644   <span class="keywordflow">return</span>;
00645 }
00646 
00647 
00648 
00649 
<a name="l00650"></a><a class="code" href="classTkDBc.html#a14">00650</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a14">TkDBc::readAlignment</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keywordtype">int</span> pri){
00651   <a class="code" href="classTkLadder.html">TkLadder</a> *aa;
00652   ifstream  fileout(filename);
00653   <span class="keywordflow">if</span> (!fileout) {
00654     printf(<span class="stringliteral">"Error: tkdbc alignemnt file not found: %s\n"</span>, filename);
00655     <span class="keywordflow">return</span> -1;
00656   }
00657   
00658 
00659   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++){
00660     <a class="code" href="classTkDBc.html#r6">planes</a>[ii]-&gt;<a class="code" href="classTkPlane.html#a3">ReadA</a>(fileout);
00661   }
00662   <span class="keywordtype">int</span> count=0;
00663   <span class="keywordflow">for</span>(<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); pp++) {
00664     <a class="code" href="classTkLadder.html">TkLadder</a>*  aa=pp-&gt;second;
00665     count++;
00666     aa-&gt;<a class="code" href="classTkLadder.html#a20">ReadA</a>(fileout);
00667     <span class="keywordflow">if</span>(fileout.eof()){  <span class="keywordflow">break</span>;}
00668     <span class="keywordflow">if</span>(!fileout.good()) cerr &lt;&lt;<span class="stringliteral">" Error in TkDBc::readAlignment the channel is not good"</span>&lt;&lt;endl;
00669     <span class="keywordflow">if</span> (pri) aa-&gt;<a class="code" href="classTkLadder.html#a21">WriteA</a>(cout);
00670 
00671   }
00672   cout &lt;&lt; count &lt;&lt;<span class="stringliteral">" Ladders ALIGNMENT  have been read from file "</span>&lt;&lt;filename&lt;&lt;endl;
00673 
00674   fileout.close();
00675   <span class="keywordflow">return</span> 0;
00676 
00677 }
00678 
00679 
<a name="l00680"></a><a class="code" href="classTkDBc.html#a15">00680</a> <span class="keywordtype">int</span> <a class="code" href="classTkDBc.html#a15">TkDBc::writeAlignment</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename){
00681 
00682   ofstream  fileout(filename);
00683   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;nplanes;ii++)
00684     <a class="code" href="classTkDBc.html#r6">planes</a>[ii]-&gt;<a class="code" href="classTkPlane.html#a4">WriteA</a>(fileout);
00685   <span class="keywordflow">for</span> (<a class="code" href="TkDBc_8h.html#a9">tkidIT</a> pp=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.begin(); pp!=<a class="code" href="classTkDBc.html#r1">tkidmap</a>.end(); ++pp)
00686     pp-&gt;second-&gt;<a class="code" href="classTkPlane.html#a4">WriteA</a>(fileout);
00687 
00688   fileout.close();
00689   <span class="keywordflow">return</span> 0;
00690 
00691 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
