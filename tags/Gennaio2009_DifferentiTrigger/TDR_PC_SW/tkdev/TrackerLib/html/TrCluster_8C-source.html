<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TrCluster.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TrCluster.C</h1><a href="TrCluster_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 
00025 
00026 <span class="preprocessor">#include "<a class="code" href="TkCoo_8h.html">TkCoo.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="TrCluster_8h.html">TrCluster.h</a>"</span>
00028 
00029 <a class="code" href="TrTrack_8C.html#a0">ClassImp</a>(<a class="code" href="classAMSTrCluster.html">AMSTrCluster</a>);
00030 
00031 <span class="comment">// Asimmetry correction defaults from test beam (no effect if {0.,0.})</span>
<a name="l00032"></a><a class="code" href="classAMSTrCluster.html#t0">00032</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#t0">AMSTrCluster::AsimmetryCorr</a>[2] = {0.027,0.034};
00033 <span class="comment">// By default tha gain correction is 1 (no effect)</span>
<a name="l00034"></a><a class="code" href="classAMSTrCluster.html#t1">00034</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#t1">AMSTrCluster::GainCorr</a>[2] = {1.00,1.00};
00035 <span class="comment">// Charge collection loss correction for protons (readout-middle-central)</span>
<a name="l00036"></a><a class="code" href="classAMSTrCluster.html#t2">00036</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#t2">AMSTrCluster::ChargeLossCorr</a>[2][3] = { {1.00,0.83,0.72}, {1.00,0.87,0.84} };
00037 
<a name="l00038"></a><a class="code" href="classAMSTrCluster.html#t3">00038</a> <a class="code" href="classTrCalDB.html">TrCalDB</a>* <a class="code" href="classAMSTrCluster.html#t3">AMSTrCluster::_trcaldb</a> = NULL;
<a name="l00039"></a><a class="code" href="classAMSTrCluster.html#s0">00039</a> string AMSTrCluster::sout;
00040 
00041 
00042 <span class="comment">//--------------------------------------------------</span>
<a name="l00043"></a><a class="code" href="classAMSTrCluster.html#a0">00043</a> <a class="code" href="classAMSTrCluster.html#a0">AMSTrCluster::AMSTrCluster</a>(<span class="keywordtype">void</span>) {
00044   <a class="code" href="classAMSTrCluster.html#a7">Clear</a>();
00045 }
00046 
00047 
00048 <span class="comment">//--------------------------------------------------</span>
<a name="l00049"></a><a class="code" href="classAMSTrCluster.html#a5">00049</a> <a class="code" href="classAMSTrCluster.html#a0">AMSTrCluster::AMSTrCluster</a>(<span class="keyword">const</span> <a class="code" href="classAMSTrCluster.html">AMSTrCluster</a> &amp;orig) :  AMSlink(orig) {
00050   <a class="code" href="classAMSTrCluster.html#o0">_tkid</a>    = orig.<a class="code" href="classAMSTrCluster.html#o0">_tkid</a>;
00051   <span class="comment">//  _side    = orig._side;</span>
00052   <a class="code" href="classAMSTrCluster.html#o1">_address</a> = orig.<a class="code" href="classAMSTrCluster.html#o1">_address</a>;
00053   <a class="code" href="classAMSTrCluster.html#o2">_nelem</a>   = orig.<a class="code" href="classAMSTrCluster.html#o2">_nelem</a>;
00054   <a class="code" href="classAMSTrCluster.html#o3">_seedind</a> = orig.<a class="code" href="classAMSTrCluster.html#o3">_seedind</a>;
00055   <span class="comment">//  _gain    = orig._gain; </span>
00056   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;_nelem; i++) <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.<a class="code" href="classAMSTrCluster.html#a3">push_back</a>(orig.<a class="code" href="classAMSTrCluster.html#o4">_signal</a>.at(i));
00057   <a class="code" href="classAMSTrCluster.html#o5">_clstatus</a>  = orig.<a class="code" href="classAMSTrCluster.html#o5">_clstatus</a>;
00058   <a class="code" href="classAMSTrCluster.html#o6">_mult</a>      = orig.<a class="code" href="classAMSTrCluster.html#o6">_mult</a>;
00059   <a class="code" href="classAMSTrCluster.html#r0">_coord</a>     = orig.<a class="code" href="classAMSTrCluster.html#r0">_coord</a>;
00060 }
00061 
00062 
00063 <span class="comment">//--------------------------------------------------</span>
<a name="l00064"></a><a class="code" href="classAMSTrCluster.html#a2">00064</a> <a class="code" href="classAMSTrCluster.html#a0">AMSTrCluster::AMSTrCluster</a>(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> side, <span class="keywordtype">int</span> add, <span class="keywordtype">int</span> seedind, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clstatus) : AMSlink() {
00065   <a class="code" href="classAMSTrCluster.html#a7">Clear</a>();
00066   <a class="code" href="classAMSTrCluster.html#o0">_tkid</a>    =  tkid;
00067   <span class="comment">//  _sideS    =  side;</span>
00068   <a class="code" href="classAMSTrCluster.html#o1">_address</a> =  add;
00069   <a class="code" href="classAMSTrCluster.html#o3">_seedind</a> =  seedind;
00070   <span class="comment">//  _gain    =  8;</span>
00071   <a class="code" href="classAMSTrCluster.html#o5">_clstatus</a> = clstatus;
00072 }
00073 
00074 
00075 <span class="comment">//--------------------------------------------------</span>
<a name="l00076"></a><a class="code" href="classAMSTrCluster.html#a1">00076</a> <a class="code" href="classAMSTrCluster.html#a0">AMSTrCluster::AMSTrCluster</a>(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> side, <span class="keywordtype">int</span> add, <span class="keywordtype">int</span> nelem, <span class="keywordtype">int</span> seedind, 
00077                            <span class="keywordtype">float</span>* adc, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> clstatus) :  AMSlink() {
00078   <a class="code" href="classAMSTrCluster.html#a7">Clear</a>();
00079   <a class="code" href="classAMSTrCluster.html#o0">_tkid</a>    =  tkid;
00080   <span class="comment">//  _side    =  side;</span>
00081   <a class="code" href="classAMSTrCluster.html#o1">_address</a> =  add;
00082   <a class="code" href="classAMSTrCluster.html#o2">_nelem</a>   =  nelem;
00083   <a class="code" href="classAMSTrCluster.html#o3">_seedind</a> =  seedind;
00084   <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.reserve(<a class="code" href="classAMSTrCluster.html#o2">_nelem</a>);
00085   <span class="comment">//  _gain    =  8;</span>
00086   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i&lt;_nelem; i++) <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.<a class="code" href="classAMSTrCluster.html#a3">push_back</a>(adc[i]);
00087   <a class="code" href="classAMSTrCluster.html#o5">_clstatus</a> = clstatus;
00088   <span class="comment">// multiplicity calculation</span>
00089   <a class="code" href="classAMSTrCluster.html#o6">_mult</a>    = <a class="code" href="classTkCoo.html#e0">TkCoo::GetMaxMult</a>(<a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>(),<a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>())+1;
00090   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> imult=0; imult&lt;_mult; imult++) <a class="code" href="classAMSTrCluster.html#r0">_coord</a>.<a class="code" href="classAMSTrCluster.html#a3">push_back</a>(<a class="code" href="classAMSTrCluster.html#a39">GetXCofG</a>(3,imult));  
00091 }
00092 
00093 
00094 <span class="comment">//--------------------------------------------------</span>
<a name="l00095"></a><a class="code" href="classAMSTrCluster.html#a6">00095</a> <a class="code" href="classAMSTrCluster.html#a6">AMSTrCluster::~AMSTrCluster</a>() {
00096   <a class="code" href="classAMSTrCluster.html#a7">Clear</a>();
00097 }
00098 
00099 
00100 
00101 <span class="comment">//--------------------------------------------------</span>
<a name="l00102"></a><a class="code" href="classAMSTrCluster.html#a23">00102</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a23">AMSTrCluster::GetCoord</a>(<span class="keywordtype">int</span> imult)  {
00103   <span class="keywordflow">if</span>(<a class="code" href="classAMSTrCluster.html#r0">_coord</a>.size()&lt;(imult-1)) this-&gt;<a class="code" href="classAMSTrCluster.html#a4">BuildCoordinates</a>();
00104   <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#r0">_coord</a>.at(imult);
00105 }
00106 
00107 
00108 <span class="comment">//--------------------------------------------------</span>
<a name="l00109"></a><a class="code" href="classAMSTrCluster.html#a18">00109</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a18">AMSTrCluster::GetNoise</a>(<span class="keywordtype">int</span> ii) {
00110   <span class="keywordflow">if</span> (<a class="code" href="classAMSTrCluster.html#t3">_trcaldb</a>==0) {
00111     printf(<span class="stringliteral">"AMSTrClusters::GetStatus Error, no _trcaldb specified.\n"</span>);
00112     <span class="keywordflow">return</span> -9999.; 
00113   }
00114   <span class="keywordtype">int</span> tkid = <a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>();
00115   <a class="code" href="classTrLadCal.html">TrLadCal</a>* ladcal = <a class="code" href="classAMSTrCluster.html#a8">GetTrCalDB</a>()-&gt;<a class="code" href="classTrCalDB.html#a10">FindCal_TkId</a>(tkid);
00116   <span class="keywordflow">if</span> (!ladcal) {printf (<span class="stringliteral">"AMSTrCluster::GetNoise, WARNING calibration not found!!\n"</span>); <span class="keywordflow">return</span> -9999;}
00117   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrCluster.html#o1">_address</a>+ii;
00118   <span class="keywordflow">return</span> (float)ladcal-&gt;<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(address);
00119 }
00120 
00121 
00122 <span class="comment">//--------------------------------------------------</span>
<a name="l00123"></a><a class="code" href="classAMSTrCluster.html#a20">00123</a> <span class="keywordtype">short</span> <a class="code" href="classAMSTrCluster.html#a20">AMSTrCluster::GetStatus</a>(<span class="keywordtype">int</span> ii) {
00124   <span class="keywordflow">if</span> (<a class="code" href="classAMSTrCluster.html#t3">_trcaldb</a>==0) {
00125     printf(<span class="stringliteral">"AMSTrClusters::GetStatus Error, no _trcaldb specified.\n"</span>);
00126     <span class="keywordflow">return</span> -1; 
00127   }
00128   <span class="keywordtype">int</span> tkid = <a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>();
00129   <a class="code" href="classTrLadCal.html">TrLadCal</a>* ladcal = <a class="code" href="classAMSTrCluster.html#a8">GetTrCalDB</a>()-&gt;<a class="code" href="classTrCalDB.html#a10">FindCal_TkId</a>(tkid);
00130   <span class="keywordflow">if</span> (!ladcal) {printf (<span class="stringliteral">"AMSTrCluster::GetNoise, WARNING calibration not found!!\n"</span>); <span class="keywordflow">return</span> -9999;}
00131   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrCluster.html#o1">_address</a>+ii;
00132   <span class="keywordflow">return</span> (short)ladcal-&gt;<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(address);
00133 }
00134 
00135 
00136 <span class="comment">//--------------------------------------------------</span>
<a name="l00137"></a><a class="code" href="classAMSTrCluster.html#a7">00137</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrCluster.html#a7">AMSTrCluster::Clear</a>() {
00138   <a class="code" href="classAMSTrCluster.html#o0">_tkid</a>    =  0;
00139   <a class="code" href="classAMSTrCluster.html#o1">_address</a> = -1;
00140   <a class="code" href="classAMSTrCluster.html#o2">_nelem</a>   =  0;
00141   <a class="code" href="classAMSTrCluster.html#o3">_seedind</a> =  0;
00142   <span class="comment">//  _gain    =  8;</span>
00143   <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.clear();
00144   <a class="code" href="classAMSTrCluster.html#o5">_clstatus</a> = 0;
00145   <a class="code" href="classAMSTrCluster.html#o6">_mult</a>     = 0;
00146   <a class="code" href="classAMSTrCluster.html#r0">_coord</a>.clear();
00147 }
00148 
00149 
00150 <span class="comment">//--------------------------------------------------</span>
<a name="l00151"></a><a class="code" href="classAMSTrCluster.html#a3">00151</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrCluster.html#a3">AMSTrCluster::push_back</a>(<span class="keywordtype">float</span> adc) {
00152   <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.push_back(adc);
00153   <a class="code" href="classAMSTrCluster.html#o2">_nelem</a> = (int) <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.size();
00154 }
00155 
00156 
00157 <span class="comment">//--------------------------------------------------</span>
<a name="l00158"></a><a class="code" href="classAMSTrCluster.html#a4">00158</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrCluster.html#a4">AMSTrCluster::BuildCoordinates</a>() {
00159   <span class="comment">// multiplicity calculation</span>
00160   <a class="code" href="classAMSTrCluster.html#o6">_mult</a>    = <a class="code" href="classTkCoo.html#e0">TkCoo::GetMaxMult</a>(<a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>(),<a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>())+1;
00161   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> imult=0; imult&lt;_mult; imult++) <a class="code" href="classAMSTrCluster.html#r0">_coord</a>.push_back(<a class="code" href="classAMSTrCluster.html#a39">GetXCofG</a>(3,imult));  
00162 }
00163 
00164 
00165 <span class="comment">//--------------------------------------------------</span>
<a name="l00166"></a><a class="code" href="classAMSTrCluster.html#a46">00166</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrCluster.html#a46">AMSTrCluster::Print</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options) { 
00167   <a class="code" href="classAMSTrCluster.html#a47">Info</a>(options);
00168   cout &lt;&lt;sout;
00169 }
00170 
<a name="l00171"></a><a class="code" href="classAMSTrCluster.html#a47">00171</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrCluster.html#a47">AMSTrCluster::Info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options) { 
00172   <span class="keywordtype">char</span> msg[1000];
00173   <a class="code" href="classAMSTrCluster.html#s0">sout</a>.clear();
00174   sprintf(msg,<span class="stringliteral">"TkId: %5d  Side: %1d  Address: %4d  Nelem: %3d  ClStatus: %d\n"</span>,
00175           <a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>(),<a class="code" href="classAMSTrCluster.html#a12">GetSide</a>(),<a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>(),<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>(),<a class="code" href="classAMSTrCluster.html#a21">GetClusterStatus</a>() );
00176   <a class="code" href="classAMSTrCluster.html#s0">sout</a>.append(msg);
00177   <span class="keywordtype">char</span> isseed[10];
00178   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>(); ii++) {
00179     sprintf(isseed,<span class="stringliteral">" "</span>);
00180     <span class="keywordflow">if</span> (ii==<a class="code" href="classAMSTrCluster.html#a24">GetSeedIndex</a>()) sprintf(isseed,<span class="stringliteral">"&lt;&lt;&lt; SEED"</span>);
00181     sprintf(msg,<span class="stringliteral">"Address: %4d  Signal: %10.5f  Sigma: %10.5f  Status: %3d  %10s\n"</span>,
00182            <a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>(ii),<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(ii,options),<a class="code" href="classAMSTrCluster.html#a17">GetSigma</a>(ii),<a class="code" href="classAMSTrCluster.html#a20">GetStatus</a>(ii),isseed);
00183     <a class="code" href="classAMSTrCluster.html#s0">sout</a>.append(msg);
00184   }
00185 }
00186 
00187 
00188 <span class="comment">//--------------------------------------------------</span>
<a name="l00189"></a><a class="code" href="classAMSTrCluster.html#a45">00189</a> std::ostream &amp;<a class="code" href="classAMSTrCluster.html#a45">AMSTrCluster::putout</a>(std::ostream &amp;ostr)<span class="keyword"> const </span>{
00190   <span class="keywordflow">return</span> ostr &lt;&lt; <span class="stringliteral">"TkID: "</span> &lt;&lt; <a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>() &lt;&lt; <span class="stringliteral">" "</span>
00191               &lt;&lt; <span class="stringliteral">"Side: "</span> &lt;&lt; <a class="code" href="classAMSTrCluster.html#a12">GetSide</a>() &lt;&lt; <span class="stringliteral">" "</span>
00192               &lt;&lt; <span class="stringliteral">"Addr: "</span> &lt;&lt; <a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>() &lt;&lt; <span class="stringliteral">" "</span>
00193               &lt;&lt; <span class="stringliteral">"Nelm: "</span> &lt;&lt; <a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>() &lt;&lt; <span class="stringliteral">" "</span> 
00194               &lt;&lt; <span class="stringliteral">"ClStatus: "</span> &lt;&lt; <a class="code" href="classAMSTrCluster.html#a21">GetClusterStatus</a>() &lt;&lt; std::endl;
00195 }
00196 
00197 
00198 <span class="comment">//--------------------------------------------------</span>
<a name="l00199"></a><a class="code" href="classAMSTrCluster.html#a16">00199</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a16">AMSTrCluster::GetSignal</a>(<span class="keywordtype">int</span> ii, <span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00200   <span class="comment">// parsing options</span>
00201   <span class="keywordtype">bool</span> ApplyAsimmetryCorr = <span class="keyword">false</span>;
00202   <span class="keywordtype">bool</span> ApplyGainCorr      = <span class="keyword">false</span>;
00203   <span class="keywordtype">char</span> character = <span class="charliteral">' '</span>;
00204   <span class="keywordtype">int</span>  cc = 0;
00205   <span class="keywordflow">while</span> (character!=<span class="charliteral">'\0'</span>) {
00206     character = *(options+cc);
00207     <span class="keywordflow">if</span> ( (character==<span class="charliteral">'A'</span>)||(character==<span class="charliteral">'a'</span>) ) ApplyAsimmetryCorr = <span class="keyword">true</span>;
00208     <span class="keywordflow">if</span> ( (character==<span class="charliteral">'G'</span>)||(character==<span class="charliteral">'g'</span>) ) ApplyGainCorr      = <span class="keyword">true</span>;
00209     cc++;
00210   }
00211   <span class="keywordtype">float</span> signal = <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.at(ii);
00212   <span class="keywordtype">int</span>   side   = <a class="code" href="classAMSTrCluster.html#a12">GetSide</a>();
00213   <span class="keywordflow">if</span> (ApplyAsimmetryCorr) {
00214     <span class="comment">// subtraction of a portion of the right strip</span>
00215     <span class="keywordflow">if</span> (ii&gt;0) signal = signal - <a class="code" href="classAMSTrCluster.html#o4">_signal</a>.at(ii-1)*<a class="code" href="classAMSTrCluster.html#t0">AsimmetryCorr</a>[side];
00216   }
00217   <span class="comment">// LoadGain() ???</span>
00218   <span class="keywordflow">if</span> (ApplyGainCorr) {
00219     signal = signal*<a class="code" href="classAMSTrCluster.html#t1">GainCorr</a>[side];
00220   }
00221   <span class="keywordflow">return</span> signal;
00222 }
00223 
00224 
00225 <span class="comment">//--------------------------------------------------</span>
<a name="l00226"></a><a class="code" href="classAMSTrCluster.html#a14">00226</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrCluster.html#a13">AMSTrCluster::GetAddress</a>(<span class="keywordtype">int</span> ii) {
00227   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrCluster.html#a13">GetAddress</a>() + ii;
00228   <span class="keywordtype">int</span> side    = <a class="code" href="classAMSTrCluster.html#a12">GetSide</a>();
00229   <span class="comment">// for cyclicity </span>
00230   <span class="keywordflow">if</span> ( (side==0)&amp;&amp;(address&gt;1023) ) address = address - 384; <span class="comment">//  640 + (address - 1024);</span>
00231   <span class="keywordflow">if</span> ( (side==0)&amp;&amp;(address&lt; 640) ) address = address + 384; <span class="comment">// 1024 - (640  - address);</span>
00232   <span class="keywordflow">if</span> ( (side==1)&amp;&amp;(address&gt; 639) ) address = address - 640; <span class="comment">//    0 + (address -  640);</span>
00233   <span class="keywordflow">if</span> ( (side==1)&amp;&amp;(address&lt;   0) ) address = address + 640; <span class="comment">//  640 - (   0 - address);</span>
00234   <span class="keywordflow">return</span> address;
00235 }
00236 
00237 <span class="comment">/*</span>
00238 <span class="comment">//--------------------------------------------------</span>
00239 <span class="comment">int AMSTrCluster::GetSeedIndex() {</span>
00240 <span class="comment">  float maxadc  = -1000.;</span>
00241 <span class="comment">  int   seedadd = -1;</span>
00242 <span class="comment">  for (int ii=0; ii&lt;GetNelem(); ii++) { </span>
00243 <span class="comment">    if ( (GetSignal(ii)&gt;maxadc)&amp;&amp;(GetStatus(ii)==0) ) { </span>
00244 <span class="comment">      maxadc  = GetSignal(ii); </span>
00245 <span class="comment">      seedadd = ii; </span>
00246 <span class="comment">    } </span>
00247 <span class="comment">  }</span>
00248 <span class="comment">  return seedadd;</span>
00249 <span class="comment">}</span>
00250 <span class="comment">*/</span>
00251 
00252 
00253 <span class="comment">//--------------------------------------------------</span>
<a name="l00254"></a><a class="code" href="classAMSTrCluster.html#a40">00254</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrCluster.html#a40">AMSTrCluster::GetSecondIndex</a>() {
00255   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrCluster.html#a24">GetSeedIndex</a>();
00256   <span class="keywordtype">int</span> nleft  = <a class="code" href="classAMSTrCluster.html#a29">GetLeftLength</a>();
00257   <span class="keywordtype">int</span> nright = <a class="code" href="classAMSTrCluster.html#a30">GetRightLength</a>();
00258   <span class="comment">// 1 strip</span>
00259   <span class="keywordflow">if</span> ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) <span class="keywordflow">return</span> -1; 
00260   <span class="comment">// 2 strips</span>
00261   <span class="keywordflow">if</span> (nleft&lt;=0)  <span class="keywordflow">return</span> cstrip+1;
00262   <span class="keywordflow">if</span> (nright&lt;=0) <span class="keywordflow">return</span> cstrip-1;
00263   <span class="comment">// &gt;2 strips</span>
00264   <span class="keywordflow">if</span> ( <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1)&gt;<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip-1) ) <span class="keywordflow">return</span> cstrip+1;
00265   <span class="keywordflow">else</span>                                           <span class="keywordflow">return</span> cstrip-1;
00266   <span class="keywordflow">return</span> -1;
00267 }
00268 
00269 
00270 <span class="comment">//--------------------------------------------------</span>
<a name="l00271"></a><a class="code" href="classAMSTrCluster.html#a32">00271</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a32">AMSTrCluster::GetTotSignal</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00272   <span class="comment">// parsing options</span>
00273   <span class="keywordtype">bool</span> ApplyChargeLossCorr = <span class="keyword">false</span>;
00274   <span class="keywordtype">bool</span> ApplyPNCorr         = <span class="keyword">false</span>;
00275   <span class="keywordtype">char</span> character = <span class="charliteral">' '</span>;
00276   <span class="keywordtype">int</span>  cc = 0;
00277   <span class="keywordflow">while</span> (character!=<span class="charliteral">'\0'</span>) {
00278     character = *(options+cc);
00279     <span class="keywordflow">if</span> ( (character==<span class="charliteral">'L'</span>)||(character==<span class="charliteral">'l'</span>) ) ApplyChargeLossCorr = <span class="keyword">true</span>;
00280     <span class="keywordflow">if</span> ( (character==<span class="charliteral">'N'</span>)||(character==<span class="charliteral">'n'</span>) ) ApplyPNCorr         = <span class="keyword">true</span>;
00281     cc++;
00282   }
00283   <span class="keywordtype">float</span> sum = 0;
00284   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>(); ii++) {
00285     sum += <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(ii,options);
00286   } 
00287   <span class="keywordflow">if</span> (ApplyChargeLossCorr) {
00288     <span class="keywordtype">int</span> side     = <a class="code" href="classAMSTrCluster.html#a12">GetSide</a>();
00289     <span class="keywordtype">int</span> etaindex = <a class="code" href="classAMSTrCluster.html#a34">GetEtaIndex</a>(options);
00290     <span class="keywordflow">if</span> (etaindex&gt;=0) sum = sum/<a class="code" href="classAMSTrCluster.html#t2">ChargeLossCorr</a>[side][etaindex];
00291   }
00292   <span class="keywordflow">return</span> sum;
00293 }
00294 
00295 
00296 <span class="comment">//--------------------------------------------------</span>
<a name="l00297"></a><a class="code" href="classAMSTrCluster.html#a33">00297</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a33">AMSTrCluster::GetEta</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00298   <span class="comment">/*</span>
00299 <span class="comment">    eta = center of gravity with the two higher strips = Q_{R} / ( Q_{L} + Q_{R} )</span>
00300 <span class="comment">    </span>
00301 <span class="comment">        _                                    _</span>
00302 <span class="comment">      l|c|r          c*0 + r*1    r        l|c|r            l*0 + c*1    c</span>
00303 <span class="comment">       | |_    eta = --------- = ---       _| |       eta = --------- = ---</span>
00304 <span class="comment">      _| | |           c + r     c+r      | | |_              l + c     l+c</span>
00305 <span class="comment">   __|_|_|_|__                          __|_|_|_|__</span>
00306 <span class="comment">        0 1                                0 1</span>
00307 <span class="comment"></span>
00308 <span class="comment">    eta is 1 when the particle is near to the right strip,</span>
00309 <span class="comment">    while is approx 0 when is near to the left strip</span>
00310 <span class="comment">  */</span>
00311   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrCluster.html#a24">GetSeedIndex</a>();
00312   <span class="keywordtype">int</span> nleft  = <a class="code" href="classAMSTrCluster.html#a29">GetLeftLength</a>();
00313   <span class="keywordtype">int</span> nright = <a class="code" href="classAMSTrCluster.html#a30">GetRightLength</a>();
00314   <span class="comment">// 1 strip</span>
00315   <span class="keywordflow">if</span> ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) <span class="keywordflow">return</span> -1.; 
00316   <span class="comment">// 2 strips</span>
00317   <span class="keywordflow">if</span> (nleft&lt;=0)  <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1,options)/(<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1,options) + <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip,options));
00318   <span class="keywordflow">if</span> (nright&lt;=0) <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip  ,options)/(<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip-1,options) + <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip,options));
00319   <span class="comment">// &gt;2 strips</span>
00320   <span class="keywordflow">if</span> ( <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1)&gt;=<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip-1) ) 
00321     <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1,options)/(<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip+1,options) + <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip,options));
00322   <span class="keywordflow">else</span>
00323     <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip  ,options)/(<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip-1,options) + <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(cstrip,options));
00324   <span class="keywordflow">return</span> -1.;
00325 }
00326 
00327 
00328 <span class="comment">//--------------------------------------------------</span>
<a name="l00329"></a><a class="code" href="classAMSTrCluster.html#a34">00329</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrCluster.html#a34">AMSTrCluster::GetEtaIndex</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00330   <span class="keywordtype">float</span> eta = <a class="code" href="classAMSTrCluster.html#a33">GetEta</a>(options);
00331   <span class="keywordflow">if</span> (eta&lt;0.) <span class="keywordflow">return</span> -1;
00332   <span class="keywordflow">if</span>      ( (fabs(eta-0.5)&gt;=0.35)&amp;&amp;(fabs(eta-0.5)&lt;=0.50) ) <span class="keywordflow">return</span>  0; <span class="comment">// readout</span>
00333   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (fabs(eta-0.5)&gt;=0.15)&amp;&amp;(fabs(eta-0.5)&lt; 0.35) ) <span class="keywordflow">return</span>  1; <span class="comment">// middle</span>
00334   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (fabs(eta-0.5)&gt;=0.00)&amp;&amp;(fabs(eta-0.5)&lt; 0.15) ) <span class="keywordflow">return</span>  2; <span class="comment">// central</span>
00335   <span class="keywordflow">return</span> -1;
00336 }
00337 
00338 
00339 <span class="comment">//--------------------------------------------------</span>
<a name="l00340"></a><a class="code" href="classAMSTrCluster.html#a35">00340</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a35">AMSTrCluster::GetCofG</a>(<span class="keywordtype">int</span> nstrips, <span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00341   
00342   <span class="keywordflow">if</span> (nstrips&lt;=1) <span class="keywordflow">return</span> -1.;
00343   <span class="comment">/*</span>
00344 <span class="comment">    CofG(n) = center of gravity with the n consecutive higher strips </span>
00345 <span class="comment">             _        </span>
00346 <span class="comment">            | |_                - 2*s(-2) - 1*s(-1) + 0*s(0) + 1*s(1)</span>
00347 <span class="comment">         _ _| | |     CofG(4) = -------------------------------------</span>
00348 <span class="comment">       _| | | | |_                  s(-2) + s(-1) + s(0) + s(1)</span>
00349 <span class="comment">    __|_|_|_|_|_|_|__                   </span>
00350 <span class="comment">             0                         </span>
00351 <span class="comment"> </span>
00352 <span class="comment">    in order to be coherent with the given eta definition </span>
00353 <span class="comment">    CofG(2) = Eta ==&gt; if CofG&lt;0 then CofG = CofG + 1.</span>
00354 <span class="comment">  */</span>
00355   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrCluster.html#a24">GetSeedIndex</a>();
00356   <span class="keywordtype">int</span> nleft  = <a class="code" href="classAMSTrCluster.html#a29">GetLeftLength</a>();
00357   <span class="keywordtype">int</span> nright = <a class="code" href="classAMSTrCluster.html#a30">GetRightLength</a>();
00358   <span class="keywordtype">int</span> nside  = nstrips/2;
00359   <span class="keywordtype">int</span> lindex = cstrip - nside;
00360   <span class="keywordtype">int</span> rindex = cstrip + nside;
00361 
00362   <span class="keywordflow">if</span> ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) <span class="keywordflow">return</span> -1.; <span class="comment">// 1 strip</span>
00363 
00364   <span class="comment">// nstrip is even &amp;&amp; if the two (nstrip/2)-th strips exist </span>
00365   <span class="keywordflow">if</span> ( (nstrips%2==0)&amp;&amp;(nleft&gt;=nside)&amp;&amp;(nright&gt;=nside) ) { 
00366     <span class="keywordflow">if</span> ( <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(lindex,options)&gt;=<a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(rindex,options) ) rindex = rindex - 1;
00367     <span class="keywordflow">else</span>                                                        lindex = lindex + 1;
00368   }
00369 
00370   <span class="comment">// the calculation must be in the cluster</span>
00371   lindex = max(lindex, cstrip - nleft);  
00372   rindex = min(rindex, cstrip + nright);  
00373 
00374   <span class="comment">// calculation</span>
00375   <span class="keywordtype">float</span> numerator   = 0.;
00376   <span class="keywordtype">float</span> denominator = 0.;
00377   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> index=lindex; index&lt;=rindex; index++) {
00378     <span class="keywordtype">float</span> weight   = <a class="code" href="classAMSTrCluster.html#a16">GetSignal</a>(index,options);
00379     <span class="keywordtype">float</span> position = (float) (index - cstrip);
00380     numerator   += weight*position;
00381     denominator += weight;
00382   }
00383   <span class="keywordtype">float</span> CofG = numerator/denominator;
00384   <span class="keywordflow">if</span> (CofG&lt;0.) CofG += 1.;
00385 
00386   <span class="keywordflow">return</span> CofG;
00387 }
00388 
00389 <span class="comment">/* GetXCofG without TkCoo</span>
00390 <span class="comment">//--------------------------------------------------</span>
00391 <span class="comment">float AMSTrCluster::GetXCofG(int nstrips, int imult, char* options) {</span>
00392 <span class="comment">  if (nstrips&lt;=1) return -1000.;</span>
00393 <span class="comment">  int cstrip = GetSeedIndex();</span>
00394 <span class="comment">  int nleft  = GetLeftLength();</span>
00395 <span class="comment">  int nright = GetRightLength();</span>
00396 <span class="comment">  int nside  = nstrips/2;</span>
00397 <span class="comment">  int lindex = cstrip - nside;</span>
00398 <span class="comment">  int rindex = cstrip + nside;</span>
00399 <span class="comment">  if ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) return -1000.; </span>
00400 <span class="comment">  // nstrip is even &amp;&amp; if the two (nstrip/2)-th strips exist </span>
00401 <span class="comment">  if ( ((nstrips%2)==0)&amp;&amp;(nleft&gt;=nside)&amp;&amp;(nright&gt;=nside) ) { </span>
00402 <span class="comment">    if ( GetSignal(lindex,options)&gt;=GetSignal(rindex,options) ) rindex = rindex - 1;</span>
00403 <span class="comment">    else                                                        lindex = lindex + 1;</span>
00404 <span class="comment">  }</span>
00405 <span class="comment">  // the calculation must be in the cluster</span>
00406 <span class="comment">  lindex = max(lindex, cstrip - nleft);  </span>
00407 <span class="comment">  rindex = min(rindex, cstrip + nright);  </span>
00408 <span class="comment">  // calculation</span>
00409 <span class="comment">  float numerator   = 0.;</span>
00410 <span class="comment">  float denominator = 0.;</span>
00411 <span class="comment">  for (int index=lindex; index&lt;=rindex; index++) {</span>
00412 <span class="comment">    float weight   = GetSignal(index,options);</span>
00413 <span class="comment">    float position = GetX(index,imult);</span>
00414 <span class="comment">    numerator   += weight*position;</span>
00415 <span class="comment">    denominator += weight;</span>
00416 <span class="comment">  }</span>
00417 <span class="comment">  float CofG = numerator/denominator;</span>
00418 <span class="comment">  if (CofG&lt;0.) CofG += 1.;</span>
00419 <span class="comment">  return CofG;</span>
00420 <span class="comment">}</span>
00421 <span class="comment">*/</span>
00422 
00423 <span class="comment">//--------------------------------------------------</span>
<a name="l00424"></a><a class="code" href="classAMSTrCluster.html#a37">00424</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a36">AMSTrCluster::GetX</a>(<span class="keywordtype">float</span> interpos, <span class="keywordtype">int</span> imult) {
00425   <span class="keywordflow">if</span> (interpos&lt;0. || interpos&gt;1.) <span class="keywordflow">return</span> -1000.;
00426   <span class="comment">// from the interstrip convention to coordinate</span>
00427   <span class="keywordflow">if</span> (interpos&gt;0.5) interpos = - (1. - interpos);
00428   <span class="comment">// position in strip units</span>
00429   <span class="keywordtype">float</span> position = (float) interpos + (float) <a class="code" href="classAMSTrCluster.html#a25">GetSeedAddress</a>();
00430   <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e2">TkCoo::GetLocalCoo</a>(<a class="code" href="classAMSTrCluster.html#a9">GetTkId</a>(),position,imult);
00431 }
00432 
00433 
00434 <span class="comment">//--------------------------------------------------</span>
<a name="l00435"></a><a class="code" href="classAMSTrCluster.html#a38">00435</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a38">AMSTrCluster::GetXEta</a>(<span class="keywordtype">int</span> imult, <span class="keyword">const</span> <span class="keywordtype">char</span>* options) {
00436   <span class="keywordflow">if</span>      (<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>()&gt;1)  <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a36">GetX</a>(<a class="code" href="classAMSTrCluster.html#a33">GetEta</a>(options),imult);
00437   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>()==1) <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a36">GetX</a>((<span class="keywordtype">float</span>)0.,imult);
00438   <span class="keywordflow">else</span>                    <span class="keywordflow">return</span> -1000.;
00439   <span class="keywordflow">return</span> -1000.;
00440 }       
00441 
00442 
00443 <span class="comment">//--------------------------------------------------</span>
<a name="l00444"></a><a class="code" href="classAMSTrCluster.html#a39">00444</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrCluster.html#a39">AMSTrCluster::GetXCofG</a>(<span class="keywordtype">int</span> nstrips, <span class="keywordtype">int</span> imult, <span class="keyword">const</span> <span class="keywordtype">char</span>* options) { 
00445   <span class="keywordflow">if</span>      (<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>()&gt;1)  <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a36">GetX</a>(<a class="code" href="classAMSTrCluster.html#a35">GetCofG</a>(nstrips,options),imult);
00446   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classAMSTrCluster.html#a15">GetNelem</a>()==1) <span class="keywordflow">return</span> <a class="code" href="classAMSTrCluster.html#a36">GetX</a>((<span class="keywordtype">float</span>)0.,imult);
00447   <span class="keywordflow">else</span>                    <span class="keywordflow">return</span> -1000.;
00448   <span class="keywordflow">return</span> -1000.;
00449 }       
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
