<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TrTrack.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TrTrack.C</h1><a href="TrTrack_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">// $Id: TrTrack.C,v 1.26 2008/11/06 18:35:51 zuccon Exp $</span>
00002 
00020 
00021 <span class="preprocessor">#include "<a class="code" href="Event_8h.html">Event.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="TrRecHit_8h.html">TrRecHit.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="TrTrack_8h.html">TrTrack.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="TrFit_8h.html">TrFit.h</a>"</span>
00025 <span class="preprocessor">#include "TrField.h"</span>
00026 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00027 <span class="preprocessor">#include "point.h"</span>
00028 <span class="preprocessor">#include "<a class="code" href="tkdcards_8h.html">tkdcards.h</a>"</span>
00029 <span class="comment">//#include "commons.h"</span>
00030 
00031 <span class="preprocessor">#include &lt;cmath&gt;</span>
00032 <span class="preprocessor">#ifdef __DARWIN__</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>   <span class="comment">// for FLT_MAX</span>
00034 <span class="preprocessor">#include &lt;float.h&gt;</span>    <span class="comment">// for FLT_MAX (for Dawin GCC 4)</span>
00035 <span class="preprocessor">#else</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#include &lt;values.h&gt;</span>   <span class="comment">// for FLT_MAX (for Linux)</span>
00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a><a class="code" href="TrTrack_8C.html#a0">00038</a> <span class="preprocessor"></span><a class="code" href="TrTrack_8C.html#a0">ClassImp</a>(<a class="code" href="classAMSTrTrack.html">AMSTrTrack</a>)
00039 
00040 
00041 #ifdef __WRITEROOT_
00042 <span class="preprocessor">#include "VCon_gbatch.h"</span>
00043 <a class="code" href="classVCon.html">VCon</a>* AMSTrTrack::vcon= <span class="keyword">new</span> VCon_gb();
00044 <span class="preprocessor">#else  </span>
00045 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="VCon__root_8h.html">VCon_root.h</a>"</span>
00046 <a class="code" href="classVCon.html">VCon</a>* AMSTrTrack::vcon= <span class="keyword">new</span> <a class="code" href="classVCon__root.html">VCon_root</a>();
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049 geant AMSTrTrack::_TimeLimit=0;
00050 
00051  <span class="keywordtype">void</span> <a class="code" href="classAMSTrTrack.html#d0">AMSTrTrack::BaseInit</a>(){
00052 <span class="comment">//   memset(FitDone,1,NFITTYPE*sizeof(FitDone[0]));</span>
00053    _GeaneFitDone=0;
00054    _AdvancedFitDone=0;
00055  }
00056 
00057 <span class="comment">// int AMSTrTrack::DoFit(char* fitname){</span>
00058 <span class="comment">//   int index=GetFitIndex(fitname);</span>
00059 <span class="comment">//   if(index&lt;0) return -1;</span>
00060 
00061 <span class="comment">//   TrFit fit();</span>
00062 <span class="comment">//   int fitdone=fit-&gt;dofit;</span>
00063 <span class="comment">//   if(!fitdone) return -2;</span>
00064 
00065 <span class="comment">//   int index2=_chi2.size();</span>
00066 <span class="comment">//   FitDone[index]=index2;</span>
00067   
00068 <span class="comment">//   _chi2x.pushback(fit.GetChisqX());</span>
00069 <span class="comment">//   _chi2y.pushback(fit.GetChisqY());</span>
00070   
00071   
00072 
00073 <span class="comment">// }</span>
00074 
00075 
00076 <span class="comment">// int AMSTrTrack::GetFitIndex(char* fitname){</span>
00077 <span class="comment">//   int index=-1;</span>
00078 <span class="comment">//   string str1(fitname);</span>
00079 <span class="comment">//   for (int ii=0;ii&lt;str1.size();ii++)</span>
00080 <span class="comment">//     str1.at(ii)=tolower(str1.at(ii));</span>
00081 
00082 <span class="comment">//   for (int ii=0;ii&lt;NFITTYPE;ii++)</span>
00083 <span class="comment">//     if(str1.compare(FitMethods[ii])){</span>
00084 <span class="comment">//       index=ii;</span>
00085 <span class="comment">//       break;</span>
00086 <span class="comment">//     }</span>
00087 <span class="comment">//   return index;</span>
00088 <span class="comment">// }</span>
00089 
00090 
<a name="l00091"></a><a class="code" href="classAMSTrTrack.html#a3">00091</a> <a class="code" href="classAMSTrTrack.html#a0">AMSTrTrack::AMSTrTrack</a>(AMSDir dir, AMSPoint point, number rig, number errig):
00092   AMSlink(0,0),_Pattern(-1),_Nhits(0),_GeaneFitDone(0),
00093   _AdvancedFitDone(1),_Rigidity(rig),_ErrRinv(errig),_Chi2FastFit(1000000)
00094 {
00095   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;trconst::maxlay;i++){
00096     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]=0;    
00097     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]=-1;
00098   }
00099   <a class="code" href="classAMSTrTrack.html#o14">_Theta</a>=dir.gettheta();
00100   <a class="code" href="classAMSTrTrack.html#o15">_Phi</a>=dir.getphi();
00101   <a class="code" href="classAMSTrTrack.html#o16">_P0x</a>=point[0];
00102   <a class="code" href="classAMSTrTrack.html#o17">_P0y</a>=point[1];
00103   <a class="code" href="classAMSTrTrack.html#o18">_P0z</a>=point[2];
00104 } 
00105   
<a name="l00106"></a><a class="code" href="classAMSTrTrack.html#a2">00106</a> <a class="code" href="classAMSTrTrack.html#a0">AMSTrTrack::AMSTrTrack</a>(number theta, number phi, AMSPoint point):
00107   AMSlink(0,0),_Pattern(-1),_Nhits(0),_GeaneFitDone(0),
00108   _AdvancedFitDone(1),_Rigidity(10000000),_ErrRinv(10000000),
00109   _Chi2FastFit(1000000)
00110 {
00111   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;trconst::maxlay;i++){
00112     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]=0;
00113     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]=-1;
00114 }  
00115   <a class="code" href="classAMSTrTrack.html#o14">_Theta</a>=theta;
00116   <a class="code" href="classAMSTrTrack.html#o15">_Phi</a>=phi;
00117   <a class="code" href="classAMSTrTrack.html#o16">_P0x</a>=point[0];
00118   <a class="code" href="classAMSTrTrack.html#o17">_P0y</a>=point[1];
00119   <a class="code" href="classAMSTrTrack.html#o18">_P0z</a>=point[2];
00120 
00121 }
00122 
00123 
00124 
<a name="l00125"></a><a class="code" href="classAMSTrTrack.html#a0">00125</a> <a class="code" href="classAMSTrTrack.html#a0">AMSTrTrack::AMSTrTrack</a>(<span class="keywordtype">void</span>) : _Pattern(-1), _Nhits(-1) 
00126 {
00127   <a class="code" href="classAMSTrTrack.html#d0">BaseInit</a>();
00128  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;trconst::maxlay;i++){
00129     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]=0;
00130     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]=-1;
00131  }
00132 }
00133 
<a name="l00134"></a><a class="code" href="classAMSTrTrack.html#a1">00134</a> <a class="code" href="classAMSTrTrack.html#a0">AMSTrTrack::AMSTrTrack</a>(<span class="keywordtype">int</span> pattern, <span class="keywordtype">int</span> nhits, <a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a> *phit[], <span class="keywordtype">int</span> *imult)
00135   : _Pattern(pattern), _Nhits(nhits)
00136 {
00137   <a class="code" href="classAMSTrTrack.html#d0">BaseInit</a>();
00138   <a class="code" href="classVCon.html">VCon</a>* cont2=<a class="code" href="classAMSTrTrack.html#s0">vcon</a>-&gt;<a class="code" href="classVCon.html#a2">GetCont</a>(<span class="stringliteral">"AMSTrRecHit"</span>);
00139   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; trconst::maxlay; i++) {
00140     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a> [i] = (phit  &amp;&amp; i &lt; _Nhits) ? phit [i] :  0;
00141     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a> [i] = (phit  &amp;&amp; i &lt; _Nhits) ? cont2-&gt;<a class="code" href="classVCon.html#a6">getindex</a>(phit[i]):-1;
00142     <a class="code" href="classAMSTrTrack.html#o2">_iMult</a>[i] = (imult &amp;&amp; i &lt; _Nhits) ? imult[i] : -1;
00143   }
00144   <span class="keyword">delete</span> cont2;
00145 }
00146 
<a name="l00147"></a><a class="code" href="classAMSTrTrack.html#a7">00147</a> <a class="code" href="classAMSTrTrack.html#a7">AMSTrTrack::~AMSTrTrack</a>()
00148 {
00149   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;trconst::maxlay;i++){
00150     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]=0;
00151     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]=-1;
00152   }  
00153 }
<a name="l00154"></a><a class="code" href="classAMSTrTrack.html#a6">00154</a> <span class="keywordtype">void</span>   <a class="code" href="classAMSTrTrack.html#a6">AMSTrTrack::BuildHitsIndex</a>(){
00155    <a class="code" href="classVCon.html">VCon</a>* cont2=<a class="code" href="classAMSTrTrack.html#s0">vcon</a>-&gt;<a class="code" href="classVCon.html#a2">GetCont</a>(<span class="stringliteral">"AMSTrRecHit"</span>);
00156   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _Nhits; i++) {
00157     <a class="code" href="classAMSTrTrack.html#o1">_iHits</a> [i] =  cont2-&gt;<a class="code" href="classVCon.html#a6">getindex</a>(<a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]);
00158   }
00159   <span class="keyword">delete</span> cont2;
00160 }
00161 
<a name="l00162"></a><a class="code" href="classAMSTrTrack.html#a27">00162</a> <a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a> *<a class="code" href="classAMSTrTrack.html#a27">AMSTrTrack::GetHit</a>(<span class="keywordtype">int</span> i) 
00163 {
00164   <span class="keywordflow">if</span> ( i&lt;0 || i &gt; trconst::maxlay) <span class="keywordflow">return</span> 0;
00165   <span class="keywordflow">if</span>(<a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i]==0&amp;&amp;<a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]&gt;-1){
00166     <a class="code" href="classVCon.html">VCon</a>* cont2=<a class="code" href="classAMSTrTrack.html#s0">vcon</a>-&gt;<a class="code" href="classVCon.html#a2">GetCont</a>(<span class="stringliteral">"AMSTrRecHit"</span>);
00167     <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i] = (<a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a>*)cont2-&gt;<a class="code" href="classVCon.html#a5">getelem</a>(<a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[i]);
00168     <span class="keyword">delete</span> cont2;
00169   }
00170   
00171   <span class="keywordflow">return</span> <a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[i];
00172 }
00173 
<a name="l00174"></a><a class="code" href="classAMSTrTrack.html#a28">00174</a> <span class="keywordtype">double</span> <a class="code" href="classAMSTrTrack.html#a28">AMSTrTrack::GetChisq</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
00175 <span class="keyword"></span>{
00176   <span class="keywordflow">return</span> (<a class="code" href="classAMSTrTrack.html#o5">_NdofX</a>+<a class="code" href="classAMSTrTrack.html#o6">_NdofY</a> &gt; 0) ? (<a class="code" href="classAMSTrTrack.html#o10">_ChisqX</a>+_ChisqY)/(<a class="code" href="classAMSTrTrack.html#o5">_NdofX</a>+_NdofY) : 0;
00177 }
00178 
<a name="l00179"></a><a class="code" href="classAMSTrTrack.html#a29">00179</a> <span class="keywordtype">double</span> <a class="code" href="classAMSTrTrack.html#a29">AMSTrTrack::GetChisqWoMS</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
00180 <span class="keyword"></span>{
00181   <span class="keywordflow">return</span> (<a class="code" href="classAMSTrTrack.html#o5">_NdofX</a>+<a class="code" href="classAMSTrTrack.html#o6">_NdofY</a> &gt; 0) ? (<a class="code" href="classAMSTrTrack.html#o7">_ChisqXWoMS</a>+_ChisqYWoMS)/(<a class="code" href="classAMSTrTrack.html#o5">_NdofX</a>+_NdofY) : 0;
00182 }
00183 
00184 
<a name="l00185"></a><a class="code" href="classAMSTrTrack.html#a32">00185</a> <span class="keywordtype">double</span> <a class="code" href="classAMSTrTrack.html#a32">AMSTrTrack::SimpleFit</a>(<span class="keywordtype">void</span>)
00186 {
00187   <span class="keywordtype">double</span> err[3] = { 0.03, 0.03, 0.03 };
00188   <span class="keywordflow">return</span> <a class="code" href="classAMSTrTrack.html#a32">SimpleFit</a>(err);
00189 }
00190 
<a name="l00191"></a><a class="code" href="classAMSTrTrack.html#a33">00191</a> <span class="keywordtype">double</span> <a class="code" href="classAMSTrTrack.html#a32">AMSTrTrack::SimpleFit</a>(<span class="keywordtype">double</span> *ehit)
00192 {
00193   <a class="code" href="classTrFit.html">TrFit</a> fit;
00194   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _Nhits; i++) {
00195     <a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a> *hit = <a class="code" href="classAMSTrTrack.html#a27">GetHit</a>(i);
00196     <span class="keywordflow">if</span> (!hit) <span class="keywordflow">continue</span>;
00197     AMSPoint coo = hit-&gt;<a class="code" href="classAMSTrRecHit.html#a15">GetCoord</a>(<a class="code" href="classAMSTrTrack.html#o2">_iMult</a>[i]);
00198     fit.<a class="code" href="classTrFit.html#a14">Add</a>((ehit[0] &gt; 0) ? coo[0] : 0, 
00199             (ehit[1] &gt; 0) ? coo[1] : 0, coo[2], ehit[0], ehit[1], ehit[2]);
00200   }
00201 
00202   <span class="keywordtype">int</span> method = TrFit::SIMPLE;
00203   <span class="keywordflow">if</span> (MAGFIELDFFKEY.magstat == 0) method = TrFit::LINEAR;
00204 
00205   <span class="keywordtype">double</span> chisq = -1;
00206 
00207   <span class="comment">// X-only fit</span>
00208   <span class="keywordflow">if</span> (method == TrFit::LINEAR &amp;&amp; ehit[1] &lt;= 0) {
00209     fit.<a class="code" href="classTrFit.html#a17">LinearFit</a>(1);
00210     chisq = fit.<a class="code" href="classTrFit.html#a5">GetChisqX</a>();
00211   }
00212   <span class="comment">// Y-only fit</span>
00213   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (method == TrFit::LINEAR &amp;&amp; ehit[0] &lt;= 0) {
00214     fit.<a class="code" href="classTrFit.html#a17">LinearFit</a>(2);
00215     chisq = fit.<a class="code" href="classTrFit.html#a6">GetChisqY</a>();
00216   }
00217   <span class="keywordflow">else</span> chisq = fit.<a class="code" href="classTrFit.html#a16">Fit</a>(method);
00218 
00219   <span class="keywordflow">if</span> (chisq &lt; 0)
00220     <a class="code" href="classAMSTrTrack.html#o7">_ChisqXWoMS</a> = <a class="code" href="classAMSTrTrack.html#o8">_ChisqYWoMS</a> = FLT_MAX;
00221   <span class="keywordflow">else</span> {
00222     <a class="code" href="classAMSTrTrack.html#o7">_ChisqXWoMS</a> = fit.<a class="code" href="classTrFit.html#a5">GetChisqX</a>();
00223     <a class="code" href="classAMSTrTrack.html#o8">_ChisqYWoMS</a> = fit.<a class="code" href="classTrFit.html#a6">GetChisqY</a>();
00224 
00225     <a class="code" href="classAMSTrTrack.html#o5">_NdofX</a> = fit.<a class="code" href="classTrFit.html#a3">GetNdofX</a>();
00226     <a class="code" href="classAMSTrTrack.html#o6">_NdofY</a> = fit.<a class="code" href="classTrFit.html#a4">GetNdofY</a>();
00227 
00228     <a class="code" href="classAMSTrTrack.html#o9">_RigidityWoMS</a> = 2.997E-4/fit.<a class="code" href="classTrFit.html#a10">GetParam</a>(4);
00229   }
00230 
00231   <span class="keywordflow">return</span> <a class="code" href="classAMSTrTrack.html#a29">GetChisqWoMS</a>();
00232 }
00233 
00234 
<a name="l00235"></a><a class="code" href="classAMSTrTrack.html#a34">00235</a> <span class="keywordtype">double</span> <a class="code" href="classAMSTrTrack.html#a34">AMSTrTrack::Fit</a>(<span class="keywordtype">int</span> fits, <span class="keywordtype">int</span> layer, <a class="code" href="classTrFit.html">TrFit</a> *trfit)
00236 {
00237   <span class="comment">// fit =0  fit pattern</span>
00238   <span class="comment">// fit =1  fit 1st part if pat=0,1,2,3, ... etc  </span>
00239   <span class="comment">// fit =2  fit 2nd half if pat=0,1,2,3  ... etc + interpolate to beg of 1st</span>
00240   <span class="comment">// fit =3  Geanefit pattern</span>
00241   <span class="comment">// fit =4  fast fit with ims=0</span>
00242   <span class="comment">// fit =5  Juans fit with ims=1</span>
00243   <span class="comment">//</span>
00244   <span class="comment">// For now, only fit =0,4 is supported, ipart is ignored</span>
00245   <span class="comment">//</span>
00246   <span class="comment">// The specified layer is excluded in the fitting</span>
00247   <span class="comment">// If trfit is not null, fitting parameters are left in trfit</span>
00248   <span class="comment">// and data members are not updated</span>
00249 
00250   <span class="keywordflow">if</span> (fits != 0 &amp;&amp; fits != 4) <span class="keywordflow">return</span> FLT_MAX;
00251 
00252   <span class="keywordtype">int</span> fit = abs(fits);
00253   TrFit::_ims = (fit == 4) ? 0 : 1;
00254 
00255   <span class="keywordtype">double</span> zh0 = 0;
00256 
00257   <span class="keywordtype">int</span> update = 0;
00258   <span class="keywordflow">if</span> (!trfit) {
00259     trfit = <span class="keyword">new</span> <a class="code" href="classTrFit.html">TrFit</a>;
00260     update = 1;
00261   }
00262 
00263   trfit-&gt;<a class="code" href="classTrFit.html#a13">Clear</a>();
00264   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _Nhits; i++) {
00265     <a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a> *hit = <a class="code" href="classAMSTrTrack.html#a27">GetHit</a>(i);
00266     <span class="keywordflow">if</span> (!hit || hit-&gt;<a class="code" href="classAMSTrRecHit.html#a7">GetLayer</a>() == layer) <span class="keywordflow">continue</span>;
00267     AMSPoint coo = hit-&gt;<a class="code" href="classAMSTrRecHit.html#a15">GetCoord</a>(<a class="code" href="classAMSTrTrack.html#o2">_iMult</a>[i]);
00268     trfit-&gt;<a class="code" href="classTrFit.html#a14">Add</a>(coo[0], coo[1], coo[2], <a class="code" href="tkdcards_8h.html#a6">TRFITFFKEY</a>.ErrX, <a class="code" href="tkdcards_8h.html#a6">TRFITFFKEY</a>.ErrY, <a class="code" href="tkdcards_8h.html#a6">TRFITFFKEY</a>.ErrZ);
00269     <span class="keywordflow">if</span> (i == 0) zh0 = coo[2];
00270   }
00271 
00272   <span class="keywordtype">int</span> method = TrFit::NORMAL;
00273   <span class="keywordflow">if</span> (MAGFIELDFFKEY.magstat == 0) method = TrFit::LINEAR;
00274     
00275   <span class="keywordtype">int</span> ifail = 0;
00276   <span class="keywordflow">if</span> (trfit-&gt;<a class="code" href="classTrFit.html#a16">Fit</a>(method) &lt; 0) ifail = 1;
00277 
00278   <span class="keywordflow">if</span> (!update) <span class="keywordflow">return</span> (ifail) ? FLT_MAX 
00279                               : trfit-&gt;<a class="code" href="classTrFit.html#a5">GetChisqX</a>()+trfit-&gt;<a class="code" href="classTrFit.html#a6">GetChisqY</a>();
00280 
00281   <span class="comment">// Set fitting residual</span>
00282   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; !ifail &amp;&amp; i &lt; _Nhits; i++) {
00283     <a class="code" href="classAMSTrRecHit.html">AMSTrRecHit</a> *hit = <a class="code" href="classAMSTrTrack.html#a27">GetHit</a>(i);
00284     <span class="keywordflow">if</span> (!hit) <span class="keywordflow">continue</span>;
00285     hit-&gt;<a class="code" href="classAMSTrRecHit.html#a20">SetResidual</a>(AMSPoint(trfit-&gt;<a class="code" href="classTrFit.html#a7">GetXr</a>(i), trfit-&gt;<a class="code" href="classTrFit.html#a8">GetYr</a>(i), 0));
00286   }
00287 
00288   <a class="code" href="classAMSTrTrack.html#o10">_ChisqX</a> = (ifail) ? FLT_MAX : trfit-&gt;<a class="code" href="classTrFit.html#a5">GetChisqX</a>();
00289   <a class="code" href="classAMSTrTrack.html#o11">_ChisqY</a> = (ifail) ? FLT_MAX : trfit-&gt;<a class="code" href="classTrFit.html#a11">GetChisq</a>()-_ChisqX;<span class="comment">//trfit-&gt;GetChisqY();</span>
00290   <a class="code" href="classAMSTrTrack.html#o5">_NdofX</a>  = trfit-&gt;<a class="code" href="classTrFit.html#a3">GetNdofX</a>();
00291   <a class="code" href="classAMSTrTrack.html#o6">_NdofY</a>  = trfit-&gt;<a class="code" href="classTrFit.html#a4">GetNdofY</a>();
00292 
00293   <a class="code" href="classAMSTrTrack.html#o12">_Rigidity</a> = (trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(4) != 0) ? 1./trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(4) : 1.e10;
00294   <a class="code" href="classAMSTrTrack.html#o13">_ErrRinv</a>  = trfit-&gt;<a class="code" href="classTrFit.html#a12">GetErig</a>();
00295   <a class="code" href="classAMSTrTrack.html#o14">_Theta</a> = std::acos(-1/std::sqrt(1+trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(1)*trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(1)
00296                                    +trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(3)*trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(3)));
00297   <a class="code" href="classAMSTrTrack.html#o15">_Phi</a> = std::atan2(-trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(3),-trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(1));
00298   <a class="code" href="classAMSTrTrack.html#o16">_P0x</a> = trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(0);
00299   <a class="code" href="classAMSTrTrack.html#o17">_P0y</a> = trfit-&gt;<a class="code" href="classTrFit.html#a10">GetParam</a>(2);
00300   <a class="code" href="classAMSTrTrack.html#o18">_P0z</a> = zh0;
00301 
00302   <span class="keyword">delete</span> trfit;
00303 
00304   <span class="keywordflow">return</span> (ifail) ? FLT_MAX : <a class="code" href="classAMSTrTrack.html#o10">_ChisqX</a>+_ChisqY;<span class="comment">//GetChisq();</span>
00305 }
00306 
<a name="l00307"></a><a class="code" href="classAMSTrTrack.html#e2">00307</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrTrack.html#e2">AMSTrTrack::print</a>(<span class="keywordtype">void</span>)
00308 {
00309  <span class="comment">//  std::cout &lt;&lt; "AMSContainer:AMSTrTrack 0 Elements: " </span>
00310 <span class="comment">//          &lt;&lt; _event-&gt;NTrTracks &lt;&lt; std::endl;</span>
00311 <span class="comment">//   for (int i = 0; i &lt; _event-&gt;NTrTracks; i++)</span>
00312 <span class="comment">//     _event-&gt;GetTrTrack(i)-&gt;_printEl();</span>
00313 
00314 }
<a name="l00315"></a><a class="code" href="classAMSTrTrack.html#a35">00315</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrTrack.html#a35">AMSTrTrack::myprint</a>(<span class="keywordtype">void</span>){
00316   printf(<span class="stringliteral">"Tracks  \n"</span>);
00317   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;<a class="code" href="classAMSTrTrack.html#a11">GetNhits</a>();ii++)
00318     printf(<span class="stringliteral">" %d pointer %X  index: %d\n "</span>,ii,<a class="code" href="classAMSTrTrack.html#o0">_Hits</a>[ii],<a class="code" href="classAMSTrTrack.html#o1">_iHits</a>[ii]);
00319 }
00320 
<a name="l00321"></a><a class="code" href="classAMSTrTrack.html#a46">00321</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrTrack.html#b0">AMSTrTrack::_printEl</a>(std::ostream&amp; ost )
00322 {
00323   ost &lt;&lt; <span class="stringliteral">" Pattern "</span> &lt;&lt; <a class="code" href="classAMSTrTrack.html#o3">_Pattern</a> 
00324             &lt;&lt; <span class="stringliteral">" Rigidity (no MS)"</span> &lt;&lt; <a class="code" href="classAMSTrTrack.html#o9">_RigidityWoMS</a>
00325             &lt;&lt; <span class="stringliteral">" Rigidity (Fast) "</span> &lt;&lt; <a class="code" href="classAMSTrTrack.html#o12">_Rigidity</a> 
00326             &lt;&lt; <span class="stringliteral">" Chi2Fast "</span> &lt;&lt; <a class="code" href="classAMSTrTrack.html#o10">_ChisqX</a>+<a class="code" href="classAMSTrTrack.html#o11">_ChisqY</a>
00327             &lt;&lt; <span class="stringliteral">" ThetaFast "</span> &lt;&lt;<a class="code" href="classAMSTrTrack.html#o14">_Theta</a> &lt;&lt; <span class="stringliteral">" PhiFast "</span> &lt;&lt; <a class="code" href="classAMSTrTrack.html#o15">_Phi</a> &lt;&lt; std::endl;
00328 }
00329 
<a name="l00330"></a><a class="code" href="classAMSTrTrack.html#a47">00330</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrTrack.html#b0">AMSTrTrack::_printEl</a>(std::string&amp; ost )
00331 {
00332   <span class="keywordtype">char</span> cc[280];
00333   sprintf(cc, <span class="stringliteral">" Pattern %02X\n  Rigidity (no MS) %f\n Rigidity (Fast) %f\n Chi2Fast %f\n ThetaFast %f\n PhiFast %f\n"</span>,
00334          <a class="code" href="classAMSTrTrack.html#o3">_Pattern</a>,<a class="code" href="classAMSTrTrack.html#o9">_RigidityWoMS</a>,<a class="code" href="classAMSTrTrack.html#o12">_Rigidity</a> ,<a class="code" href="classAMSTrTrack.html#o10">_ChisqX</a>+<a class="code" href="classAMSTrTrack.html#o11">_ChisqY</a>,<a class="code" href="classAMSTrTrack.html#o14">_Theta</a>,<a class="code" href="classAMSTrTrack.html#o15">_Phi</a>);
00335   ost.append(cc);
00336 }
00337 
00338 <span class="preprocessor">#include "amsgobj.h"</span>
00339 
<a name="l00340"></a><a class="code" href="classAMSTrTrackError.html#a0">00340</a> <a class="code" href="classAMSTrTrackError.html#a0">AMSTrTrackError::AMSTrTrackError</a>(<span class="keywordtype">char</span> * name){
00341   <span class="keywordflow">if</span>(name){
00342     integer n=strlen(name)+1;
00343     <span class="keywordflow">if</span>(n&gt;255)n=255;
00344     strncpy(<a class="code" href="classAMSTrTrackError.html#r0">msg</a>,name,n);
00345   }
00346   AMSgObj::BookTimer.stop(<span class="stringliteral">"TrTrack"</span>,1);
00347   AMSgObj::BookTimer.stop(<span class="stringliteral">"RETKEVENT"</span>,1);
00348   AMSgObj::BookTimer.stop(<span class="stringliteral">"REAMSEVENT"</span>,1);
00349   <span class="comment">//  AMSEvent::gethead()-&gt;seterror(2);</span>
00350 }
<a name="l00351"></a><a class="code" href="classAMSTrTrackError.html#a1">00351</a> <span class="keywordtype">char</span> * <a class="code" href="classAMSTrTrackError.html#a1">AMSTrTrackError::getmessage</a>(){<span class="keywordflow">return</span> msg;}
00352 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:04 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
