<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: include/TrRecon.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">include</a></div>
<h1>TrRecon.h</h1><a href="TrRecon_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">// $Id: TrRecon.h,v 1.8 2008/10/28 18:31:30 haino Exp $ </span>
00002 <span class="preprocessor">#ifndef __TrRecon__</span>
00003 <span class="preprocessor"></span><span class="preprocessor">#define __TrRecon__</span>
00004 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include "typedefs.h"</span>
00026 <span class="preprocessor">#include "point.h"</span>
00027 <span class="preprocessor">#include "cont.h"</span>
00028 <span class="preprocessor">#include "<a class="code" href="TrRawCluster_8h.html">TrRawCluster.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="TrCluster_8h.html">TrCluster.h</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="TrTrack_8h.html">TrTrack.h</a>"</span>
00031 <span class="preprocessor">#include "<a class="code" href="TrRecHit_8h.html">TrRecHit.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00033 <span class="preprocessor">#include "<a class="code" href="TrFit_8h.html">TrFit.h</a>"</span>
00034 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00035 <span class="preprocessor">#include "<a class="code" href="VCon_8h.html">VCon.h</a>"</span>
00036 <span class="preprocessor">#include "TMath.h"</span>
00037 
00038 <span class="preprocessor">#include &lt;cmath&gt;</span>
00039 <span class="preprocessor">#include &lt;vector&gt;</span>
00040 <span class="preprocessor">#include &lt;map&gt;</span>
00041 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00042 
00043 
00044 
<a name="l00045"></a><a class="code" href="classTrRecon.html">00045</a> <span class="keyword">class </span><a class="code" href="classTrRecon.html">TrRecon</a> {
00046 
00047  <span class="keyword">public</span>:  
00049   <span class="keyword">enum</span> { MAXLAY = 8 };
00051   <span class="keyword">enum</span> { AMBIG = 4, USED = 32 };
00052 
00053  <span class="keyword">protected</span>: 
<a name="l00055"></a><a class="code" href="classTrRecon.html#p0">00055</a>   <a class="code" href="classAMSTrTrack.html">AMSTrTrack</a>* _ptest;
<a name="l00056"></a><a class="code" href="classTrRecon.html#p1">00056</a>   <a class="code" href="classAMSTrTrack.html">AMSTrTrack</a>* _ptrack;
00057 
00058 
00060   <span class="keyword">static</span> <span class="keywordtype">double</span> _csqmin;
00061 
00063   <span class="keyword">static</span> <span class="keywordtype">int</span> NHitPatterns;
00065   <span class="keyword">static</span> <span class="keywordtype">int</span> *HitPatternMask;
00067   <span class="keyword">static</span> <span class="keywordtype">int</span> *HitPatternAttrib;
00068 
<a name="l00070"></a><a class="code" href="classTrRecon.html#p2">00070</a>   map&lt; int, pair&lt; vector&lt;AMSTrCluster*&gt;, vector&lt;AMSTrCluster*&gt; &gt; &gt; _ClusterTkIdMap;
<a name="l00071"></a><a class="code" href="classTrRecon.html#x0">00071</a>   <span class="keyword">typedef</span> map&lt; int, pair&lt; vector&lt;AMSTrCluster*&gt;, vector&lt;AMSTrCluster*&gt; &gt; &gt;::iterator ITClusterMap;
<a name="l00073"></a><a class="code" href="classTrRecon.html#p3">00073</a>   map&lt; int, vector&lt;AMSTrRecHit*&gt; &gt; _RecHitLayerMap;
00074    
00076 <span class="keyword">public</span>:
00078   <span class="keyword">static</span> <span class="keywordtype">float</span> ThrSeed[2];
00080   <span class="keyword">static</span> <span class="keywordtype">float</span> ThrNeig[2];
00082   <span class="keyword">static</span> <span class="keywordtype">int</span>   SeedDist[2];
00083 
00085   <span class="keyword">static</span> <span class="keywordtype">float</span> GGpars[6];
00087   <span class="keyword">static</span> <span class="keywordtype">float</span> GGintegral;
00089   <span class="keyword">static</span> <span class="keywordtype">float</span> ThrProb;
00090 
00091 
00092  <span class="keyword">protected</span>:
00093 
00096   <span class="keyword">enum</span> { BUFSIZE = 1024 };
00098   <span class="keyword">static</span> <span class="keywordtype">float</span> _adcbuf[BUFSIZE];
00099   <span class="keyword">static</span> <span class="keywordtype">float</span> _sigbuf[BUFSIZE];
00101   <span class="keyword">static</span> <span class="keywordtype">int</span>   _stabuf[BUFSIZE];
00103   <span class="keyword">static</span> vector&lt;int&gt; _seedaddresses;   
00104 
00105   <span class="keyword">static</span> <span class="keywordtype">float</span> _adcbuf2[BUFSIZE];
00106   <span class="keyword">static</span> <span class="keywordtype">float</span> _sigbuf2[BUFSIZE];
00107   <span class="keyword">static</span> <span class="keywordtype">int</span>   _stabuf2[BUFSIZE];
00108 <span class="keyword">private</span>:
<a name="l00110"></a><a class="code" href="classTrRecon.html#d0">00110</a>   <a class="code" href="classTrRecon.html">TrRecon</a>(){Clear();  cal=0;}
<a name="l00112"></a><a class="code" href="classTrRecon.html#d1">00112</a>   <a class="code" href="classTrRecon.html">TrRecon</a>(<a class="code" href="classTrRecon.html">TrRecon</a>&amp; orig){}
00113 
00114   <span class="keyword">static</span> <a class="code" href="classTrCalDB.html">TrCalDB</a>* _trcaldb;
<a name="l00115"></a><a class="code" href="classTrRecon.html#r0">00115</a>   <a class="code" href="classTrLadCal.html">TrLadCal</a>* cal;
00116 <span class="keyword">public</span>:
00118   <span class="keyword">static</span> <a class="code" href="classTrRecon.html">TrRecon</a>*  Head;
<a name="l00120"></a><a class="code" href="classTrRecon.html#e0">00120</a>   <span class="keyword">static</span> <a class="code" href="classTrRecon.html">TrRecon</a>*  gethead() {<span class="keywordflow">return</span> Head;}
00122   <span class="keyword">static</span> <a class="code" href="classTrRecon.html">TrRecon</a>*  Create(<span class="keywordtype">int</span> recreate=0);
00124   ~<a class="code" href="classTrRecon.html">TrRecon</a>();
00126   <span class="keywordtype">void</span>   Clear(Option_t *option = <span class="stringliteral">""</span>);
00128   <span class="keywordtype">void</span> SetParFromDataCards();
00129 
00130 
00131 
<a name="l00133"></a><a class="code" href="classTrRecon.html#e2">00133</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> UsingTrCalDB(<a class="code" href="classTrCalDB.html">TrCalDB</a>* trcaldb) { _trcaldb = trcaldb; }
<a name="l00135"></a><a class="code" href="classTrRecon.html#a3">00135</a>   <a class="code" href="classTrCalDB.html">TrCalDB</a>*    GetTrCalDB() { <span class="keywordflow">return</span> _trcaldb; }
00136 
00137 
00138 
00139 
00140   
00141   <span class="comment">// --- Clustering Methods --- // </span>
<a name="l00143"></a><a class="code" href="classTrRecon.html#a4">00143</a> <span class="comment"></span>  <span class="keywordtype">void</span>   SetThrSeed(<span class="keywordtype">int</span> side, <span class="keywordtype">float</span> thr) { ThrSeed[side] = thr; }
<a name="l00145"></a><a class="code" href="classTrRecon.html#a5">00145</a>   <span class="keywordtype">void</span>   SetThrNeig(<span class="keywordtype">int</span> side, <span class="keywordtype">float</span> thr) { ThrNeig[side] = thr; }
<a name="l00147"></a><a class="code" href="classTrRecon.html#a6">00147</a>   <span class="keywordtype">void</span>   SetSeedDist(<span class="keywordtype">int</span> side, <span class="keywordtype">int</span> dist) { SeedDist[side] = dist; }
00148 
00150   <span class="keywordtype">void</span> ClearBuffer();
00152   <span class="keywordtype">int</span>  ExpandClusterInBuffer(<a class="code" href="classAMSTrRawCluster.html">AMSTrRawCluster</a>* cluster);
00153 
00154 
00156   <span class="keywordtype">int</span>  BuildTrClusters(<span class="keywordtype">int</span> rebuild=0);
00157 
00158 
00160   <span class="keywordtype">int</span>  BuildTrClustersInSubBuffer(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <span class="keywordtype">int</span> cyclicity = 0);
00162   <span class="keywordtype">int</span>  BuildSeedListInSubBuffer(<span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <span class="keywordtype">int</span> cyclicity = 0);
00164   <span class="keywordtype">int</span>  GetBoundariesInSubBuffer(<span class="keywordtype">int</span> index, <span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <span class="keywordtype">int</span> cyclicity = 0);
00166   <span class="keywordtype">int</span>  GetAddressInSubBuffer(<span class="keywordtype">int</span> address, <span class="keywordtype">int</span> first, <span class="keywordtype">int</span> last, <span class="keywordtype">int</span> ciclicity = 0);
00167 
00168 
00169  <span class="comment">// --- Hit Signal Correlation (only muons for the moment) --- //</span>
00170   <span class="comment">// --- No reordering implemented --- // </span>
00171 
<a name="l00173"></a><a class="code" href="classTrRecon.html#a14">00173</a>   <span class="keywordtype">void</span>  SetThrProb(<span class="keywordtype">float</span> prob) { ThrProb = prob; }
<a name="l00175"></a><a class="code" href="classTrRecon.html#a15">00175</a>   <span class="keywordtype">float</span> GetCorrelation(<span class="keywordtype">float</span> n, <span class="keywordtype">float</span> p) { <span class="keywordflow">return</span> (p - n)/(p + n); }
00176   <span class="keywordtype">float</span> GetCorrelation(<a class="code" href="classAMSTrCluster.html">TrClusterR</a>* cln, <a class="code" href="classAMSTrCluster.html">TrClusterR</a>* clp);
00178   <span class="keywordtype">float</span> GetProbToBeCorrelated(<span class="keywordtype">float</span> n, <span class="keywordtype">float</span> p);
00179   <span class="keywordtype">float</span> GetProbToBeCorrelated(<a class="code" href="classAMSTrCluster.html">TrClusterR</a>* cln, <a class="code" href="classAMSTrCluster.html">TrClusterR</a>* clp);
00180  
00182   <span class="keywordtype">void</span>  BuildClusterTkIdMap();
<a name="l00184"></a><a class="code" href="classTrRecon.html#a20">00184</a>   <span class="keywordtype">int</span>   GetnActiveLadders() { <span class="keywordflow">return</span> _ClusterTkIdMap.size(); } 
00185  
00187   <span class="keywordtype">int</span>   GetnTrClusters(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> side);
00189   <a class="code" href="classAMSTrCluster.html">TrClusterR</a>* GetTrCluster(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> side, <span class="keywordtype">int</span> iclus);
00191   <span class="keywordtype">int</span>   BuildTrRecHits(<span class="keywordtype">int</span> rebuild=0);
00192 
00193 
00195   <span class="keywordtype">void</span> BuildHitPatterns(<span class="keywordtype">int</span> n = -1, <span class="keywordtype">int</span> i = 0, <span class="keywordtype">int</span> mask = 0);
00196 
<a name="l00198"></a><a class="code" href="classTrRecon.html#a25">00198</a>   <span class="keywordtype">int</span> GetHitPatternMask(<span class="keywordtype">int</span> i) {
00199     <span class="keywordflow">return</span> (HitPatternMask &amp;&amp; 0 &lt;= i &amp;&amp; i &lt; NHitPatterns) ? HitPatternMask[i] : 0;
00200   }
<a name="l00202"></a><a class="code" href="classTrRecon.html#a26">00202</a>   <span class="keywordtype">int</span> GetHitPatternAttrib(<span class="keywordtype">int</span> i) {
00203     <span class="keywordflow">return</span> (HitPatternAttrib &amp;&amp; 0 &lt;= i &amp;&amp; i &lt; NHitPatterns) ? HitPatternAttrib[i] : 0;
00204   }
00205 
00207   <span class="keywordtype">int</span> BuildTrTracks(<span class="keywordtype">int</span> refit = 0);
00208 
00210   <span class="keywordtype">void</span> BuildRecHitLayerMap();
00211 
00213   <span class="keywordtype">void</span> ScanHit(<span class="keywordtype">int</span> *layer, <span class="keywordtype">int</span> *iscan = 0, <span class="keywordtype">int</span> *imult = 0, <span class="keywordtype">int</span> i = 0);
00214 
00215 
00216   <span class="keyword">static</span> <a class="code" href="classVCon.html">VCon</a>* TRCon;
00217 
00218 <span class="keyword">private</span>:
00219 
00220  <span class="keyword">static</span> <span class="keywordtype">void</span> DSP_Clusterize(<span class="keywordtype">int</span> tkid,<span class="keywordtype">float</span> *buf);
00221 
00222 <span class="keyword">public</span>: 
00224   <span class="keyword">static</span> <span class="keywordtype">void</span> sitkhits(<span class="keywordtype">int</span> idsoft, <span class="keywordtype">float</span> vect[],
00225                       <span class="keywordtype">float</span> edep, <span class="keywordtype">float</span> step, <span class="keywordtype">int</span> itra);
<a name="l00227"></a><a class="code" href="classTrRecon.html#e4">00227</a>   <span class="keyword">static</span> <span class="keywordtype">void</span> sitknoise(){}
00228 
00230   <span class="keyword">static</span> <span class="keywordtype">void</span> sitkdigi(); 
00231 };
00232 
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>
00235 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:04 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
