<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TrLadCal.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TrLadCal.C</h1><a href="TrLadCal_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 
00003 
00004 
00005 
00006 
00007 
00008 
00009 
00010 
00011 <span class="preprocessor">#include "<a class="code" href="TrLadCal_8h.html">TrLadCal.h</a>"</span>
00012 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00013 
00014 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00015 <span class="preprocessor">#include &lt;string&gt;</span>
00016 <span class="preprocessor">#include &lt;cstring&gt;</span>    <span class="comment">// for memset</span>
00017 <span class="preprocessor">#include &lt;iostream&gt;</span>
00018 <span class="preprocessor">#include &lt;vector&gt;</span>
00019 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00020 
00021 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00022 
00023 <a class="code" href="TrTrack_8C.html#a0">ClassImp</a>(<a class="code" href="classTrLadCal.html">TrLadCal</a>);
00024 
<a name="l00025"></a><a class="code" href="classTrLadCal.html#s0">00025</a> <span class="keywordtype">int</span> <a class="code" href="classTrLadCal.html#s0">TrLadCal::dead</a>=0x2;
00026 
00027 
<a name="l00028"></a><a class="code" href="classTrLadCal.html#d0">00028</a> geant <a class="code" href="classTrLadCal.html#d0">TrLadCal::_getnum</a>(geant * pp, <span class="keywordtype">int</span> ii){
00029   <span class="comment">// if (!_filled||ii&lt;0||ii&gt;1023) return -9999;</span>
00030   <span class="keywordflow">return</span> pp[ii];
00031 }
00032 
00033 
<a name="l00034"></a><a class="code" href="classTrLadCal.html#d1">00034</a> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="classTrLadCal.html#d0">TrLadCal::_getnum</a>(<span class="keywordtype">short</span> <span class="keywordtype">int</span> * pp, <span class="keywordtype">int</span> ii){
00035   <span class="comment">// if (!_filled||ii&lt;0||ii&gt;1023) return -9999;</span>
00036   <span class="keywordflow">return</span> pp[ii];
00037 }
00038 
00039 
<a name="l00040"></a><a class="code" href="classTrLadCal.html#d2">00040</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#d2">TrLadCal::_setnum</a>(geant * pp, <span class="keywordtype">int</span> ii,geant val){
00041   <span class="keywordflow">if</span> (!<a class="code" href="classTrLadCal.html#r4">_filled</a>||ii&lt;0||ii&gt;1023) <span class="keywordflow">return</span>;
00042   pp[ii]=val;
00043 }
00044 
<a name="l00045"></a><a class="code" href="classTrLadCal.html#d3">00045</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#d2">TrLadCal::_setnum</a>(<span class="keywordtype">short</span> <span class="keywordtype">int</span> * pp, <span class="keywordtype">int</span> ii,<span class="keywordtype">short</span> <span class="keywordtype">int</span> val){
00046   <span class="keywordflow">if</span> (!<a class="code" href="classTrLadCal.html#r4">_filled</a>||ii&lt;0||ii&gt;1023) <span class="keywordflow">return</span>;
00047   pp[ii]=val;
00048 }
00049 
00050 
<a name="l00051"></a><a class="code" href="classTrLadCal.html#a0">00051</a> <a class="code" href="classTrLadCal.html#a0">TrLadCal::TrLadCal</a>(<span class="keywordtype">short</span> <span class="keywordtype">int</span> hwid) {
00052   <a class="code" href="classTrLadCal.html#o0">HwId</a>=hwid;
00053   <a class="code" href="classTrLadCal.html#r4">_filled</a>=0;
00054   <a class="code" href="classTrLadCal.html#a3">Clear</a>();
00055 }
00056 
00057 
<a name="l00058"></a><a class="code" href="classTrLadCal.html#a4">00058</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#a4">TrLadCal::Fill</a>(<a class="code" href="structCaloutDSP.html">CaloutDSP</a>* cc) {
00059   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00060     <a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii]  = cc-&gt;<a class="code" href="structCaloutDSP.html#o0">ped</a>[ii]/8.;
00061     <a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii]  = cc-&gt;<a class="code" href="structCaloutDSP.html#o1">rsig</a>[ii]/8./(cc-&gt;<a class="code" href="structCaloutDSP.html#o7">sigrawthres</a>*1.);
00062     <a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii]     = cc-&gt;<a class="code" href="structCaloutDSP.html#o2">sig</a>[ii]/(cc-&gt;<a class="code" href="structCaloutDSP.html#o5">lowthres</a>*1.);
00063     <a class="code" href="classTrLadCal.html#r3">_Status</a>[ii]    = cc-&gt;<a class="code" href="structCaloutDSP.html#o3">status</a>[ii];
00064   }
00065 
00066   <a class="code" href="classTrLadCal.html#o1">dspver</a>=cc-&gt;<a class="code" href="structCaloutDSP.html#o4">dspver</a>;
00067   <a class="code" href="classTrLadCal.html#o2">lowthres</a>=cc-&gt;<a class="code" href="structCaloutDSP.html#o5">lowthres</a>;
00068   <a class="code" href="classTrLadCal.html#o3">highthres</a>=cc-&gt;<a class="code" href="structCaloutDSP.html#o6">highthres</a>;
00069   <a class="code" href="classTrLadCal.html#o4">sigrawthres</a>=cc-&gt;<a class="code" href="structCaloutDSP.html#o7">sigrawthres</a>;
00070   <a class="code" href="classTrLadCal.html#o5">calstatus</a>=cc-&gt;<a class="code" href="structCaloutDSP.html#o9">calstatus</a>;    
00071   
00072   <a class="code" href="classTrLadCal.html#r4">_filled</a>=1;
00073 }
00074 
<a name="l00075"></a><a class="code" href="classTrLadCal.html#a27">00075</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#a27">TrLadCal::CopyCont</a>(<a class="code" href="classTrLadCal.html">TrLadCal</a>&amp; orig){
00076   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00077     <a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii]   = orig.<a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii];
00078     <a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii]   = orig.<a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii];
00079     <a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii]      = orig.<a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii];
00080     <a class="code" href="classTrLadCal.html#r3">_Status</a>[ii]     = orig.<a class="code" href="classTrLadCal.html#r3">_Status</a>[ii];
00081   }
00082 
00083 }
<a name="l00084"></a><a class="code" href="classTrLadCal.html#a1">00084</a> <a class="code" href="classTrLadCal.html#a0">TrLadCal::TrLadCal</a>(<span class="keyword">const</span> <a class="code" href="classTrLadCal.html">TrLadCal</a>&amp; orig):TObject(orig){
00085   <a class="code" href="classTrLadCal.html#o0">HwId</a>  = orig.<a class="code" href="classTrLadCal.html#o0">HwId</a>;
00086   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00087     <a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii]   = orig.<a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii];
00088     <a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii]   = orig.<a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii];
00089     <a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii]      = orig.<a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii];
00090     <a class="code" href="classTrLadCal.html#r3">_Status</a>[ii]     = orig.<a class="code" href="classTrLadCal.html#r3">_Status</a>[ii];
00091   }
00092 
00093   <a class="code" href="classTrLadCal.html#o1">dspver</a>=orig.<a class="code" href="classTrLadCal.html#o1">dspver</a>;
00094   <a class="code" href="classTrLadCal.html#o2">lowthres</a>=orig.<a class="code" href="classTrLadCal.html#o2">lowthres</a>;
00095   <a class="code" href="classTrLadCal.html#o3">highthres</a>=orig.<a class="code" href="classTrLadCal.html#o3">highthres</a>;
00096   <a class="code" href="classTrLadCal.html#o4">sigrawthres</a>=orig.<a class="code" href="classTrLadCal.html#o4">sigrawthres</a>;
00097   <a class="code" href="classTrLadCal.html#o5">calstatus</a>=orig.<a class="code" href="classTrLadCal.html#o5">calstatus</a>;    
00098 }
00099 
00100 
<a name="l00101"></a><a class="code" href="classTrLadCal.html#a3">00101</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#a3">TrLadCal::Clear</a>(){
00102   <a class="code" href="classTrLadCal.html#r4">_filled</a>=0;
00103   memset(<a class="code" href="classTrLadCal.html#r0">_Pedestal</a>,0,<span class="keyword">sizeof</span>(<a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[0])*1024);
00104   memset(<a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>,0,<span class="keyword">sizeof</span>(<a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[0])*1024);
00105   memset(<a class="code" href="classTrLadCal.html#r2">_Sigma</a>   ,0,<span class="keyword">sizeof</span>(<a class="code" href="classTrLadCal.html#r2">_Sigma</a>[0])*1024);
00106   memset(<a class="code" href="classTrLadCal.html#r3">_Status</a>  ,0,<span class="keyword">sizeof</span>(<a class="code" href="classTrLadCal.html#r3">_Status</a>[0])*1024);
00107   <a class="code" href="classTrLadCal.html#o1">dspver</a>=0;
00108   <a class="code" href="classTrLadCal.html#o2">lowthres</a>=0.;
00109   <a class="code" href="classTrLadCal.html#o3">highthres</a>=0.;
00110   <a class="code" href="classTrLadCal.html#o4">sigrawthres</a>=0.;
00111   <a class="code" href="classTrLadCal.html#o5">calstatus</a>=0;
00112 }
00113 
00114 
<a name="l00115"></a><a class="code" href="classTrLadCal.html#a26">00115</a> <span class="keywordtype">void</span> <a class="code" href="classTrLadCal.html#a26">TrLadCal::PrintInfo</a>(<span class="keywordtype">int</span> long_format){
00116   <a class="code" href="classTkLadder.html">TkLadder</a>* lad=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a23">FindHwId</a>(<a class="code" href="classTrLadCal.html#o0">HwId</a>);
00117   <span class="keywordflow">if</span>(!lad) {
00118     printf(<span class="stringliteral">"TrLadCal::PrintInfo() - Error - Can't find the ladder with HwId %4d\n"</span>,<a class="code" href="classTrLadCal.html#o0">HwId</a>);
00119     <span class="keywordflow">return</span>;
00120   }
00121   printf(<span class="stringliteral">"Ladder Name: %s  Filled: %d\n"</span>,lad-&gt;<a class="code" href="classTkObject.html#o0">name</a>,<a class="code" href="classTrLadCal.html#r4">_filled</a>);
00122   printf(<span class="stringliteral">"Layer: %d Slot: %2d  Side: %d \n"</span>, 
00123          lad-&gt;<a class="code" href="classTkLadder.html#a4">GetLayer</a>(),lad-&gt;<a class="code" href="classTkLadder.html#a5">GetSlot</a>(),lad-&gt;<a class="code" href="classTkLadder.html#a6">GetSide</a>()); 
00124   printf(<span class="stringliteral">"Octant: %d %s Crate: %d TDR:  %2d  PwGroup: %d PwgrupPos: %d\n"</span>,
00125          lad-&gt;<a class="code" href="classTkLadder.html#a7">GetOctant</a>(),TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a5">GetOctName</a>(lad-&gt;<a class="code" href="classTkLadder.html#a7">GetOctant</a>()),
00126          lad-&gt;<a class="code" href="classTkLadder.html#a8">GetCrate</a>(),lad-&gt;<a class="code" href="classTkLadder.html#a9">GetTdr</a>(),
00127          lad-&gt;<a class="code" href="classTkLadder.html#a11">GetPwGroup</a>(),lad-&gt;<a class="code" href="classTkLadder.html#a12">GetPwgroupPos</a>());
00128   <span class="keywordflow">if</span>(long_format){
00129     printf(<span class="stringliteral">" Chan     Ped  SigRaw  Sigma     Bit0 Bit1 Bit2 Bit3 Bit4 Bit5 Bit6 Bit7\n"</span>);
00130     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++)
00131       <span class="comment">// printf(" %4d %7.3f  %7.3f %7.3f  %4d \n",</span>
00132       <span class="comment">//             ii,Pedestal(ii),SigmaRaw(ii),Sigma(ii),Status(ii));</span>
00133       printf(<span class="stringliteral">" %4d %7.3f  %7.3f %7.3f  %1d %1d %1d %1d %1d %1d %1d %1d \n"</span>,
00134              ii,<a class="code" href="classTrLadCal.html#a10">GetPedestal</a>(ii),<a class="code" href="classTrLadCal.html#a12">GetSigmaRaw</a>(ii),<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(ii),
00135              <a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;1&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;2&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;3&amp;1,
00136              <a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;4&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;5&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;6&amp;1,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;7&amp;1);
00137   }
00138 }
00139 
00140 
00141 
<a name="l00142"></a><a class="code" href="classTrLadCal.html#a28">00142</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>&amp; <a class="code" href="classTrLadCal.html#a28">TrLadCal::operator-</a>(<a class="code" href="classTrLadCal.html">TrLadCal</a> &amp;orig){
00143   <a class="code" href="classTrLadCal.html">TrLadCal</a>* pp= <span class="keyword">new</span> <a class="code" href="classTrLadCal.html#a0">TrLadCal</a>(*<span class="keyword">this</span>);
00144   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00145      pp-&gt;<a class="code" href="classTrLadCal.html#a14">SetPedestal</a> (ii,<a class="code" href="classTrLadCal.html#a10">GetPedestal</a>(ii)-orig.<a class="code" href="classTrLadCal.html#a5">Pedestal</a>(ii));
00146      pp-&gt;<a class="code" href="classTrLadCal.html#a16">SetSigmaRaw</a> (ii,<a class="code" href="classTrLadCal.html#a12">GetSigmaRaw</a>(ii)-orig.<a class="code" href="classTrLadCal.html#a7">SigmaRaw</a>(ii));
00147      pp-&gt;<a class="code" href="classTrLadCal.html#a15">SetSigma</a>    (ii,<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(ii)-orig.<a class="code" href="classTrLadCal.html#a6">Sigma</a>(ii));
00148      pp-&gt;<a class="code" href="classTrLadCal.html#a17">SetStatus</a>   (ii,<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)^orig.<a class="code" href="classTrLadCal.html#a8">Status</a>(ii));
00149   }
00150   <span class="keywordflow">return</span> *pp;
00151 }
00152  
<a name="l00153"></a><a class="code" href="classTrLadCal.html#a29">00153</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>&amp; <a class="code" href="classTrLadCal.html#a29">TrLadCal::operator=</a>(<a class="code" href="classTrLadCal.html">TrLadCal</a>&amp; orig){
00154   <a class="code" href="classTrLadCal.html#o0">HwId</a>=orig.<a class="code" href="classTrLadCal.html#o0">HwId</a>;
00155   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00156     <a class="code" href="classTrLadCal.html#a14">SetPedestal</a>(ii,orig.<a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii]);
00157     <a class="code" href="classTrLadCal.html#a16">SetSigmaRaw</a>(ii,orig.<a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii]);
00158     <a class="code" href="classTrLadCal.html#a15">SetSigma</a>(ii,orig.<a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii]);
00159     <a class="code" href="classTrLadCal.html#a17">SetStatus</a>(ii,orig.<a class="code" href="classTrLadCal.html#r3">_Status</a>[ii]);
00160   }
00161   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00162 }
00163 
00164 
00165 <span class="comment">//Finds the kth smallest number </span>
<a name="l00166"></a><a class="code" href="classTrLadCal.html#a20">00166</a> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code" href="classTrLadCal.html#a20">TrLadCal::DSPSmallest</a>(<span class="keywordtype">short</span> <span class="keywordtype">int</span> a[], <span class="keywordtype">int</span> n, <span class="keywordtype">int</span> k){
00167   <span class="keywordtype">short</span> <span class="keywordtype">int</span> i,j,l,m ;
00168   <span class="keywordtype">short</span> <span class="keywordtype">int</span> x ;
00169   l=0 ; m=n-1 ;
00170   <span class="keywordflow">while</span> (l&lt;m) {
00171     x=a[k] ;
00172     i=l ;
00173     j=m ;
00174     <span class="keywordflow">do</span> {
00175       <span class="keywordflow">while</span> (a[i]&lt;x) i++ ;
00176       <span class="keywordflow">while</span> (x&lt;a[j]) j-- ;
00177       <span class="keywordflow">if</span> (i&lt;=j) {
00178         <span class="comment">//      ELEM_SWAP(a[i],a[j]) ;</span>
00179         <span class="keywordtype">int</span> tt=a[i];
00180         a[i]=a[j];
00181         a[j]=tt;
00182         i++ ; j-- ;
00183       }
00184     } <span class="keywordflow">while</span> (i&lt;=j) ;
00185     <span class="keywordflow">if</span> (j&lt;k) l=i ;
00186     <span class="keywordflow">if</span> (k&lt;i) m=j ;
00187   }
00188   <span class="keywordflow">return</span> a[k] ;
00189 }
00190 
<a name="l00191"></a><a class="code" href="classTrLadCal.html#a21">00191</a> geant <a class="code" href="classTrLadCal.html#a21">TrLadCal::GetDSPSigmaRawOnMediane</a>(<span class="keywordtype">int</span> ii) {
00192   <span class="keywordtype">int</span> iVA   = ii/64;
00193   <span class="keywordtype">int</span> first = iVA*64;
00194   <span class="keywordtype">int</span> last  = (iVA+1)*64;
00195   <span class="keywordtype">short</span> <span class="keywordtype">int</span> raw[64];
00196   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=first; jj&lt;last; jj++) raw[jj-first] = (<span class="keywordtype">short</span> int) (8*<a class="code" href="classTrLadCal.html#a12">GetSigmaRaw</a>(jj)); 
00197   <span class="keywordtype">short</span> <span class="keywordtype">int</span> mediane  = <a class="code" href="classTrLadCal.html#a20">DSPSmallest</a>(raw,64,32);
00198   <span class="keywordtype">short</span> <span class="keywordtype">int</span> sigmaraw = (<span class="keywordtype">short</span> int) (8*<a class="code" href="classTrLadCal.html#a12">GetSigmaRaw</a>(ii));
00199   <span class="keywordflow">return</span> 1.*sigmaraw/mediane;
00200 }
00201 
<a name="l00202"></a><a class="code" href="classTrLadCal.html#a22">00202</a> geant <a class="code" href="classTrLadCal.html#a22">TrLadCal::GetDSPSigmaOnMediane</a>(<span class="keywordtype">int</span> ii) {
00203   <span class="keywordtype">int</span> iADC  = (ii&lt;640) ? ii/320       : 3;
00204   <span class="keywordtype">int</span> first = (iADC&lt;2) ? iADC*320     : 640;
00205   <span class="keywordtype">int</span> last  = (iADC&lt;2) ? (iADC+1)*320 : 1024;
00206   <span class="keywordtype">short</span> <span class="keywordtype">int</span> sig[384];
00207   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=first; jj&lt;last; jj++) sig[jj-first] = (<span class="keywordtype">short</span> int) (8*<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(jj));
00208   <span class="keywordtype">short</span> <span class="keywordtype">int</span> mediane = (iADC&lt;2) ? <a class="code" href="classTrLadCal.html#a20">DSPSmallest</a>(sig,320,160) : <a class="code" href="classTrLadCal.html#a20">DSPSmallest</a>(sig,384,192);
00209   <span class="keywordtype">short</span> <span class="keywordtype">int</span> sigma   = (<span class="keywordtype">short</span> int) (8*<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(ii));
00210   <span class="keywordflow">return</span> 1.*sigma/mediane;
00211 }
00212 
00213 
<a name="l00214"></a><a class="code" href="classTrLadCal.html#a23">00214</a> geant <a class="code" href="classTrLadCal.html#a23">TrLadCal::GetSigmaMean</a>(<span class="keywordtype">int</span> side) {
00215   <span class="keywordtype">int</span> first = (side==0) ? 640  : 0;
00216   <span class="keywordtype">int</span> last  = (side==0) ? 1023 : 639;
00217   <span class="keywordtype">int</span>   ngoodchannels = 0;
00218   geant mean = 0.;
00219   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=first; ii&lt;=last; ii++) {
00220     <span class="keywordflow">if</span> (<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)!=0) <span class="keywordflow">continue</span>;
00221     mean += <a class="code" href="classTrLadCal.html#a11">GetSigma</a>(ii);
00222     ngoodchannels++;
00223   }
00224   <span class="keywordflow">return</span> mean/ngoodchannels;
00225 }
00226 
00227 
<a name="l00228"></a><a class="code" href="classTrLadCal.html#a24">00228</a> geant <a class="code" href="classTrLadCal.html#a24">TrLadCal::GetSigmaRMS</a>(<span class="keywordtype">int</span> side) {
00229   <span class="keywordtype">int</span> first = (side==0) ? 640  : 0;
00230   <span class="keywordtype">int</span> last  = (side==0) ? 1023 : 639;
00231   <span class="keywordtype">int</span>   ngoodchannels = 0;
00232   geant mean = <a class="code" href="classTrLadCal.html#a23">GetSigmaMean</a>(side);
00233   geant rms = 0.;
00234   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=first; ii&lt;=last; ii++) {
00235     <span class="keywordflow">if</span> (<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)!=0) <span class="keywordflow">continue</span>;
00236     rms += pow(<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(ii)-mean,2);
00237     ngoodchannels++;
00238   }
00239   <span class="keywordflow">return</span> sqrt(rms/ngoodchannels);
00240 }
00241   
<a name="l00242"></a><a class="code" href="classTrLadCal.html#a25">00242</a> <span class="keywordtype">int</span> <a class="code" href="classTrLadCal.html#a25">TrLadCal::GetnChannelsByStatus</a>(<span class="keywordtype">int</span> statusbit) {
00243   <span class="keywordtype">int</span> nchannels = 0;
00244   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;=1023; ii++) {
00245     <span class="keywordflow">if</span> (!(<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(ii)&gt;&gt;statusbit&amp;1)) <span class="keywordflow">continue</span>;
00246     nchannels++;
00247   }
00248   <span class="keywordflow">return</span> nchannels;
00249 } 
00250 
<a name="l00251"></a><a class="code" href="classTrLadCal.html#a30">00251</a> <span class="keywordtype">int</span>  <a class="code" href="classTrLadCal.html#a30">TrLadCal::Cal2Lin</a>(<span class="keywordtype">float</span>* offset){
00252 
00253   <span class="keywordflow">if</span>(!offset) <span class="keywordflow">return</span> -1;
00254 
00255   offset[0]= <a class="code" href="classTrLadCal.html#a9">GetHwId</a>();
00256   offset[1]= (float) dspver;
00257   offset[2]= lowthres;
00258   offset[3]= highthres;
00259   offset[4]= sigrawthres;
00260   offset[5]= (float) calstatus;
00261 
00262   <span class="keywordtype">float</span>* off2=&amp;(offset[6]);
00263   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00264     off2[ii]          = <a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii];
00265     off2[ii+  1024]   = <a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii];
00266     off2[ii+2*1024]   = <a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii];
00267     off2[ii+3*1024]   = (float)<a class="code" href="classTrLadCal.html#r3">_Status</a>[ii];
00268   }
00269   <span class="keywordflow">return</span> 0;
00270 }
00271 
00272 
00273 
<a name="l00274"></a><a class="code" href="classTrLadCal.html#a31">00274</a> <span class="keywordtype">int</span>  <a class="code" href="classTrLadCal.html#a31">TrLadCal::Lin2Cal</a>(<span class="keywordtype">float</span>* offset){
00275 
00276   <span class="keywordflow">if</span>(!offset) <span class="keywordflow">return</span> -1;
00277 
00278   <a class="code" href="classTrLadCal.html#o0">HwId</a>        = offset[0];
00279   <a class="code" href="classTrLadCal.html#o1">dspver</a>      = (int)offset[1];
00280   <a class="code" href="classTrLadCal.html#o2">lowthres</a>    = offset[2];
00281   <a class="code" href="classTrLadCal.html#o3">highthres</a>   = offset[3];
00282   <a class="code" href="classTrLadCal.html#o4">sigrawthres</a> = offset[4];
00283   <a class="code" href="classTrLadCal.html#o5">calstatus</a>   = (int)offset[5];
00284 
00285 
00286   <span class="keywordtype">float</span>* off2=&amp;(offset[6]);
00287   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;1024;ii++){
00288      <a class="code" href="classTrLadCal.html#r0">_Pedestal</a>[ii] =       off2[ii];
00289      <a class="code" href="classTrLadCal.html#r2">_Sigma</a>[ii]    =       off2[ii+  1024];
00290      <a class="code" href="classTrLadCal.html#r1">_SigmaRaw</a>[ii] =       off2[ii+2*1024];
00291      <a class="code" href="classTrLadCal.html#r3">_Status</a>[ii]   = (int) off2[ii+3*1024];
00292   }
00293   <span class="keywordflow">return</span> 0;
00294 
00295 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
