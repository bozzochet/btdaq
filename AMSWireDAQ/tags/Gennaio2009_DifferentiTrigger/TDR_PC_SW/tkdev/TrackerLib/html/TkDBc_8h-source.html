<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: include/TkDBc.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">include</a></div>
<h1>TkDBc.h</h1><a href="TkDBc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">// $Id: TkDBc.h,v 1.25 2008/10/23 10:12:39 zuccon Exp $</span>
00002 
00003 <span class="preprocessor">#ifndef __TkDBC__</span>
00004 <span class="preprocessor"></span><span class="preprocessor">#define __TkDBC__</span>
00005 <span class="preprocessor"></span>
00006 <span class="preprocessor">#include "typedefs.h"</span>
00007 
00008 <span class="preprocessor">#include &lt;iostream&gt;</span>
00009 <span class="preprocessor">#include &lt;fstream&gt;</span>
00010 <span class="preprocessor">#include &lt;string&gt;</span>
00011 <span class="preprocessor">#include &lt;map&gt;</span>
00012 <span class="preprocessor">#include "<a class="code" href="TkLadder_8h.html">TkLadder.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="TkPlane_8h.html">TkPlane.h</a>"</span>
00014 
<a name="l00037"></a><a class="code" href="namespacetrconst.html">00037</a> <span class="keyword">namespace </span>trconst{
<a name="l00039"></a><a class="code" href="namespacetrconst.html#a0">00039</a>   <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a0">nplanes</a>=5;
<a name="l00041"></a><a class="code" href="namespacetrconst.html#a1">00041</a>   <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a1">nlays</a>=8;
<a name="l00043"></a><a class="code" href="namespacetrconst.html#a2">00043</a>   <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a2">maxlay</a>=8;
<a name="l00045"></a><a class="code" href="namespacetrconst.html#a3">00045</a>   <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a3">maxlad</a>=15;
<a name="l00047"></a><a class="code" href="namespacetrconst.html#a4">00047</a>   <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a4">nlad</a>[2][nlays]={{15,12,11,10,10,11,12,15},{15,12,11,10,10,11,12,15}};    
<a name="l00049"></a><a class="code" href="namespacetrconst.html#a5">00049</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetrconst.html#a5">ncrt</a>=8;
<a name="l00051"></a><a class="code" href="namespacetrconst.html#a6">00051</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacetrconst.html#a6">ntdr</a>=24;
00052 
<a name="l00054"></a><a class="code" href="namespacetrconst.html#a7">00054</a>  <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a7">TrkTypes</a>=3;<span class="comment">//for charge algorithm(</span>
<a name="l00056"></a><a class="code" href="namespacetrconst.html#a8">00056</a> <span class="comment"></span> <span class="keyword">const</span> integer <a class="code" href="namespacetrconst.html#a8">TrkPdfBins</a>=100;<span class="comment">//max bins in Elos PDF's</span>
00057 
00058 
00059 
00060 }
00061 <span class="keyword">using</span> <span class="keyword">namespace </span>trconst;
00062 
<a name="l00063"></a><a class="code" href="classTkDBc.html">00063</a> <span class="keyword">class </span><a class="code" href="classTkDBc.html">TkDBc</a>{
00064 
00065 <span class="keyword">public</span>:
00066 
00068 
00071   <span class="keyword">static</span> <a class="code" href="classTkDBc.html">TkDBc</a>* Head;
00072 
00073 
00074   <span class="comment">// ------- PLANES -----------------------------   </span>
00075 
<a name="l00077"></a><a class="code" href="classTkDBc.html#o0">00077</a>   number   _xpos[nplanes];
<a name="l00079"></a><a class="code" href="classTkDBc.html#o1">00079</a>   number   _ypos[nplanes];
<a name="l00081"></a><a class="code" href="classTkDBc.html#o2">00081</a>   number   _zpos[nplanes];
<a name="l00083"></a><a class="code" href="classTkDBc.html#o3">00083</a>   int16     _nslot[nplanes][2];
00084 
00085 
00086   <span class="comment">// Plane support thickness in cm</span>
<a name="l00087"></a><a class="code" href="classTkDBc.html#o4">00087</a>   number _sup_hc_w[nplanes];
00088   
00089   
00090   <span class="comment">// Plane support radius in cm</span>
<a name="l00091"></a><a class="code" href="classTkDBc.html#o5">00091</a>   number _sup_hc_r[nplanes];
00092 
<a name="l00094"></a><a class="code" href="classTkDBc.html#o6">00094</a>   <span class="keywordtype">double</span> _plane_d1[nplanes];
00095   
<a name="l00097"></a><a class="code" href="classTkDBc.html#o7">00097</a>   <span class="keywordtype">double</span> _plane_d2[nplanes];
00098   
<a name="l00100"></a><a class="code" href="classTkDBc.html#o8">00100</a>   <span class="keywordtype">double</span> _dz[nplanes];
00101 
00102   <span class="comment">// ------- LAYERS -----------------------------   </span>
<a name="l00104"></a><a class="code" href="classTkDBc.html#o9">00104</a> <span class="comment"></span>  integer _plane_layer[nlays];
00105 
<a name="l00107"></a><a class="code" href="classTkDBc.html#o10">00107</a>   number _layer_deltaZ[nlays];
00108 
<a name="l00110"></a><a class="code" href="classTkDBc.html#o11">00110</a>   integer  _nlad[2][nlays];
00111 
00112 
00113 
00114 
00115   <span class="comment">//--------------  LADDERS --------------------------------</span>
<a name="l00117"></a><a class="code" href="classTkDBc.html#o12">00117</a> <span class="comment"></span>  number _ladder_Ypitch;
00118 
<a name="l00120"></a><a class="code" href="classTkDBc.html#o13">00120</a>   number _ladder_offsetX_inner[maxlad];
00121 
<a name="l00123"></a><a class="code" href="classTkDBc.html#o14">00123</a>   number _ladder_offsetX_outer[maxlad];
00124 
<a name="l00126"></a><a class="code" href="classTkDBc.html#o15">00126</a>   number _ladder_Xseparation;
00127 
<a name="l00129"></a><a class="code" href="classTkDBc.html#o16">00129</a>   <span class="keywordtype">short</span> <span class="keywordtype">int</span> _nsen[2][nlays][maxlad];
00130 
<a name="l00132"></a><a class="code" href="classTkDBc.html#o17">00132</a>   <span class="keywordtype">short</span> <span class="keywordtype">int</span> _pgid[2][nlays][maxlad];
00133 
<a name="l00135"></a><a class="code" href="classTkDBc.html#o18">00135</a>   <span class="keywordtype">char</span> _LadName[2][nlays][maxlad][9];
00136 
00138   number GetSlotY(<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> slot,<span class="keywordtype">int</span> side);
00139   
00141   number GetSlotX(<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> slot,<span class="keywordtype">int</span> side);
00142 
<a name="l00144"></a><a class="code" href="classTkDBc.html#a2">00144</a>   <span class="keywordtype">int</span> GetNslots(<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> side){ <span class="keywordflow">return</span> <a class="code" href="namespacetrconst.html#a4">nlad</a>[side][layer];}
00145 
<a name="l00147"></a><a class="code" href="classTkDBc.html#a3">00147</a>   integer nlay()<span class="keyword"> const </span>{<span class="keywordflow">return</span> nlays;}
00148   
00149 
00150 
00151 
00152   <span class="comment">// -------- CABLING ------------------------------</span>
<a name="l00154"></a><a class="code" href="classTkDBc.html#o19">00154</a> <span class="comment"></span>  <span class="keywordtype">short</span> <span class="keywordtype">int</span> _octid[2][nlays][maxlad];
00155 
00156 
<a name="l00177"></a><a class="code" href="classTkDBc.html#o20">00177</a>   <span class="keywordtype">short</span> <span class="keywordtype">int</span> _octant_crate[8];
<a name="l00179"></a><a class="code" href="classTkDBc.html#o21">00179</a>   <span class="keywordtype">short</span> <span class="keywordtype">int</span> _octant_JinJ[8];
00180 
<a name="l00181"></a><a class="code" href="classTkDBc.html#o22">00181</a>   <span class="keywordtype">short</span> <span class="keywordtype">int</span> _octant_JMDC[8][4];
00182 
00183 
00184   
00185 
00186 <span class="keyword">public</span>:
<a name="l00188"></a><a class="code" href="classTkDBc.html#a4">00188</a>   <span class="keywordtype">bool</span> filled_slot(<span class="keywordtype">int</span> side,<span class="keywordtype">int</span> layer, <span class="keywordtype">int</span> slot){<span class="keywordflow">return</span> _nsen[side][layer][slot]&gt;0;}
00189  
00191   <span class="keywordtype">char</span> * GetOctName(<span class="keywordtype">int</span> oct);
00192   
00194   <span class="keywordtype">char</span> * GetCratePos(<span class="keywordtype">int</span> crate);
00195 
<a name="l00196"></a><a class="code" href="classTkDBc.html#a7">00196</a>   <span class="keywordtype">int</span> GetOctFromCrate(<span class="keywordtype">int</span> crate)
00197   { <span class="keywordtype">int</span> oct=-1; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;8;ii++) <span class="keywordflow">if</span>(_octant_crate[ii]==crate) oct=ii; <span class="keywordflow">return</span> (oct+1); }
00198  
<a name="l00199"></a><a class="code" href="classTkDBc.html#a8">00199</a>   <span class="keywordtype">int</span> GetOctFromJinJ(<span class="keywordtype">int</span> JinJ)
00200   { <span class="keywordtype">int</span> oct=-1; <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0;ii&lt;8;ii++) <span class="keywordflow">if</span>(_octant_JinJ[ii]==JinJ) oct=ii; <span class="keywordflow">return</span> (oct+1); }
00201 
<a name="l00202"></a><a class="code" href="classTkDBc.html#a9">00202</a>   <span class="keywordtype">int</span> GetCrateFromJinJ(<span class="keywordtype">int</span> JinJ)
00203   { <span class="keywordtype">int</span> oct=GetOctFromJinJ(JinJ); oct--; <span class="keywordflow">return</span> _octant_crate[oct]; }
00204 
<a name="l00206"></a><a class="code" href="classTkDBc.html#o23">00206</a>   number  _zelec[3];
00207 
00208 
00209 
00210  <span class="comment">//  //Silicon sensors</span>
<a name="l00212"></a><a class="code" href="classTkDBc.html#o24">00212</a> <span class="comment"></span>  number   _ssize_active[2];
<a name="l00214"></a><a class="code" href="classTkDBc.html#o25">00214</a>   number   _ssize_inactive[2];
<a name="l00216"></a><a class="code" href="classTkDBc.html#o26">00216</a>   number   _silicon_z;
00217 
<a name="l00218"></a><a class="code" href="classTkDBc.html#o27">00218</a>   <span class="keywordtype">int</span> _NReadStripK7;
<a name="l00219"></a><a class="code" href="classTkDBc.html#o28">00219</a>   <span class="keywordtype">int</span> _NReadStripK5;
<a name="l00220"></a><a class="code" href="classTkDBc.html#o29">00220</a>   <span class="keywordtype">int</span> _NReadoutChanS;
<a name="l00221"></a><a class="code" href="classTkDBc.html#o30">00221</a>   <span class="keywordtype">int</span> _NReadoutChanK;
<a name="l00222"></a><a class="code" href="classTkDBc.html#o31">00222</a>   number _SensorPitchK;
<a name="l00223"></a><a class="code" href="classTkDBc.html#o32">00223</a>   number _PitchS;
<a name="l00224"></a><a class="code" href="classTkDBc.html#o33">00224</a>   number _PitchK5;
<a name="l00225"></a><a class="code" href="classTkDBc.html#o34">00225</a>   number _PitchK7;
<a name="l00226"></a><a class="code" href="classTkDBc.html#o35">00226</a>   number _ImplantPitchK;
00227 <span class="comment">//     integer  _nstripssen[nlays][2]; //number of strips</span>
00228 <span class="comment">//     integer  _nstripssenR[nlays][2];</span>
00229 <span class="comment">//     integer  _nstripsdrp[nlays][2];</span>
00230   
00231 <span class="comment">//     number   _zelec[nlays][3];</span>
00232 <span class="comment">//     number   _c2c[nlays];</span>
00233 <span class="comment">//     number   _halfldist[nlays];</span>
00234 <span class="comment">//     number   _support_foam_w[nlays];</span>
00235 <span class="comment">//     number   _support_foam_tol[nlays];</span>
00236 <span class="comment">//     number   _support_hc_w[nlays];</span>
00237 <span class="comment">//     number   _support_hc_r[nlays];</span>
00238 <span class="comment">//     number   _support_hc_z[nlays];</span>
00239 <span class="comment">//     integer  _nladshuttle[nlays][2];</span>
00240 <span class="comment">//     integer  _boundladshuttle[nlays][2];</span>
00241 <span class="comment">//     number   _PlMarkerPos[nlays][2][4][3];  // 1st wjb</span>
00242 
00243 <span class="keyword">private</span>:
<a name="l00245"></a><a class="code" href="classTkDBc.html#r0">00245</a>   map&lt;int,TkLadder*&gt; tkassemblymap;
<a name="l00247"></a><a class="code" href="classTkDBc.html#r1">00247</a>   map&lt;int,TkLadder*&gt; tkidmap;
<a name="l00249"></a><a class="code" href="classTkDBc.html#r2">00249</a>   map&lt;int,TkLadder*&gt; hwidmap;
<a name="l00251"></a><a class="code" href="classTkDBc.html#r3">00251</a>   map&lt;int,TkLadder*&gt; pgidmap;
<a name="l00253"></a><a class="code" href="classTkDBc.html#r4">00253</a>   map&lt;string,TkLadder*&gt; lnamemap;
<a name="l00255"></a><a class="code" href="classTkDBc.html#r5">00255</a>   map&lt;int,TkLadder*&gt; JMDCNumMap;
00256 
00257   <a class="code" href="classTkLadder.html">TkLadder</a>* Findmap(map&lt;int,TkLadder*&gt; &amp; tkmap, <span class="keywordtype">int</span> key);
00258 
00259   <span class="keywordtype">int</span> GetOctant(<span class="keywordtype">int</span> side,<span class="keywordtype">int</span> _layer,<span class="keywordtype">int</span> _slot);
00260 
00262   <a class="code" href="namespaceROOT_1_1Shadow.html#a3">TkDBc</a>();
00263 
00264   <span class="comment">//Pointer ro the planes;</span>
<a name="l00265"></a><a class="code" href="classTkDBc.html#r6">00265</a>   <a class="code" href="classTkPlane.html">TkPlane</a>* planes[nplanes];
00266   
00267 
00268 <span class="keyword">public</span>:
00269 
00271   <span class="keyword">static</span> <span class="keywordtype">void</span> CreateTkDBc(<span class="keywordtype">int</span> force_delete=0);
00272   ~<a class="code" href="classTkDBc.html">TkDBc</a>();
00274   <span class="keywordtype">void</span> init(<span class="keyword">const</span> <span class="keywordtype">char</span>* inputfilename=0, <span class="keywordtype">int</span> pri=0);
00276   <span class="keywordtype">int</span>  write(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename);
00278   <span class="keywordtype">int</span>  read(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keywordtype">int</span> pri=0);
00280   <span class="keywordtype">int</span> readAlignment(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keywordtype">int</span> pri=0);
00281 
00283   <span class="keywordtype">int</span> writeAlignment(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename);
00284 
<a name="l00286"></a><a class="code" href="classTkDBc.html#a16">00286</a>   <a class="code" href="classTkPlane.html">TkPlane</a>* GetPlane(<span class="keywordtype">int</span> ii) {<span class="keywordflow">if</span> (ii&gt;0&amp;&amp;ii&lt;6) <span class="keywordflow">return</span> planes[ii-1]; <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;}
00287 
<a name="l00289"></a><a class="code" href="classTkDBc.html#a17">00289</a>   <span class="keywordtype">int</span> GetEntries() { <span class="keywordflow">return</span> tkidmap.size(); }
00291   <a class="code" href="classTkLadder.html">TkLadder</a>* GetEntry(<span class="keywordtype">int</span> ii);
00293   <span class="keywordtype">int</span> Entry2TkId(<span class="keywordtype">int</span> ii);
00295   <span class="keywordtype">int</span> TkId2Entry(<span class="keywordtype">int</span> TkId);
00296 
<a name="l00298"></a><a class="code" href="classTkDBc.html#a21">00298</a>   <a class="code" href="classTkLadder.html">TkLadder</a>* FindTkAssemblyId( <span class="keywordtype">int</span> tkassemblyid){ <span class="keywordflow">return</span> Findmap(tkassemblymap,tkassemblyid);}
<a name="l00300"></a><a class="code" href="classTkDBc.html#a22">00300</a>   <a class="code" href="classTkLadder.html">TkLadder</a>* FindTkId( <span class="keywordtype">int</span> tkid){ <span class="keywordflow">return</span> Findmap(tkidmap,tkid);}
<a name="l00302"></a><a class="code" href="classTkDBc.html#a23">00302</a>   <a class="code" href="classTkLadder.html">TkLadder</a>* FindHwId( <span class="keywordtype">int</span> hwid){ <span class="keywordflow">return</span> Findmap(hwidmap,hwid);}
<a name="l00304"></a><a class="code" href="classTkDBc.html#a24">00304</a>   <a class="code" href="classTkLadder.html">TkLadder</a>* FindPgId(<span class="keywordtype">int</span> pgid){ <span class="keywordflow">return</span> Findmap(pgidmap,pgid); }
00306   <a class="code" href="classTkLadder.html">TkLadder</a>* FindLadName(string&amp; name);
<a name="l00308"></a><a class="code" href="classTkDBc.html#a26">00308</a>   <span class="keywordtype">int</span> HwId2Tkid(<span class="keywordtype">int</span> tkid){
00309     <a class="code" href="classTkLadder.html">TkLadder</a>* ll= FindTkId(tkid);
00310     <span class="keywordflow">if</span>(ll) <span class="keywordflow">return</span> ll-&gt;<a class="code" href="classTkLadder.html#a15">GetHwId</a>();
00311     <span class="keywordflow">else</span> <span class="keywordflow">return</span> -1;
00312   }
<a name="l00314"></a><a class="code" href="classTkDBc.html#a27">00314</a>   <span class="keywordtype">double</span> GetXlayer(<span class="keywordtype">int</span> i) {
00315     <span class="keywordflow">return</span> (1 &lt;= i &amp;&amp; i &lt;= nlays)
00316       ? GetPlane(_plane_layer[i-1])-&gt;<a class="code" href="classTkObject.html#o1">pos</a>[0]: -9999.;} 
00317   
<a name="l00319"></a><a class="code" href="classTkDBc.html#a28">00319</a>   <span class="keywordtype">double</span> GetYlayer(<span class="keywordtype">int</span> i) {
00320     <span class="keywordflow">return</span> (1 &lt;= i &amp;&amp; i &lt;= nlays)
00321       ? GetPlane(_plane_layer[i-1])-&gt;<a class="code" href="classTkObject.html#o1">pos</a>[1]: -9999.;} 
00322   
<a name="l00324"></a><a class="code" href="classTkDBc.html#a29">00324</a>   <span class="keywordtype">double</span> GetZlayer(<span class="keywordtype">int</span> i) {
00325     <span class="keywordflow">return</span> (1 &lt;= i &amp;&amp; i &lt;= nlays) 
00326       ? GetPlane(_plane_layer[i-1])-&gt;<a class="code" href="classTkObject.html#o1">pos</a>[2]+_layer_deltaZ[i-1] : -99999.;}
00328   <span class="keywordtype">void</span> GetLayerRot(<span class="keywordtype">int</span> lay,number nrm[][3]);
00329 
<a name="l00331"></a><a class="code" href="classTkDBc.html#a31">00331</a>   <span class="keywordtype">void</span> KillTkId(<span class="keywordtype">int</span> tkid) { tkidmap[tkid] = 0; }
00332 
<a name="l00333"></a><a class="code" href="classTkDBc.html#a32">00333</a>   <span class="keywordtype">int</span> NStripsDrp(<span class="keywordtype">int</span> type){  <span class="keywordflow">return</span> (type==0)?_NReadoutChanK: _NReadoutChanS;}
00334 
00335 
00336 };
00337 
<a name="l00338"></a><a class="code" href="TkDBc_8h.html#a9">00338</a> <span class="keyword">typedef</span> map&lt;int,TkLadder*&gt;::const_iterator tkidIT;
<a name="l00339"></a><a class="code" href="TkDBc_8h.html#a10">00339</a> <span class="keyword">typedef</span> map&lt;string,TkLadder*&gt;::const_iterator lnameIT;
00340 
00341 
00342 
00343 <span class="preprocessor">#endif</span>
00344 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:04 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
