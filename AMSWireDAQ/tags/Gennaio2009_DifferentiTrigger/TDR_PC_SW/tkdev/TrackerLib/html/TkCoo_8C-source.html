<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TkCoo.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TkCoo.C</h1><a href="TkCoo_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 
00017 
00018 <span class="preprocessor">#include "<a class="code" href="TkDBc_8h.html">TkDBc.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="TkCoo_8h.html">TkCoo.h</a>"</span>
00020 
00021 <span class="comment">//--------------------------------------------------</span>
<a name="l00022"></a><a class="code" href="classTkCoo.html#e4">00022</a> AMSPoint <a class="code" href="classTkCoo.html#e4">TkCoo::GetGlobalN</a>(<span class="keywordtype">int</span> tkid,<span class="keywordtype">float</span> X, <span class="keywordtype">float</span> Y){
00023   <span class="comment">// if(X&lt;0||X &gt; TkDBc::Head-&gt;_ssize_active[0]){</span>
00024   <span class="comment">//   printf("TkCoo::GetGlobalN Error X is outside the ladder size %f\n",X);</span>
00025   <span class="comment">//   return AMSPoint();</span>
00026   <span class="comment">// }</span>
00027   <span class="keywordflow">if</span>(Y&lt;0 || Y&gt;TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]){
00028     printf(<span class="stringliteral">"TkCoo::GetGlobalN Error Y is outside the ladder size %f\n"</span>,Y);
00029     <span class="keywordflow">return</span> AMSPoint();
00030   }
00031   AMSPoint loc(X,Y,0.);
00032   <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e4">TkCoo::GetGlobalN</a>(tkid, loc);
00033 }
00034 
00035 
00036 <span class="comment">//--------------------------------------------------</span>
<a name="l00037"></a><a class="code" href="classTkCoo.html#e6">00037</a> AMSPoint <a class="code" href="classTkCoo.html#e4">TkCoo::GetGlobalN</a>(<span class="keywordtype">int</span> tkid, AMSPoint&amp; loc){
00038   <span class="comment">// if(loc[0]&lt;0||loc[0] &gt; TkDBc::Head-&gt;_ssize_active[0]){</span>
00039   <span class="comment">//   printf("TkCoo::GetGlobalN Error X is outside the ladder size %f\n",loc[0]);</span>
00040   <span class="comment">//   return AMSPoint();</span>
00041   <span class="comment">// }</span>
00042   <span class="keywordflow">if</span>(loc[1]&lt;0 || loc[1] &gt; TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]){
00043     printf(<span class="stringliteral">"TkCoo::GetGlobalN Error Y is outside the ladder size %f\n"</span>,loc[1]);
00044     <span class="keywordflow">return</span> AMSPoint();
00045   }
00046   <a class="code" href="classTkLadder.html">TkLadder</a>* ll = TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00047   <span class="keywordflow">if</span>(!ll){
00048     printf(<span class="stringliteral">"GetMaxMult: ERROR cant find ladder %d into the database\n"</span>,tkid);
00049     <span class="keywordflow">return</span> AMSPoint();
00050   }
00051   AMSPoint loc2(loc);
00052   <span class="comment">// Set ladder local coo Z to zero</span>
00053   loc2[2]=0;
00054   
00055   <span class="comment">// Get the Global coo on the plane</span>
00056   AMSPoint  oo = ll-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>()*loc2+ll-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00057   
00058   <span class="comment">// Get The Plane Pointer</span>
00059   <a class="code" href="classTkPlane.html">TkPlane</a>*  pp = ll-&gt;<a class="code" href="classTkLadder.html#o6">_plane</a>;
00060 
00061   <span class="comment">// Convolute with the Plane pos in the space and Get the global Coo</span>
00062   AMSPoint oo2 = pp-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>()*oo + pp-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00063 
00064   <span class="keywordflow">return</span> oo2;
00065 }
00066 
00067 
00068 <span class="comment">//--------------------------------------------------</span>
<a name="l00069"></a><a class="code" href="classTkCoo.html#e7">00069</a> AMSPoint <a class="code" href="classTkCoo.html#e7">TkCoo::GetGlobalA</a>(<span class="keywordtype">int</span> tkid,<span class="keywordtype">float</span> X, <span class="keywordtype">float</span> Y){
00070   <span class="comment">// if(X&lt;0||X &gt; TkDBc::Head-&gt;_ssize_active[0]){</span>
00071   <span class="comment">//   printf("TkCoo::GetGlobalN Error X is outside the ladder size %f\n",X);</span>
00072   <span class="comment">//   return AMSPoint();</span>
00073   <span class="comment">// }</span>
00074   <span class="keywordflow">if</span>(Y&lt;0 || Y&gt;TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]){
00075     printf(<span class="stringliteral">"TkCoo::GetGlobalN Error Y is outside the ladder size %f\n"</span>,Y);
00076     <span class="keywordflow">return</span> AMSPoint();
00077   }
00078   AMSPoint loc(X,Y,0.);
00079   <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e7">TkCoo::GetGlobalA</a>(tkid, loc);
00080 }
00081 
00082 
00083 <span class="comment">//--------------------------------------------------</span>
<a name="l00084"></a><a class="code" href="classTkCoo.html#e9">00084</a> AMSPoint <a class="code" href="classTkCoo.html#e7">TkCoo::GetGlobalA</a>(<span class="keywordtype">int</span> tkid, AMSPoint&amp; loc){
00085   <span class="comment">// if(loc[0]&lt;0||loc[0] &gt; TkDBc::Head-&gt;_ssize_active[0]){</span>
00086   <span class="comment">//   printf("TkCoo::GetGlobalN Error X is outside the ladder size %f\n",loc[0]);</span>
00087   <span class="comment">//   return AMSPoint();</span>
00088   <span class="comment">// }</span>
00089   <span class="keywordflow">if</span>(loc[1]&lt;0 || loc[1]&gt;TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]){
00090     printf(<span class="stringliteral">"TkCoo::GetGlobalN Error Y is outside the ladder size %f\n"</span>,loc[1]);
00091     <span class="keywordflow">return</span> AMSPoint();
00092   }
00093   <a class="code" href="classTkLadder.html">TkLadder</a>* ll=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00094   <span class="keywordflow">if</span>(!ll){
00095     printf(<span class="stringliteral">"GetMaxMult: ERROR cant find ladder %d into the database\n"</span>,tkid);
00096     <span class="keywordflow">return</span> AMSPoint();
00097   }
00098   AMSPoint loc2(loc);
00099   <span class="comment">// Set ladder local coo Z to zero</span>
00100   loc2[2]=0;
00101 
00102   <span class="comment">// Alignment corrected Ladder Rotation matrix</span>
00103   AMSRotMat RotG  = ll-&gt;<a class="code" href="classTkObject.html#a12">GetRotMatA</a>()*ll-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>();
00104 
00105   <span class="comment">// Alignment corrected Ladder postion</span>
00106   AMSPoint  PosG  = ll-&gt;<a class="code" href="classTkObject.html#a11">GetPosA</a>()+ll-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00107 
00108   <span class="comment">// Get the Global coo on the plane</span>
00109   AMSPoint  oo    = RotG*loc2+PosG;
00110 
00111   <span class="comment">// Get The Plane Pointer</span>
00112   <a class="code" href="classTkPlane.html">TkPlane</a>*  pp    = ll-&gt;<a class="code" href="classTkLadder.html#o6">_plane</a>;
00113 
00114   <span class="comment">// Alignment corrected Plane Rotation matrix</span>
00115   AMSRotMat PRotG = pp-&gt;<a class="code" href="classTkObject.html#a12">GetRotMatA</a>()*pp-&gt;<a class="code" href="classTkObject.html#a7">GetRotMat</a>();
00116 
00117   <span class="comment">// Alignment corrected Plane postion</span>
00118   AMSPoint  PPosG = pp-&gt;<a class="code" href="classTkObject.html#a11">GetPosA</a>()+pp-&gt;<a class="code" href="classTkObject.html#a6">GetPos</a>();
00119 
00120   <span class="comment">// Covolute with the Plane pos in the space and Get the global Coo</span>
00121   AMSPoint  oo2   = PRotG*oo + PPosG;
00122 
00123   <span class="keywordflow">return</span> oo2;
00124 }
00125 
00126 
00127 <span class="comment">//--------------------------------------------------</span>
<a name="l00128"></a><a class="code" href="classTkCoo.html#e1">00128</a> <span class="keywordtype">int</span> <a class="code" href="classTkCoo.html#e0">TkCoo::GetMaxMult</a>(<span class="keywordtype">int</span> tkid, <span class="keywordtype">float</span> readchann){
00129   <a class="code" href="classTkLadder.html">TkLadder</a>* ll = TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00130   <span class="keywordflow">if</span>(!ll){
00131     printf(<span class="stringliteral">"GetMaxMult: ERROR cant find ladder %d into the database\n"</span>,tkid);
00132     <span class="keywordflow">return</span> -1;
00133   }
00134   <span class="keywordtype">int</span> max = 1;
00135   <span class="keywordflow">if</span>(readchann&lt;=639.) <span class="keywordflow">return</span> 0;
00136   <span class="keywordflow">if</span>( (ll-&gt;<a class="code" href="classTkLadder.html#a4">GetLayer</a>()==8) || (ll-&gt;<a class="code" href="classTkLadder.html#a4">GetLayer</a>()==1) ) 
00137     max=(int) ceil((ll-&gt;<a class="code" href="classTkLadder.html#o4">_nsensors</a>*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o27">_NReadStripK7</a>-readchann+640)/384.);
00138   <span class="keywordflow">else</span>
00139     max=(<span class="keywordtype">int</span>) ceil((ll-&gt;<a class="code" href="classTkLadder.html#o4">_nsensors</a>*TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o28">_NReadStripK5</a>-readchann+640)/384.);
00140   
00141   return (max-1);
00142 }
00143 
00144 
00145 <span class="comment">//--------------------------------------------------</span>
<a name="l00146"></a><a class="code" href="classTkCoo.html#e2">00146</a> <span class="keywordtype">float</span> TkCoo::GetLocalCoo(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> readchann,<span class="keywordtype">int</span> mult){
00147   <span class="keywordtype">int</span> mmult=<a class="code" href="classTkCoo.html#e0">GetMaxMult</a>(tkid,readchann);
00148   <span class="keywordtype">int</span> plane=abs(tkid)/100;
00149   <span class="keywordflow">if</span>(mult&gt;mmult||mult&lt;0) mult=mmult;
00150   <span class="comment">// float out=0.;</span>
00151   <span class="keywordflow">if</span>(readchann&lt;640) <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#h0">GetLocalCooS</a>(readchann);
00152   <span class="keywordflow">else</span>{
00153     <span class="keywordflow">if</span>(plane==1||plane==8) <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#h2">GetLocalCooK7</a>(readchann,mult);
00154     <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#h1">GetLocalCooK5</a>(readchann,mult);
00155   }
00156 }
00157 
00158 <span class="comment">//--------------------------------------------------</span>
<a name="l00159"></a><a class="code" href="classTkCoo.html#e3">00159</a> <span class="keywordtype">float</span> TkCoo::GetLocalCoo(<span class="keywordtype">int</span> tkid, <span class="keywordtype">float</span> readchann,<span class="keywordtype">int</span> mult){
00160   <span class="keywordtype">int</span> mmult=<a class="code" href="classTkCoo.html#e0">GetMaxMult</a>(tkid,readchann);
00161   <span class="keywordtype">int</span> plane=abs(tkid)/100;
00162   <span class="keywordflow">if</span>(mult&gt;mmult||mult&lt;0) mult=mmult;
00163   <span class="comment">// float out=0.;</span>
00164   <span class="keywordtype">int</span> channel = (<span class="keywordtype">int</span>) round(readchann);
00165   <span class="keywordflow">if</span>(readchann&lt;640) {
00166     number cooY1,cooY2;  
00167     cooY1=TkCoo::GetLocalCooS(channel);
00168     <span class="keywordflow">if</span>((readchann-channel)&gt;=0)
00169       cooY2=TkCoo::GetLocalCooS(channel+1);
00170     <span class="keywordflow">else</span>
00171       cooY2=TkCoo::GetLocalCooS(channel-1);
00172     <span class="keywordflow">return</span> cooY1 + (readchann-channel)*abs(cooY1-cooY2);
00173   }
00174   <span class="keywordflow">else</span>{
00175     <span class="keywordflow">if</span>(plane==1||plane==8) {
00176       number cooX1,cooX2;  
00177       cooX1=TkCoo::GetLocalCooK7(channel,mult);
00178       <span class="keywordflow">if</span>((readchann-channel)&gt;=0)
00179         cooX2=TkCoo::GetLocalCooK7(channel+1,mult);
00180       <span class="keywordflow">else</span>
00181         cooX2=TkCoo::GetLocalCooK7(channel-1,mult);
00182       <span class="keywordflow">return</span> cooX1 + (readchann-channel)*abs(cooX1-cooX2);
00183     }
00184     <span class="keywordflow">else</span> {
00185       number cooX1,cooX2;  
00186       cooX1=TkCoo::GetLocalCooK5(channel,mult);
00187       <span class="keywordflow">if</span>((readchann-channel)&gt;=0)
00188         cooX2=TkCoo::GetLocalCooK5(channel+1,mult);
00189       <span class="keywordflow">else</span>
00190         cooX2=TkCoo::GetLocalCooK5(channel-1,mult);
00191       <span class="keywordflow">return</span> cooX1 + (readchann-channel)*abs(cooX1-cooX2);
00192     }
00193   }
00194 }
00195 
00196 <span class="comment">//--------------------------------------------------</span>
00197 <span class="comment">// The gaps between 0 and 1 and 638 to 639 are doubled</span>
<a name="l00198"></a><a class="code" href="classTkCoo.html#h0">00198</a> <span class="keywordtype">float</span> TkCoo::GetLocalCooS(<span class="keywordtype">int</span> readchann){
00199   <span class="keywordflow">if</span>(readchann&gt;639||readchann&lt;0) <span class="keywordflow">return</span> -1;
00200   <span class="keywordtype">float</span> out= readchann*TkDBc::Head-&gt;_PitchS;
00201   <span class="keywordflow">if</span>(readchann!=0)    out+=TkDBc::Head-&gt;_PitchS;
00202   <span class="keywordflow">if</span>(readchann==639)  out+=TkDBc::Head-&gt;_PitchS;
00203   <span class="keywordflow">return</span> out;
00204 }
00205 
00206 
00207 <span class="comment">//--------------------------------------------------</span>
00208 <span class="comment">// The gap between the 190 and 191 is one and half</span>
<a name="l00209"></a><a class="code" href="classTkCoo.html#h1">00209</a> <span class="keywordtype">float</span> TkCoo::GetLocalCooK5(<span class="keywordtype">int</span> readchann,<span class="keywordtype">int</span> mult){
00210   <span class="keywordflow">if</span>(readchann&gt;1023||readchann&lt;640) <span class="keywordflow">return</span> -1;  
00211   <span class="keywordtype">int</span> chann=readchann-640;
00212   <span class="keywordtype">int</span> Sensor=((chann+mult*TkDBc::Head-&gt;_NReadoutChanK)/TkDBc::Head-&gt;_NReadStripK5);
00213   <span class="keywordtype">int</span> chann2=chann;
00214   <span class="comment">//  printf("Sensor %d  %d\n",Sensor,mult);</span>
00215   <span class="keywordflow">if</span>(chann2&gt;191) chann2-=192;
00216   <span class="keywordflow">return</span> TkDBc::Head-&gt;_SensorPitchK*Sensor+ chann2 * TkDBc::Head-&gt;_PitchK5
00217     + ((chann2 == 191) ? TkDBc::Head-&gt;_PitchK5*0.5 : 0);
00218 }
00219 
00220 
00221 <span class="comment">//--------------------------------------------------</span>
00222 <span class="comment">// The implantation of the strips in K7 is not uniform</span>
00223 <span class="comment">// ImplantedFromReadK7 evaluate the implanted strips in terms of _ImplantPitchK unit</span>
<a name="l00224"></a><a class="code" href="classTkCoo.html#h2">00224</a> <span class="keywordtype">float</span> TkCoo::GetLocalCooK7(<span class="keywordtype">int</span> readchann,<span class="keywordtype">int</span> mult){
00225   <span class="keywordflow">if</span>(readchann&gt;1023||readchann&lt;640) <span class="keywordflow">return</span> -1;  
00226   <span class="keywordtype">int</span> chann=readchann-640;
00227   <span class="keywordtype">int</span> Sensor=((chann+mult*TkDBc::Head-&gt;_NReadoutChanK)/TkDBc::Head-&gt;_NReadStripK7);
00228   <span class="keywordtype">int</span> readstrip= (chann+mult*TkDBc::Head-&gt;_NReadoutChanK) - Sensor * TkDBc::Head-&gt;_NReadStripK7;
00229   <span class="keywordflow">return</span> TkDBc::Head-&gt;_SensorPitchK*Sensor+ <a class="code" href="classTkCoo.html#h3">ImplantedFromReadK7</a>(readstrip) * TkDBc::Head-&gt;_ImplantPitchK;    
00230 }
00231 
00232 <span class="comment">//--------------------------------------------------</span>
00233 <span class="comment">// - from   0 to  64: readout pitch is 2 1 2 1 2 1, ...</span>
00234 <span class="comment">// - from  64 to 160: readout pitch is 2</span>
00235 <span class="comment">// - from 160 to 224: readout pitch is 2 1 2 1 2 1, ... </span>
<a name="l00236"></a><a class="code" href="classTkCoo.html#h3">00236</a> <span class="keywordtype">int</span> TkCoo::ImplantedFromReadK7(<span class="keywordtype">int</span> channel){
00237   <span class="comment">// this is the conversion for sensor 1</span>
00238   <span class="comment">//NOTA: channel = 0 to 383..</span>
00239   <span class="keywordtype">int</span> pitch=0;
00240   <span class="keywordtype">int</span> start=0;
00241   <span class="keywordtype">int</span> strip=0;
00242   <span class="keywordtype">int</span> diff=0;
00243   <span class="keywordtype">int</span> startch=0;
00244   <span class="keywordflow">if</span> (channel&lt;64) { <span class="comment">// subgroups 1 and 2, 64 channels</span>
00245     pitch=3;
00246     startch=channel%2;
00247     start=2*startch;
00248 
00249     diff=(channel-startch)/2; <span class="comment">// the difference is always even</span>
00250     strip=start+diff*pitch;         
00251   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel&lt;160) { <span class="comment">// subgroups 3 to 5, 96 channels</span>
00252     pitch=2;
00253     start=96;
00254     startch=64;
00255     diff=(channel-startch);
00256     strip=start+diff*pitch;
00257   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel&lt;224) {
00258     pitch=3;
00259     startch=channel%2;
00260     start=48+2*startch;
00261     <span class="comment">//    startch+=160;</span>
00262     diff=(channel-startch)/2; <span class="comment">// the difference is always even</span>
00263     strip=start+diff*pitch; 
00264   }
00265   <span class="keywordflow">return</span> strip;
00266 }
00267 
00268 
00269 <span class="comment">//--------------------------------------------------</span>
<a name="l00270"></a><a class="code" href="classTkCoo.html#e10">00270</a> <span class="keywordtype">double</span> TkCoo::GetLadderLength(<span class="keywordtype">int</span> tkid) {
00271   <span class="comment">// Get ladder length along the X-coordinate in cm</span>
00272   <span class="keywordflow">if</span>(!TkDBc::Head) <span class="keywordflow">return</span> -9999.;
00273   <a class="code" href="classTkLadder.html">TkLadder</a>* pp=TkDBc::Head-&gt;FindTkId(tkid);
00274   <span class="keywordflow">if</span>(!pp) <span class="keywordflow">return</span> -9999.;
00275   
00276   <span class="keywordflow">return</span> TkDBc::Head-&gt;_SensorPitchK*pp-&gt;_nsensors;
00277 }
00278 
00279 
00280 <span class="comment">//--------------------------------------------------</span>
<a name="l00281"></a><a class="code" href="classTkCoo.html#e11">00281</a> <span class="keywordtype">double</span> <a class="code" href="classTkCoo.html#e11">TkCoo::GetLadderCenterX</a>(<span class="keywordtype">int</span> tkid) { 
00282 <span class="comment">// Get central position of the ladder in the X-coordinate in cm</span>
00283   <span class="keywordflow">if</span>(!TkDBc::Head) <span class="keywordflow">return</span> -9999.;
00284   <a class="code" href="classTkLadder.html">TkLadder</a>* pp=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00285   <span class="keywordflow">if</span>(!pp) <span class="keywordflow">return</span> -9999.;
00286 
00287   <span class="keywordtype">double</span> hlen = <a class="code" href="classTkCoo.html#e10">GetLadderLength</a>(tkid)/2-TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o31">_SensorPitchK</a>+TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0];
00288   <span class="keywordtype">double</span> hwid = TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]/2;
00289   <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e7">TkCoo::GetGlobalA</a>(tkid, hlen, hwid).x();
00290 }
00291 
00292 
00293 <span class="comment">//--------------------------------------------------</span>
<a name="l00294"></a><a class="code" href="classTkCoo.html#e12">00294</a> <span class="keywordtype">double</span> <a class="code" href="classTkCoo.html#e12">TkCoo::GetLadderCenterY</a>(<span class="keywordtype">int</span> tkid) {
00295   <span class="comment">// Get central position of the ladder in the Y-coordinate in cm</span>
00296   <span class="keywordflow">if</span>(!TkDBc::Head) <span class="keywordflow">return</span> -9999.;
00297   <a class="code" href="classTkLadder.html">TkLadder</a>* pp=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00298   <span class="keywordflow">if</span>(!pp) <span class="keywordflow">return</span> -9999.;
00299 
00300   <span class="keywordtype">double</span> hlen = <a class="code" href="classTkCoo.html#e10">GetLadderLength</a>(tkid)/2-TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o31">_SensorPitchK</a>+TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[0];
00301   <span class="keywordtype">double</span> hwid = TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#o24">_ssize_active</a>[1]/2;
00302   <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e7">TkCoo::GetGlobalA</a>(tkid, hlen, hwid).y();
00303 }
00304 
00305 
00306 
<a name="l00307"></a><a class="code" href="classTkCoo.html#e5">00307</a> AMSPoint <a class="code" href="classTkCoo.html#e5">TkCoo::GetGlobalNC</a>(<span class="keywordtype">int</span> tkid,<span class="keywordtype">float</span> readchanK, <span class="keywordtype">float</span> readchanS,<span class="keywordtype">int</span> mult){
00308   <span class="keywordtype">int</span> layer=abs(tkid)/100;
00309   <span class="keywordflow">if</span>(layer==1||layer==8)
00310     <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e4">GetGlobalN</a>(tkid,<a class="code" href="classTkCoo.html#h2">GetLocalCooK7</a>(readchanK, mult),  <a class="code" href="classTkCoo.html#h0">GetLocalCooS</a>(readchanS));
00311   <span class="keywordflow">else</span> 
00312     <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e4">GetGlobalN</a>(tkid,<a class="code" href="classTkCoo.html#h1">GetLocalCooK5</a>(readchanK, mult),  <a class="code" href="classTkCoo.html#h0">GetLocalCooS</a>(readchanS));
00313 }
00314 
<a name="l00315"></a><a class="code" href="classTkCoo.html#e8">00315</a> AMSPoint <a class="code" href="classTkCoo.html#e8">TkCoo::GetGlobalAC</a>(<span class="keywordtype">int</span> tkid,<span class="keywordtype">float</span> readchanK, <span class="keywordtype">float</span> readchanS,<span class="keywordtype">int</span> mult){
00316   <span class="keywordtype">int</span> layer=abs(tkid)/100;
00317   <span class="keywordflow">if</span>(layer==1||layer==8)
00318     <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e7">GetGlobalA</a>(tkid,<a class="code" href="classTkCoo.html#h2">GetLocalCooK7</a>(readchanK, mult),  <a class="code" href="classTkCoo.html#h0">GetLocalCooS</a>(readchanS));
00319   <span class="keywordflow">else</span> 
00320     <span class="keywordflow">return</span> <a class="code" href="classTkCoo.html#e7">GetGlobalA</a>(tkid,<a class="code" href="classTkCoo.html#h1">GetLocalCooK5</a>(readchanK, mult),  <a class="code" href="classTkCoo.html#h0">GetLocalCooS</a>(readchanS));
00321 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
