<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TrRawCluster.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TrRawCluster.C</h1><a href="TrRawCluster_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 
00018 
00019 <span class="preprocessor">#include "<a class="code" href="TrRawCluster_8h.html">TrRawCluster.h</a>"</span>
00020 <span class="preprocessor">#include &lt;iostream&gt;</span>
00021 
00022 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00023 <a class="code" href="TrTrack_8C.html#a0">ClassImp</a>(<a class="code" href="classAMSTrRawCluster.html">AMSTrRawCluster</a>);
00024 
<a name="l00025"></a><a class="code" href="classAMSTrRawCluster.html#t0">00025</a> <a class="code" href="classTrCalDB.html">TrCalDB</a>* <a class="code" href="classAMSTrRawCluster.html#t0">AMSTrRawCluster::_trcaldb</a> = NULL;
<a name="l00026"></a><a class="code" href="classAMSTrRawCluster.html#s0">00026</a> string AMSTrRawCluster::sout;
00027 
00028 <span class="comment">//--------------------------------------------------</span>
<a name="l00029"></a><a class="code" href="classAMSTrRawCluster.html#a0">00029</a> <a class="code" href="classAMSTrRawCluster.html#a0">AMSTrRawCluster::AMSTrRawCluster</a>(<span class="keywordtype">void</span>) {
00030   <a class="code" href="classAMSTrRawCluster.html#a5">Clear</a>();
00031 }
00032 
00033 <span class="comment">//--------------------------------------------------</span>
<a name="l00034"></a><a class="code" href="classAMSTrRawCluster.html#a4">00034</a> <a class="code" href="classAMSTrRawCluster.html#a4">AMSTrRawCluster::~AMSTrRawCluster</a>(){
00035  
00036 }
00037 
00038 <span class="comment">//--------------------------------------------------</span>
<a name="l00039"></a><a class="code" href="classAMSTrRawCluster.html#a5">00039</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrRawCluster.html#a5">AMSTrRawCluster::Clear</a>() {
00040   <span class="comment">// TrBase::Clear();</span>
00041   <a class="code" href="classAMSTrRawCluster.html#o0">_tkid</a>    =  0;
00042   <a class="code" href="classAMSTrRawCluster.html#o1">_address</a> = -1;
00043   <a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>   =  0;
00044   <span class="comment">//  _gain    =  8; </span>
00045   <a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.clear();
00046   <span class="comment">//_sigma.clear();</span>
00047   <span class="comment">//_status.clear();</span>
00048 }
00049 
00050 
00051 <span class="comment">//--------------------------------------------------</span>
<a name="l00052"></a><a class="code" href="classAMSTrRawCluster.html#a1">00052</a> <a class="code" href="classAMSTrRawCluster.html#a0">AMSTrRawCluster::AMSTrRawCluster</a>(<span class="keyword">const</span> <a class="code" href="classAMSTrRawCluster.html">AMSTrRawCluster</a> &amp;orig) : AMSlink(orig) {
00053   <a class="code" href="classAMSTrRawCluster.html#o0">_tkid</a>    = orig.<a class="code" href="classAMSTrRawCluster.html#o0">_tkid</a>;
00054   <a class="code" href="classAMSTrRawCluster.html#o1">_address</a> = orig.<a class="code" href="classAMSTrRawCluster.html#o1">_address</a>;
00055   <a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>   = orig.<a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>;
00056   <span class="comment">//  _gain    = orig._gain; </span>
00057   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _nelem; i++){
00058     <a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.push_back(orig.<a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.at(i));
00059     <span class="comment">//_sigma .push_back(orig._sigma .at(i));</span>
00060     <span class="comment">//_status.push_back(orig._status.at(i));</span>
00061   }
00062 }
00063 
00064 <span class="comment">//--------------------------------------------------</span>
00065 <a class="code" href="classAMSTrRawCluster.html#a0">AMSTrRawCluster::AMSTrRawCluster</a>(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> add, <span class="keywordtype">int</span> nelem, <span class="keywordtype">short</span>* adc) {
00066   _tkid    =  tkid;
00067   _address =  add;
00068   _nelem   =  nelem;
00069   _signal.reserve(_nelem);
00070   <span class="comment">//  _gain    =  8;</span>
00071   <span class="keywordflow">if</span>(adc) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _nelem; i++) _signal.push_back(adc[i]/8.);
00072 }
00073 
00074 <span class="comment">//--------------------------------------------------</span>
<a name="l00075"></a><a class="code" href="classAMSTrRawCluster.html#a3">00075</a> <a class="code" href="classAMSTrRawCluster.html#a0">AMSTrRawCluster::AMSTrRawCluster</a>(<span class="keywordtype">int</span> tkid, <span class="keywordtype">int</span> add, <span class="keywordtype">int</span> nelem, <span class="keywordtype">float</span> *adc) {
00076   <a class="code" href="classAMSTrRawCluster.html#o0">_tkid</a>    =  tkid;
00077   <a class="code" href="classAMSTrRawCluster.html#o1">_address</a> =  add;
00078   <a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>   =  nelem;
00079   <a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.reserve(<a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>);
00080   <span class="comment">//  _gain    =  8;</span>
00081   <span class="keywordflow">if</span>(adc) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _nelem; i++) <a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.push_back(adc[i]);
00082 }
00083 
00084 
00085 <span class="comment">/*</span>
00086 <span class="comment">//--------------------------------------------------</span>
00087 <span class="comment">AMSTrRawCluster::AMSTrRawCluster(int tkid, int add, int nelem, short* adc,float* sigma, short* status) : TrBase() {</span>
00088 <span class="comment">  _tkid    =  tkid;</span>
00089 <span class="comment">  _address =  add;</span>
00090 <span class="comment">  _nelem   =  nelem;</span>
00091 <span class="comment">  _signal.reserve(_nelem);</span>
00092 <span class="comment">  //_sigma.reserve(_nelem);</span>
00093 <span class="comment">  //_status.reserve(_nelem);</span>
00094 <span class="comment">  _gain    =  8;</span>
00095 <span class="comment">  if(adc) for (int i = 0; i &lt; _nelem; i++) _signal.push_back(adc[i]/8.);</span>
00096 <span class="comment">  // if(sigma) for (int i = 0; i &lt; _nelem; i++) _sigma.push_back(sigma[i]);</span>
00097 <span class="comment">  // if(status) for (int i = 0; i &lt; _nelem; i++) _status.push_back(status[i]);</span>
00098 <span class="comment">}</span>
00099 <span class="comment"></span>
00100 <span class="comment">//--------------------------------------------------</span>
00101 <span class="comment">AMSTrRawCluster::AMSTrRawCluster(int tkid, int add, int nelem, short* adc,float* sigma, int * status):TrBase() {</span>
00102 <span class="comment">  _tkid    =  tkid;</span>
00103 <span class="comment">  _address =  add;</span>
00104 <span class="comment">  _nelem   =  nelem;</span>
00105 <span class="comment">  _signal.reserve(_nelem);</span>
00106 <span class="comment">  // _sigma.reserve(_nelem);</span>
00107 <span class="comment">  // _status.reserve(_nelem);</span>
00108 <span class="comment">  _gain    =  8;</span>
00109 <span class="comment">  if(adc) for (int i = 0; i &lt; _nelem; i++) _signal.push_back(adc[i]/8.);</span>
00110 <span class="comment">  // if(sigma) for (int i = 0; i &lt; _nelem; i++) _sigma.push_back(sigma[i]);</span>
00111 <span class="comment">  // if(status) for (int i = 0; i &lt; _nelem; i++) _status.push_back(status[i]);</span>
00112 <span class="comment">}</span>
00113 <span class="comment"></span>
00114 <span class="comment">//--------------------------------------------------</span>
00115 <span class="comment">AMSTrRawCluster::AMSTrRawCluster(int tkid, int add, int nelem, int *adc,float* sigma, int* status):TrBase() {</span>
00116 <span class="comment">  _tkid    =  tkid;</span>
00117 <span class="comment">  _address =  add;</span>
00118 <span class="comment">  _nelem   =  nelem;</span>
00119 <span class="comment">  _signal.reserve(_nelem);</span>
00120 <span class="comment">  //_sigma.reserve(_nelem);</span>
00121 <span class="comment">  //_status.reserve(_nelem);</span>
00122 <span class="comment">  _gain    =  8;</span>
00123 <span class="comment">  if(adc) for (int i = 0; i &lt; _nelem; i++) _signal.push_back(adc[i]/8.);</span>
00124 <span class="comment">  // if(sigma) for (int i = 0; i &lt; _nelem; i++) _sigma.push_back(sigma[i]);</span>
00125 <span class="comment">  // if(status) for (int i = 0; i &lt; _nelem; i++) _status.push_back(status[i]);</span>
00126 <span class="comment">}</span>
00127 <span class="comment"></span>
00128 <span class="comment">//--------------------------------------------------</span>
00129 <span class="comment">AMSTrRawCluster::AMSTrRawCluster(int tkid, int add, int nelem, float *adc,float* sigma, int* status):TrBase() {</span>
00130 <span class="comment">  _tkid    =  tkid;</span>
00131 <span class="comment">  _address =  add;</span>
00132 <span class="comment">  _nelem   =  nelem;</span>
00133 <span class="comment">  _signal.reserve(_nelem);</span>
00134 <span class="comment">  // _sigma.reserve(_nelem);</span>
00135 <span class="comment">  // _status.reserve(_nelem);</span>
00136 <span class="comment">  _gain    =  8;</span>
00137 <span class="comment">  if(adc) for (int i = 0; i &lt; _nelem; i++) _signal.push_back(adc[i]);</span>
00138 <span class="comment">  // if(sigma) for (int i = 0; i &lt; _nelem; i++) _sigma.push_back(sigma[i]);</span>
00139 <span class="comment">  // if(status) for (int i = 0; i &lt; _nelem; i++) _status.push_back(status[i]);</span>
00140 <span class="comment">}</span>
00141 <span class="comment">*/</span>
00142 
00143 <span class="comment">//--------------------------------------------------</span>
<a name="l00144"></a><a class="code" href="classAMSTrRawCluster.html#a18">00144</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a18">AMSTrRawCluster::GetNoise</a>(<span class="keywordtype">int</span> ii) {
00145   <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#t0">_trcaldb</a>==0) {
00146     printf(<span class="stringliteral">"TrRawClusters::GetStatus Error, no _trcaldb specified.\n"</span>);
00147     <span class="keywordflow">return</span> -9999.; 
00148   }
00149   <span class="keywordtype">int</span> tkid = <a class="code" href="classAMSTrRawCluster.html#a7">GetTkId</a>();
00150   <a class="code" href="classTrLadCal.html">TrLadCal</a>* ladcal = <a class="code" href="classAMSTrRawCluster.html#a6">GetTrCalDB</a>()-&gt;<a class="code" href="classTrCalDB.html#a10">FindCal_TkId</a>(tkid);
00151   <span class="keywordflow">if</span> (!ladcal) {printf (<span class="stringliteral">"AMSTrRawCluster::GetNoise, WARNING calibration not found!!\n"</span>); <span class="keywordflow">return</span> -9999;} 
00152   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrRawCluster.html#o1">_address</a>+ii;
00153   <span class="keywordflow">return</span> (float)ladcal-&gt;<a class="code" href="classTrLadCal.html#a11">GetSigma</a>(address);
00154 }
00155 
00156 
00157 <span class="comment">//--------------------------------------------------</span>
<a name="l00158"></a><a class="code" href="classAMSTrRawCluster.html#a20">00158</a> <span class="keywordtype">short</span> <a class="code" href="classAMSTrRawCluster.html#a20">AMSTrRawCluster::GetStatus</a>(<span class="keywordtype">int</span> ii) {
00159   <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#t0">_trcaldb</a>==0) {
00160     printf(<span class="stringliteral">"TrRawClusters::GetStatus Error, no _trcaldb specified.\n"</span>);
00161     <span class="keywordflow">return</span> -1; 
00162   }
00163   <span class="keywordtype">int</span> tkid = <a class="code" href="classAMSTrRawCluster.html#a7">GetTkId</a>();
00164   <a class="code" href="classTrLadCal.html">TrLadCal</a>* ladcal = <a class="code" href="classAMSTrRawCluster.html#a6">GetTrCalDB</a>()-&gt;<a class="code" href="classTrCalDB.html#a10">FindCal_TkId</a>(tkid);
00165   <span class="keywordflow">if</span> (!ladcal) {printf (<span class="stringliteral">"AMSTrRawCluster::GetNoise, WARNING calibration not found!!\n"</span>); <span class="keywordflow">return</span> -9999;} 
00166   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrRawCluster.html#o1">_address</a>+ii;
00167   <span class="keywordflow">return</span> (short)ladcal-&gt;<a class="code" href="classTrLadCal.html#a13">GetStatus</a>(address);
00168 }
00169 
00170 
00171 <span class="comment">//--------------------------------------------------</span>
<a name="l00172"></a><a class="code" href="classAMSTrRawCluster.html#a22">00172</a> std::ostream &amp;<a class="code" href="classAMSTrRawCluster.html#a22">AMSTrRawCluster::putout</a>(std::ostream &amp;ostr)<span class="keyword"> const </span>{
00173   <span class="keywordflow">return</span> ostr &lt;&lt; <span class="stringliteral">"TkID: "</span> &lt;&lt; <a class="code" href="classAMSTrRawCluster.html#o0">_tkid</a> &lt;&lt; <span class="stringliteral">" "</span>
00174               &lt;&lt; <span class="stringliteral">"Addr: "</span> &lt;&lt; <a class="code" href="classAMSTrRawCluster.html#o1">_address</a> &lt;&lt; <span class="stringliteral">" "</span>
00175               &lt;&lt; <span class="stringliteral">"Nelm: "</span> &lt;&lt; <a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a> &lt;&lt; std::endl;
00176 }
00177 
00178 
00179 <span class="comment">//--------------------------------------------------</span>
<a name="l00180"></a><a class="code" href="classAMSTrRawCluster.html#a23">00180</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrRawCluster.html#a23">AMSTrRawCluster::Print</a>() { 
00181   <a class="code" href="classAMSTrRawCluster.html#a24">Info</a>();
00182   cout&lt;&lt;sout;
00183 
00184 }
00185 
<a name="l00186"></a><a class="code" href="classAMSTrRawCluster.html#a24">00186</a> <span class="keywordtype">void</span> <a class="code" href="classAMSTrRawCluster.html#a24">AMSTrRawCluster::Info</a>() { 
00187   <span class="keywordtype">char</span> msg[1000];
00188   <a class="code" href="classAMSTrRawCluster.html#s0">sout</a>.clear();
00189   sprintf(msg,<span class="stringliteral">"TkId: %5d  Side: %1d  Address: %4d  Nelem: %3d\n"</span>,
00190          <a class="code" href="classAMSTrRawCluster.html#a7">GetTkId</a>(),<a class="code" href="classAMSTrRawCluster.html#a12">GetSide</a>(),<a class="code" href="classAMSTrRawCluster.html#a13">GetAddress</a>(),<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>());
00191   <a class="code" href="classAMSTrRawCluster.html#s0">sout</a>.append(msg);
00192   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>(); ii++) {
00193     sprintf(msg,<span class="stringliteral">"Address: %4d  Signal: %10.5f  Sigma: %10.5f  Status: %3d\n"</span>,
00194            ii+<a class="code" href="classAMSTrRawCluster.html#a13">GetAddress</a>(),<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii),<a class="code" href="classAMSTrRawCluster.html#a17">GetSigma</a>(ii),<a class="code" href="classAMSTrRawCluster.html#a20">GetStatus</a>(ii));
00195     <a class="code" href="classAMSTrRawCluster.html#s0">sout</a>.append(msg);
00196   }
00197 }
00198 
00199 
00200 <span class="comment">//--------------------------------------------------</span>
<a name="l00201"></a><a class="code" href="classAMSTrRawCluster.html#a25">00201</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a25">AMSTrRawCluster::GetSeedIndex</a>(<span class="keywordtype">float</span> thseed){
00202   <span class="keywordtype">float</span> maxadc  = -1000.;
00203   <span class="keywordtype">int</span>   seedadd = -1;
00204 <span class="preprocessor">#ifdef PZVERS</span>
00205 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>(); ii++) { 
00206     <span class="keywordflow">if</span> ( (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&gt;3.5)&amp;&amp;(<a class="code" href="classAMSTrRawCluster.html#a20">GetStatus</a>(ii)==0) ) { 
00207       maxadc  = <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii); 
00208       seedadd = ii; 
00209       <span class="keywordflow">break</span>;
00210     }
00211   }      
00212 
00213   <span class="keywordflow">if</span>(seedadd&gt;=0) {
00214     <span class="keywordflow">if</span>(<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(seedadd)&gt;thseed) <span class="keywordflow">return</span> seedadd;
00215     <span class="keywordflow">else</span> <span class="keywordflow">return</span> seedadd*-1.;
00216   }
00217   <span class="keywordflow">return</span> -1;
00218 <span class="preprocessor">#else</span>
00219 <span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=0; ii&lt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>(); ii++) { 
00220     <span class="keywordflow">if</span> ( (<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii)&gt;maxadc)&amp;&amp; (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&gt;thseed) &amp;&amp;(<a class="code" href="classAMSTrRawCluster.html#a20">GetStatus</a>(ii)==0) ) { 
00221       maxadc  = <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii); 
00222       seedadd = ii; 
00223     }
00224   }
00225   <span class="keywordflow">return</span> seedadd;
00226 <span class="preprocessor">#endif</span>
00227 <span class="preprocessor"></span>}
00228 
00229 <span class="comment">//--------------------------------------------------</span>
<a name="l00230"></a><a class="code" href="classAMSTrRawCluster.html#a26">00230</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a26">AMSTrRawCluster::GetSeedAddress</a>(<span class="keywordtype">float</span> thseed){
00231   Int_t cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00232   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1;
00233   <span class="keywordflow">return</span> cstrip + <a class="code" href="classAMSTrRawCluster.html#a13">GetAddress</a>();
00234 }
00235 
00236 <span class="comment">//--------------------------------------------------</span>
<a name="l00237"></a><a class="code" href="classAMSTrRawCluster.html#a35">00237</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a35">AMSTrRawCluster::GetStatusnStrips</a>(<span class="keywordtype">int</span> nstrips, <span class="keywordtype">float</span> thseed, <span class="keywordtype">float</span> thneig){
00238   Int_t cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00239   Int_t nleft  = <a class="code" href="classAMSTrRawCluster.html#a30">GetLeftLength</a>(thseed,thneig);
00240   Int_t nright = <a class="code" href="classAMSTrRawCluster.html#a31">GetRightLength</a>(thseed,thneig);
00241   <span class="keywordflow">if</span> ( (cstrip&lt;0)||(nleft&lt;0)||(nright&lt;0) ) <span class="keywordflow">return</span> -1; 
00242 
00243   Int_t lindex = 0;
00244   Int_t rindex = 0;
00245   Int_t nside  = 0;
00246   Int_t sum    = 0;
00247   <span class="comment">// number strip selection</span>
00248   <span class="keywordflow">if</span> (nstrips%2){ <span class="comment">// odd (same number of left/right strips)</span>
00249     nside  = (nstrips-1)/2;
00250     lindex = cstrip-nside;
00251     rindex = cstrip+nside;
00252   }
00253   <span class="keywordflow">else</span> { <span class="comment">// even (take the highest strip between the n-ths left and right strips)</span>
00254     nside = nstrips/2;
00255     <span class="keywordflow">if</span> ( (nleft&lt;=nside)&amp;&amp;(nright&lt;=nside) ) { <span class="comment">// se posso fare il confronto</span>
00256       <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-nside)&gt;=<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+nside)){
00257         lindex = cstrip-nside;
00258         rindex = cstrip+nside - 1;
00259       }
00260       <span class="keywordflow">else</span> {
00261         lindex = cstrip-nside + 1;
00262         rindex = cstrip+nside;
00263       }
00264     }
00265     <span class="keywordflow">else</span> { <span class="comment">// altrimenti prendo il massimo dal lato in cui posso</span>
00266       lindex = cstrip-nside;
00267       rindex = cstrip+nside;
00268     }
00269   }
00270   <span class="comment">// check sull'overflow</span>
00271   <span class="keywordflow">if</span> (lindex&lt;0)          lindex = 0;
00272   <span class="keywordflow">if</span> (rindex&gt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>()) rindex = <a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>();
00273   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=lindex; ii&lt;rindex; ii++) sum += <a class="code" href="classAMSTrRawCluster.html#a20">GetStatus</a>(ii);
00274 
00275   <span class="keywordflow">return</span> sum;
00276 }
00277 
00278 
00279 <span class="comment">//--------------------------------------------------</span>
<a name="l00280"></a><a class="code" href="classAMSTrRawCluster.html#a32">00280</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a32">AMSTrRawCluster::GetLength</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig) {
00281   <span class="keywordflow">if</span> ( (<a class="code" href="classAMSTrRawCluster.html#a30">GetLeftLength</a>(thseed,thneig)&lt;0)||(<a class="code" href="classAMSTrRawCluster.html#a31">GetRightLength</a>(thseed,thneig)&lt;0) ) <span class="keywordflow">return</span> -1;
00282   <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a30">GetLeftLength</a>(thseed,thneig) + <a class="code" href="classAMSTrRawCluster.html#a31">GetRightLength</a>(thseed,thneig) + 1;
00283 }
00284 
00285 
00286 <span class="comment">//--------------------------------------------------</span>
<a name="l00287"></a><a class="code" href="classAMSTrRawCluster.html#a30">00287</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a30">AMSTrRawCluster::GetLeftLength</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig) {
00288   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00289   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1;
00290   <span class="keywordtype">int</span> length = 0;
00291   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=cstrip-1; ii&gt;=0; ii--) {
00292     <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&lt;thneig) <span class="keywordflow">break</span>;
00293     length++;
00294   }
00295   <span class="keywordflow">return</span> length;
00296 }
00297 
00298 
00299 <span class="comment">//--------------------------------------------------</span>
<a name="l00300"></a><a class="code" href="classAMSTrRawCluster.html#a31">00300</a> <span class="keywordtype">int</span> <a class="code" href="classAMSTrRawCluster.html#a31">AMSTrRawCluster::GetRightLength</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig) {
00301   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00302   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1;
00303   <span class="keywordtype">int</span> length = 0;
00304   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=cstrip+1; ii&lt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>(); ii++) {
00305     <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&lt;thneig) <span class="keywordflow">break</span>;
00306     length++;
00307   }
00308   <span class="keywordflow">return</span> length;
00309 }
00310 
00311 
00312 <span class="comment">//--------------------------------------------------</span>
<a name="l00313"></a><a class="code" href="classAMSTrRawCluster.html#a33">00313</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a33">AMSTrRawCluster::GetTotSignal</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig) {
00314   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00315   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00316   <span class="keywordtype">float</span> sum = <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip);
00317   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=cstrip-1; ii&gt;=0; ii--) {
00318     <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&lt;thneig) <span class="keywordflow">break</span>;
00319     sum += <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii);
00320   }
00321   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=cstrip+1; ii&lt;<a class="code" href="classAMSTrRawCluster.html#a15">GetNelem</a>(); ii++) {
00322     <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(ii)&lt;thneig) <span class="keywordflow">break</span>;
00323     sum += <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(ii);
00324   }
00325   <span class="keywordflow">return</span> sum;
00326 }
00327 
00328 <span class="comment">//--------------------------------------------------</span>
<a name="l00329"></a><a class="code" href="classAMSTrRawCluster.html#a34">00329</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a34">AMSTrRawCluster::GetTotSignal2</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig) {
00330   <span class="keywordtype">int</span> cstrip = abs(<a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed));
00331   <span class="keywordtype">float</span> sum = <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip);
00332   <span class="keywordtype">float</span> left=0;
00333   <span class="keywordtype">float</span> right=0;
00334   <span class="keywordtype">float</span> add=0;
00335   <span class="keywordflow">if</span>(cstrip&gt;0) left= <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1);
00336   <span class="keywordflow">else</span> left=0;
00337   <span class="keywordflow">if</span>(cstrip&lt;((int)<a class="code" href="classAMSTrRawCluster.html#o3">_signal</a>.size()-1)) right= <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1);
00338   <span class="keywordflow">else</span> right=0;
00339 
00340   <span class="keywordflow">if</span>( right &gt; left) add=right;
00341   <span class="keywordflow">else</span> add=left;
00342   <span class="keywordflow">if</span>(add&gt;0) sum+=add;
00343     
00344   
00345   <span class="keywordflow">if</span> (<a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed)&lt;0) <span class="keywordflow">return</span> sum*-1.;
00346   <span class="keywordflow">return</span> sum;
00347 }
00348 
00349 
00350 
00351 <span class="comment">//--------------------------------------------------</span>
<a name="l00352"></a><a class="code" href="classAMSTrRawCluster.html#a27">00352</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a27">AMSTrRawCluster::GetSeedSignal</a>(<span class="keywordtype">float</span> thseed){
00353   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00354   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00355   <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip);
00356 }
00357 
00358 
00359 <span class="comment">//--------------------------------------------------</span>
<a name="l00360"></a><a class="code" href="classAMSTrRawCluster.html#a28">00360</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a28">AMSTrRawCluster::GetSeedNoise</a>(<span class="keywordtype">float</span> thseed){
00361   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00362   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00363   <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a18">GetNoise</a>(cstrip);
00364 }
00365 
00366 
00367 <span class="comment">//--------------------------------------------------</span>
<a name="l00368"></a><a class="code" href="classAMSTrRawCluster.html#a29">00368</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a29">AMSTrRawCluster::GetSeedSN</a>(<span class="keywordtype">float</span> thseed){
00369   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00370   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00371   <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(cstrip);
00372 }
00373 
00374 <span class="comment">//--------------------------------------------------</span>
<a name="l00375"></a><a class="code" href="classAMSTrRawCluster.html#a36">00375</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a36">AMSTrRawCluster::GetEta</a>(<span class="keywordtype">float</span> thseed,<span class="keywordtype">float</span> thneig){
00376   <span class="comment">/*</span>
00377 <span class="comment">    eta = center of gravity with the two higher strips = Q_{R} / ( Q_{L} + Q_{R} )</span>
00378 <span class="comment"></span>
00379 <span class="comment">       _                                    _</span>
00380 <span class="comment">     l|c|r          c*0 + r*1    r        l|c|r            l*0 + c*1    c</span>
00381 <span class="comment">      | |_    eta = --------- = ---       _| |       eta = --------- = ---</span>
00382 <span class="comment">     _| | |           c + r     c+r      | | |_              l + c     l+c</span>
00383 <span class="comment">  __|_|_|_|__                          __|_|_|_|__</span>
00384 <span class="comment">       0 1                                0 1</span>
00385 <span class="comment"></span>
00386 <span class="comment">       - eta is 1 when the particle is near to the right strip,</span>
00387 <span class="comment">       while is approx 0 when is near to the left strip</span>
00388 <span class="comment">  */</span>
00389   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00390   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00391   <span class="keywordtype">int</span> nleft  = <a class="code" href="classAMSTrRawCluster.html#a30">GetLeftLength</a>(thseed,thneig);
00392   <span class="keywordtype">int</span> nright = <a class="code" href="classAMSTrRawCluster.html#a31">GetRightLength</a>(thseed,thneig);
00393   <span class="comment">// 1 strip</span>
00394   <span class="keywordflow">if</span> ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) <span class="keywordflow">return</span> 0.; 
00395   <span class="comment">// 2 strips</span>
00396   <span class="keywordflow">if</span> (nleft&lt;=0)  <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1)/(<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip));
00397   <span class="keywordflow">if</span> (nright&lt;=0) <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip)/(<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip));
00398   <span class="comment">// &gt;2 strips</span>
00399   <span class="keywordflow">if</span> ( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1)&gt;<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) ) <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1)/(<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip));
00400   <span class="keywordflow">else</span>                                           <span class="keywordflow">return</span> <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip)/(<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip));
00401   <span class="keywordflow">return</span> -1.;
00402 }
00403 
00404 <span class="comment">//--------------------------------------------------</span>
<a name="l00405"></a><a class="code" href="classAMSTrRawCluster.html#a37">00405</a> <span class="keywordtype">float</span> <a class="code" href="classAMSTrRawCluster.html#a37">AMSTrRawCluster::GetEtaAddress</a>(<span class="keywordtype">float</span> thseed, <span class="keywordtype">float</span> thneig) {
00406   <span class="keywordtype">int</span> cstrip = <a class="code" href="classAMSTrRawCluster.html#a25">GetSeedIndex</a>(thseed);
00407   <span class="keywordflow">if</span> (cstrip&lt;0) <span class="keywordflow">return</span> -1.;
00408   <span class="keywordtype">int</span> address = <a class="code" href="classAMSTrRawCluster.html#a26">GetSeedAddress</a>(thseed);
00409   <span class="keywordtype">int</span> nleft   = <a class="code" href="classAMSTrRawCluster.html#a30">GetLeftLength</a>(thseed,thneig);
00410   <span class="keywordtype">int</span> nright  = <a class="code" href="classAMSTrRawCluster.html#a31">GetRightLength</a>(thseed,thneig);
00411   <span class="comment">// 1 strip</span>
00412   <span class="keywordflow">if</span> ( (nleft&lt;=0)&amp;&amp;(nright&lt;=0) ) <span class="keywordflow">return</span> (float)address; 
00413   <span class="comment">// 2 strips</span>
00414   <span class="keywordflow">if</span> (nleft&lt;=0)  <span class="keywordflow">return</span> ( (address+1.)*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + address*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) )/( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) );
00415   <span class="keywordflow">if</span> (nright&lt;=0) <span class="keywordflow">return</span> ( (address-1.)*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + address*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) )/( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) );
00416   <span class="comment">// &gt;2 strips</span>
00417   <span class="keywordflow">if</span> ( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1)&gt;<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) ) 
00418     <span class="keywordflow">return</span> ( (address+1.)*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + address*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) )/( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip+1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) );
00419   <span class="keywordflow">else</span> 
00420     <span class="keywordflow">return</span> ( (address-1.)*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + address*<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) )/( <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip-1) + <a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(cstrip) );
00421   <span class="keywordflow">return</span> -1.;
00422 }
00423 
00424 
00425 
00426 
00427 
00428 
<a name="l00429"></a><a class="code" href="classAMSTrRawCluster.html#a38">00429</a> integer <a class="code" href="classAMSTrRawCluster.html#a38">AMSTrRawCluster::lvl3format</a>(int16 * adc, integer nmax,<span class="keywordtype">int</span> lvl3dcard_par  ,integer matchedonly){
00430 
00431   <span class="comment">//</span>
00432   <span class="comment">// convert my stupid format to lvl3 one for shuttle flight (mb also stupid)(vc)</span>
00433   <span class="comment">//</span>
00434 
00435   int16 pos =0;
00436 
00437   <span class="keywordflow">if</span> (
00438       nmax-pos &lt; 2+_nelem || _nelem &gt; 63 || <a class="code" href="classAMSTrRawCluster.html#o2">_nelem</a>==0 
00439       ||
00440       <span class="comment">//PZ FIXME      (GetSide()==0 &amp;&amp; matchedonly &amp;&amp; !checkstatus(MATCHED))</span>
00441       (<a class="code" href="classAMSTrRawCluster.html#a12">GetSide</a>()==0 &amp;&amp; matchedonly )
00442       ) <span class="keywordflow">return</span> pos;
00443 
00444   adc[pos+1]=1000*<a class="code" href="classAMSTrRawCluster.html#o1">_address</a>+<a class="code" href="classAMSTrRawCluster.html#a8">GetHwId</a>();
00445   <span class="comment">//if(id.getside())cout &lt;&lt;" haddr "&lt;&lt;id.gethaddr()&lt;&lt;" "&lt;&lt;id.gettdr()&lt;&lt;" "&lt;&lt;id.getcrate()&lt;&lt;" "&lt;&lt;id.getdrp()&lt;&lt;endl;</span>
00446   integer imax=0;
00447   geant rmax=-1000000;
00448   int16 sn;
00449   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;_nelem;i++){
00450     
00451     <span class="keywordflow">if</span>(<a class="code" href="classAMSTrRawCluster.html#a17">GetSigma</a>(i) &amp;&amp; <a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(i) &gt; rmax ){
00452       rmax=<a class="code" href="classAMSTrRawCluster.html#a19">GetSN</a>(i);
00453       sn=(rmax+0.5);
00454       <span class="keywordflow">if</span>(sn&gt;63)sn=63;
00455       <span class="keywordflow">if</span>(sn&lt;0)sn=0;
00456       imax=i;
00457     }
00458     adc[pos+i+2]=int16(<a class="code" href="classAMSTrRawCluster.html#a16">GetSignal</a>(i));
00459   }
00460   <span class="comment">//  if(id.getside()==1)cout &lt;&lt;"sn "&lt;&lt;sn&lt;&lt;endl;</span>
00461 
00462   <span class="keywordflow">if</span>(lvl3dcard_par&gt;0)
00463     adc[pos]=(_nelem-1) | (int16u(<a class="code" href="classAMSTrRawCluster.html#a29">GetSeedSN</a>()*8)&lt;&lt;6);
00464   
00465   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lvl3dcard_par&lt;0)
00466     adc[pos]=(_nelem-1) | (  int16u(<a class="code" href="classAMSTrRawCluster.html#a29">GetSeedSN</a>()) &lt;&lt;6);
00467   
00468   <span class="keywordflow">else</span>  
00469     adc[pos]=(_nelem-1) | (imax&lt;&lt;6);
00470   
00471   pos+=2+_nelem;
00472  <span class="keywordflow">return</span> pos;
00473 }
00474 
00475 
00476 
00477 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
