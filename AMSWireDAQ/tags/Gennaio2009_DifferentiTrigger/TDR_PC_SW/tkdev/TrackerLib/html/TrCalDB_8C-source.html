<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> AMS Software: Geometry Classes: CC/TrCalDB.C Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">CC</a></div>
<h1>TrCalDB.C</h1><a href="TrCalDB_8C.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">//  $Id: TrCalDB.C,v 1.10 2008/10/14 10:06:00 zuccon Exp $</span>
00002 
00016 
00017 <span class="preprocessor">#include "<a class="code" href="TrCalDB_8h.html">TrCalDB.h</a>"</span>
00018 <span class="preprocessor">#include "TFile.h"</span>
00019 
00020 <a class="code" href="TrTrack_8C.html#a0">ClassImp</a>(<a class="code" href="classTrCalDB.html">TrCalDB</a>);
00021 
<a name="l00022"></a><a class="code" href="classTrCalDB.html#s0">00022</a> <a class="code" href="classTrCalDB.html">TrCalDB</a>* <a class="code" href="classTrCalDB.html#s0">TrCalDB::Head</a>=0;
00023 
<a name="l00024"></a><a class="code" href="classTrCalDB.html#s1">00024</a> <span class="keywordtype">float</span>* <a class="code" href="classTrCalDB.html#s1">TrCalDB::linear</a>=0;
00025 
00026 
<a name="l00027"></a><a class="code" href="classTrCalDB.html#a3">00027</a> <span class="keywordtype">void</span> <a class="code" href="classTrCalDB.html#a3">TrCalDB::init</a>(){
00028 
00029   <span class="keywordflow">if</span>(<a class="code" href="classTrCalDB.html#s0">Head</a>==0){
00030     <a class="code" href="classTrCalDB.html#s0">Head</a>=<span class="keyword">this</span>;
00031     <a class="code" href="classTrCalDB.html#o1">run</a>=0;
00032     
00033     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> oct=0;oct&lt;8;oct++){
00034       <span class="keywordtype">int</span> crate=TkDBc::Head-&gt; _octant_crate[oct];
00035       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> tdr=0;tdr&lt;24;tdr++){
00036         <span class="keywordtype">int</span> hwid=crate*100+tdr;
00037         <a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>[hwid]=<span class="keyword">new</span> <a class="code" href="classTrLadCal.html">TrLadCal</a>(hwid);
00038       }
00039     }
00040   } <span class="keywordflow">else</span>{ 
00041     printf(<span class="stringliteral">"Only One instance of CalDB Allowed\n"</span>);
00042     printf(<span class="stringliteral">"Use CalDB:Head-&gt;Load() to load a new calibration\n"</span>);
00043   }
00044 }
00045 
<a name="l00046"></a><a class="code" href="classTrCalDB.html#a1">00046</a> <a class="code" href="classTrCalDB.html#a0">TrCalDB::TrCalDB</a>(<span class="keywordtype">char</span> * filename){
00047     <span class="keywordflow">if</span>(filename) <a class="code" href="classTrCalDB.html#e0">Load</a>(filename);
00048 }
00049 
00050 
00051 
<a name="l00052"></a><a class="code" href="classTrCalDB.html#a2">00052</a> <a class="code" href="classTrCalDB.html#a2">TrCalDB::~TrCalDB</a>(){
00053   <span class="keywordflow">for</span> ( <a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> pp=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.begin();pp!=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end();++pp)
00054     <span class="keywordflow">if</span>(pp-&gt;second) <span class="keyword">delete</span> pp-&gt;second;
00055   <span class="keywordflow">if</span>(linear) <span class="keyword">delete</span> [] linear;
00056 }
00057 
00058 
<a name="l00059"></a><a class="code" href="classTrCalDB.html#a16">00059</a> <span class="keywordtype">void</span> <a class="code" href="classTrCalDB.html#a16">TrCalDB::Clear</a>(){
00060   <span class="keywordflow">for</span> ( <a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> pp=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.begin();pp!=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end();++pp)
00061     <span class="keywordflow">if</span>(pp-&gt;second)  pp-&gt;second-&gt;Clear();
00062   <span class="keywordflow">if</span>(linear) <span class="keyword">delete</span> [] linear;
00063 }
00064 
00065 
00066 
00067 
00068 
<a name="l00069"></a><a class="code" href="classTrCalDB.html#a9">00069</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a9">TrCalDB::FindCal_TkAssemblyId</a>( <span class="keywordtype">int</span> tkassemblyid){
00070 
00071   <a class="code" href="classTkLadder.html">TkLadder</a>* ll=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a21">FindTkAssemblyId</a>(tkassemblyid);
00072   <span class="keywordflow">if</span>(ll) <span class="keywordflow">return</span> <a class="code" href="classTrCalDB.html#a12">FindCal_HwId</a>(ll-&gt;<a class="code" href="classTkLadder.html#a15">GetHwId</a>());
00073   <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
00074 }
00075 
00076 
<a name="l00077"></a><a class="code" href="classTrCalDB.html#a12">00077</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a12">TrCalDB::FindCal_HwId</a>( <span class="keywordtype">int</span> hwid){ 
00078   <a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> aa=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.find(hwid);
00079   <span class="keywordflow">if</span>(aa != <a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end()) 
00080     <span class="keywordflow">return</span> aa-&gt;second; 
00081   <span class="keywordflow">else</span> 
00082     <span class="keywordflow">return</span> 0;
00083 }
00084 
<a name="l00085"></a><a class="code" href="classTrCalDB.html#a10">00085</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a10">TrCalDB::FindCal_TkId</a>( <span class="keywordtype">int</span> tkid){
00086 
00087   <a class="code" href="classTkLadder.html">TkLadder</a>* ll=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a22">FindTkId</a>(tkid);
00088   <span class="keywordflow">if</span>(ll) 
00089     <span class="keywordflow">return</span> <a class="code" href="classTrCalDB.html#a12">FindCal_HwId</a>(ll-&gt;<a class="code" href="classTkLadder.html#a15">GetHwId</a>());
00090   <span class="keywordflow">else</span> 
00091     <span class="keywordflow">return</span> 0;
00092 }
00093 
00094 
<a name="l00095"></a><a class="code" href="classTrCalDB.html#a13">00095</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a13">TrCalDB::FindCal_LadName</a>( string&amp; name){
00096 
00097   <a class="code" href="classTkLadder.html">TkLadder</a>* ll=TkDBc::Head-&gt;<a class="code" href="classTkDBc.html#a25">FindLadName</a>(name);
00098   <span class="keywordflow">if</span>(ll) 
00099     <span class="keywordflow">return</span> <a class="code" href="classTrCalDB.html#a12">FindCal_HwId</a>(ll-&gt;<a class="code" href="classTkLadder.html#a15">GetHwId</a>());
00100   <span class="keywordflow">else</span> 
00101     <span class="keywordflow">return</span> 0;
00102 }
00103 
00104 
00105 
00106 
<a name="l00107"></a><a class="code" href="classTrCalDB.html#a11">00107</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a11">TrCalDB::FindCal_JMDC</a>( <span class="keywordtype">int</span> JMDCid){
00108   <span class="keywordtype">int</span> crate=(JMDCid-282)/24;
00109   <span class="keywordtype">int</span> tdr=JMDCid-crate*24-282;
00110   <span class="keywordtype">int</span> hwid=crate*100+tdr;
00111   printf(<span class="stringliteral">" crate %d tdr %d hwid %d \n"</span>,crate, tdr, hwid);
00112   <span class="keywordflow">return</span> <a class="code" href="classTrCalDB.html#a12">FindCal_HwId</a>( hwid);
00113 }
00114  
<a name="l00115"></a><a class="code" href="classTrCalDB.html#a6">00115</a> <a class="code" href="classTrLadCal.html">TrLadCal</a>* <a class="code" href="classTrCalDB.html#a6">TrCalDB::GetEntry</a>(<span class="keywordtype">int</span> ii){
00116   <span class="keywordtype">int</span> count=0;
00117   <span class="keywordflow">for</span>(<a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> pp=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.begin();pp!=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end();pp++){
00118     <span class="keywordflow">if</span>(count==ii) <span class="keywordflow">return</span> &amp;(*pp-&gt;second);
00119     count++;
00120   }
00121   <span class="keywordflow">return</span> 0;
00122 }
00123 
00124 
00125 
<a name="l00126"></a><a class="code" href="classTrCalDB.html#e0">00126</a> <span class="keywordtype">void</span> <a class="code" href="classTrCalDB.html#e0">TrCalDB::Load</a>(<span class="keywordtype">char</span> * filename){
00127 
00128   TFile* f=TFile::Open(filename);
00129   <a class="code" href="classTrCalDB.html#s0">Head</a>=(<a class="code" href="classTrCalDB.html">TrCalDB</a>*) f-&gt;Get(<span class="stringliteral">"TrCalDB"</span>);
00130   f-&gt;Close();
00131   return ;
00132 }
00133 
<a name="l00134"></a><a class="code" href="classTrCalDB.html#a15">00134</a> <span class="keywordtype">void</span> <a class="code" href="classTrCalDB.html#a15">TrCalDB::CalDB2Lin</a>(){
00135 
00136   <span class="keywordflow">if</span>(! linear) {
00137     printf(<span class="stringliteral">"TrCalDB::CalDB2Lin()-INFO the linear space is created NOW\n"</span>);
00138     <a class="code" href="classTrCalDB.html#s1">linear</a>= <span class="keyword">new</span> <span class="keywordtype">float</span>[<a class="code" href="classTrCalDB.html#e1">GetLinearSize</a>()/4];
00139   }
00140   <a class="code" href="classTrCalDB.html#s1">linear</a>[0]=(float) run;
00141   <span class="keywordflow">for</span> (<a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> aa=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.begin(); aa!=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end();aa++){
00142     <span class="keywordtype">int</span> hwid=aa-&gt;second-&gt;GetHwId();
00143     <span class="keywordtype">int</span> crate=hwid/100;
00144     <span class="keywordtype">int</span> tdr  =hwid%100;
00145     <span class="keywordtype">int</span> offset=1+(crate*24+tdr)*<a class="code" href="classTrLadCal.html#e0">TrLadCal::GetSize</a>();
00146     aa-&gt;second-&gt;Cal2Lin(&amp;(<a class="code" href="classTrCalDB.html#s1">linear</a>[offset]));
00147   }
00148 
00149 }
00150 
00151 
00152 
<a name="l00153"></a><a class="code" href="classTrCalDB.html#a14">00153</a> <span class="keywordtype">void</span> <a class="code" href="classTrCalDB.html#a14">TrCalDB::Lin2CalDB</a>(){
00154 
00155   <span class="keywordflow">if</span>(! linear){
00156     printf(<span class="stringliteral">"TrCalDB::Lin2CalDB()- Error! the linear space pointer is NULL!\n"</span>);
00157     printf(<span class="stringliteral">" Calibration is NOT updated!!!\n"</span>);
00158     <span class="keywordflow">return</span>;
00159   }
00160   <a class="code" href="classTrCalDB.html#o1">run</a>=(int) <a class="code" href="classTrCalDB.html#s1">linear</a>[0];
00161   <span class="keywordflow">for</span> (<a class="code" href="TrCalDB_8h.html#a0">trcalIT</a> aa=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.begin(); aa!=<a class="code" href="classTrCalDB.html#o0">trcal_hwidmap</a>.end();aa++){
00162     <span class="keywordtype">int</span> hwid=aa-&gt;second-&gt;GetHwId();
00163     <span class="comment">//printf("Filling Calibration %03d\n",hwid);</span>
00164     <span class="keywordtype">int</span> crate=hwid/100;
00165     <span class="keywordtype">int</span> tdr  =hwid%100;
00166     <span class="keywordtype">int</span> offset=1+(crate*24+tdr)*<a class="code" href="classTrLadCal.html#e0">TrLadCal::GetSize</a>();
00167     aa-&gt;second-&gt;Lin2Cal(&amp;(<a class="code" href="classTrCalDB.html#s1">linear</a>[offset]));
00168     aa-&gt;second-&gt;SetFilled();
00169   }
00170   <span class="keywordflow">return</span>;
00171  
00172 }
00173 
00174 
<a name="l00175"></a><a class="code" href="TrCalDB_8h.html#a1">00175</a> <span class="keywordtype">void</span> <a class="code" href="TrCalDB_8C.html#a1">SLin2CalDB</a>(){
00176   <span class="keywordflow">if</span>(TrCalDB::Head)
00177     TrCalDB::Head-&gt;<a class="code" href="classTrCalDB.html#a14">Lin2CalDB</a>();
00178   <span class="keywordflow">return</span>;
00179 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 18 18:21:03 2008 for  AMS Software: Geometry Classes by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
